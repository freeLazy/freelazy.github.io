<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-03-16 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>浏览器</title>
<meta name="author" content="1a2y" />
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">浏览器</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org06eb0e0">1. 浏览器的安全</a></li>
</ul>
</div>
</nav>


<section id="outline-container-org06eb0e0" class="outline-2">
<h2 id="org06eb0e0"><span class="section-number-2">1.</span> 浏览器的安全</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>最核心的策略就是同源策略</li>
<li>网络安全 (https)</li>
<li>系统安全 (安全沙箱)</li>
</ul>

<p>
哪些是同源的:
</p>
<ul class="org-ul">
<li><a href="http://127.0.0.1/hello">http://127.0.0.1/hello</a></li>
<li><a href="https://127.0.0.1/hello">https://127.0.0.1/hello</a></li>
<li><a href="https://127.0.0.1/hello">https://127.0.0.1/hello</a></li>
<li><a href="http://127.0.0.1/world">http://127.0.0.1/world</a></li>
<li><a href="http://127.0.0.1/hello">http://127.0.0.1/hello</a></li>
<li><a href="http://127.0.0.1:1080/hello">http://127.0.0.1:1080/hello</a></li>
<li><a href="http://127.0.0.2:1080/hello">http://127.0.0.2:1080/hello</a></li>
</ul>

<p>
所谓的同源策略 (Same-Origin Policy):
</p>
<ul class="org-ul">
<li>无法读取跨域的 cookie 等</li>
<li>无法访问跨域的 DOM</li>
<li>无法发送跨域的 ajax 请求</li>
</ul>

<p>
例外情况，页面可以嵌入第三方的 image/script/css:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">script</span> <span style="color: #005e8b;">src</span>=<span style="color: #3548cf;">"http://bootcdn.com/jquery.js"</span><span style="color: #000000;">&gt;&lt;</span>/<span style="color: #721045;">script</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">img</span> <span style="color: #005e8b;">src</span>=<span style="color: #3548cf;">"https://img0.baidu.com/it/u=988393983,2653815122"</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
但是这样的访问就会被浏览器拒绝显示:
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #0000b0;">this</span>.axios.get<span style="color: #000000;">(</span><span style="color: #3548cf;">"https://img0.baidu.com/it/u=988393983,2653815122"</span><span style="color: #000000;">)</span>.then<span style="color: #000000;">()</span>;
</pre>
</div>

<p>
错误信息:
</p>
<pre class="example" id="org602578f">
Access to XMLHttpRequest at 'https://localhost:7062/WeatherForecast' from origin 'http://127.0.0.1:5173' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
</pre>

<p>
方案:
</p>
<ul class="org-ul">
<li>JSONP (使用钻空子的方式，强行跨域)</li>
<li>CORS (跨域资源共享, Cross Origin Resource Share) 标准</li>
</ul>

<p>
在响应的时候，添加 Response Header。浏览器可以据此判定是否要展示内容:
</p>
<div class="org-src-container">
<pre class="src src-conf">Access-Control-Allow-Origin: *
Access-Control-Allow-Origin: https://developer.mozilla.org

# cookie
Access-Control-Allow-Credentials: true

# preflight
Access-Control-Allow-Headers: X-Custom-Header, Upgrade-Insecure-Requests
Access-Control-Request-Method: POST
</pre>
</div>

<p>
在 .NET WebAPI 中:
</p>
<div class="org-src-container">
<pre class="src src-csharp">builder.Services.<span style="color: #721045;">AddCors</span><span style="color: #000000;">(</span>o =&gt;
<span style="color: #dd22dd;">{</span>
    o.<span style="color: #721045;">AddPolicy</span><span style="color: #008899;">(</span>name: <span style="color: #3548cf;">"xxx"</span>,
                policy =&gt;
                <span style="color: #972500;">{</span>
                    policy.<span style="color: #721045;">WithOrigins</span><span style="color: #808000;">(</span><span style="color: #3548cf;">"http://127.0.0.1:5173"</span><span style="color: #808000;">)</span>;
                <span style="color: #972500;">}</span><span style="color: #008899;">)</span>;
    o.<span style="color: #721045;">AddPolicy</span><span style="color: #008899;">(</span>name: <span style="color: #3548cf;">"yyy"</span>,
                policy =&gt;
                <span style="color: #972500;">{</span>
                    policy.<span style="color: #721045;">WithOrigins</span><span style="color: #808000;">(</span><span style="color: #3548cf;">"http://127.0.0.1:5173"</span><span style="color: #808000;">)</span>
                    .<span style="color: #721045;">AllowCredentials</span><span style="color: #808000;">()</span>;
                <span style="color: #972500;">}</span><span style="color: #008899;">)</span>;
<span style="color: #dd22dd;">}</span><span style="color: #000000;">)</span>;

app.<span style="color: #721045;">UseCors</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"yyy"</span><span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 1a2y</p>
<p class="date">Created: 2023-03-16</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>