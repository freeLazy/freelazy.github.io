<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-02-27 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ASP.NET</title>
<meta name="author" content="1a2y" />
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">ASP.NET</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org94e5b2a">1. .NET</a>
<ul>
<li><a href="#org4d2e173">1.1. 历史</a></li>
<li><a href="#org706c080">1.2. 规范</a></li>
<li><a href="#orgd8ec257">1.3. 其他</a>
<ul>
<li><a href="#org13f3194">1.3.1. JIT vs AOT</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2e46c72">2. 单机 到 CS 到 BS</a></li>
<li><a href="#org43580bd">3. ASP -&gt; ASP.NET -&gt; ASP.NET Core</a></li>
<li><a href="#orga16c0aa">4. ASP.NET (Framework)</a></li>
<li><a href="#orge20d128">5. ASP.NET Webform</a>
<ul>
<li><a href="#org4884bcb">5.1. aspx 文件</a></li>
<li><a href="#org845bf47">5.2. Page 类</a></li>
<li><a href="#orgeca96eb">5.3. Page 的生命周期</a></li>
<li><a href="#org7495188">5.4. Page 的内置对象</a></li>
<li><a href="#org0fe4293">5.5. 常用控件</a>
<ul>
<li><a href="#orgd97114a">5.5.1. GridView</a></li>
<li><a href="#orge1c7ab0">5.5.2. Repeater</a></li>
</ul>
</li>
<li><a href="#org27e318c">5.6. 用户自定义控件</a></li>
<li><a href="#org14fe1f4">5.7. 其他</a>
<ul>
<li><a href="#org3ed183e">5.7.1. 路由 (Route)</a></li>
<li><a href="#orgbb2d469">5.7.2. 捆绑 (Bundle)</a></li>
<li><a href="#org6449b61">5.7.3. 网站 Logo (favicon.ico)</a></li>
<li><a href="#orgd80584e">5.7.4. IHttpHandler.IsReusable</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1228952">6. ASP.NET MVC</a>
<ul>
<li><a href="#orgf24ab64">6.1. MVC</a></li>
<li><a href="#orgc171ad9">6.2. Lifecycle</a></li>
<li><a href="#org727ab03">6.3. Action</a></li>
<li><a href="#org592c73d">6.4. Razor</a></li>
<li><a href="#org946e302">6.5. Binding/Validation</a></li>
<li><a href="#orgc3a6654">6.6. Filter</a></li>
</ul>
</li>
<li><a href="#org9b9ef2f">7. ASP.NET WebAPI</a>
<ul>
<li><a href="#orge8f9cc3">7.1. JSON</a></li>
<li><a href="#org680ebb4">7.2. WebApiConfig.cs</a></li>
<li><a href="#orgaf1b1de">7.3. Router</a></li>
<li><a href="#org0c62dfc">7.4. Action</a></li>
<li><a href="#orgb8b8cf9">7.5. Help</a></li>
</ul>
</li>
<li><a href="#org445dddf">8. .NET Core</a>
<ul>
<li><a href="#org00073ce">8.1. 跨平台开发</a></li>
<li><a href="#org342f262">8.2. dotnet 命令行工具</a></li>
<li><a href="#orgeb51a6b">8.3. C# 语法拾遗</a>
<ul>
<li><a href="#org2be1c7c">8.3.1. NULL</a></li>
<li><a href="#org6716ac1">8.3.2. 自动属性</a></li>
<li><a href="#orga4990fe">8.3.3. 插值字符串</a></li>
<li><a href="#orgef21bee">8.3.4. 初始化器</a></li>
<li><a href="#org6dff4ee">8.3.5. 模式匹配 (Patter-Match)</a></li>
<li><a href="#org853755d">8.3.6. 扩展方法</a></li>
<li><a href="#org66ef195">8.3.7. 异步编程</a></li>
<li><a href="#orgcc32f0e">8.3.8. nameof</a></li>
</ul>
</li>
<li><a href="#orgf8529c6">8.4. 软件工程</a>
<ul>
<li><a href="#org6c7ee03">8.4.1. xUnit/Moq</a></li>
</ul>
</li>
<li><a href="#org96b4954">8.5. Dependency Injection</a>
<ul>
<li><a href="#org3f41ee7">8.5.1. 分离是技术进步的象征</a></li>
<li><a href="#orgb825645">8.5.2. DI 容器是在解耦合的需求中，一步步发展出来的</a></li>
<li><a href="#org63dadcb">8.5.3. DI 容器的基本使用</a></li>
<li><a href="#orgc0de2a0">8.5.4. Autofac</a></li>
</ul>
</li>
<li><a href="#orgb4b5e87">8.6. 加密、解密</a></li>
</ul>
</li>
<li><a href="#orgfe4d7fe">9. ASP.NET Core MVC</a>
<ul>
<li><a href="#org3de7c5d">9.1. 配置文件</a></li>
<li><a href="#orgcbf2bf2">9.2. Summary</a></li>
</ul>
</li>
<li><a href="#org9ef3dd5">10. RESTful/GraphQL</a></li>
</ul>
</div>
</nav>


<section id="outline-container-org94e5b2a" class="outline-2">
<h2 id="org94e5b2a"><span class="section-number-2">1.</span> .NET</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org4d2e173" class="outline-3">
<h3 id="org4d2e173"><span class="section-number-3">1.1.</span> 历史</h3>
<div class="outline-text-3" id="text-1-1">
<p>
上世纪 90 年代末，Windows 上的开发技术分化成了多个部分:
</p>
<ul class="org-ul">
<li>精通 C/C++ 程序员，他们喜欢直接面对 Windows API 进行编程</li>
<li>有一部分人就转向了 MFC (Microsoft Foundation Class)</li>
<li>COM 编程</li>
</ul>

<p>
上述技术都存在一些问题或短板。为了应对 Internet 潮流的到来，微软决定推出新一代的技术框架。
2002 年的时候，.NET 平台就出现了。刚开始主要使用 VB，后面全面转向了 C#。
</p>

<p>
发展至今，.NET 平台现在主要有 3 个版本:
</p>
<ul class="org-ul">
<li>.NET Framework
<ul class="org-ul">
<li>微软把控</li>
<li>只能运行在 Windows 平台上面</li>
<li>最新的版本 (2022-10-25) 是 4.8</li>
<li>是内置在 Windows 操作系统下的平台</li>
</ul></li>
<li>Mono
<ul class="org-ul">
<li>由 Ximian 公司主持创建的开源项目，2004 年推出第一个版本</li>
<li>目标是创建一个跨平台的 .NET 实现</li>
<li>Unity3D 是基于 Mono</li>
<li>Xamarin 框架也是基于 Mono</li>
</ul></li>
<li>.NET Core
<ul class="org-ul">
<li>2016 年，微软决定将 .NET 平台开源并且跨平台。这时候将 Mono 收购了</li>
<li>微软决定，留两个跨平台的运行时 (Mono + .Net Core)，Core 是从头实现的</li>
<li>Core:
<ul class="org-ul">
<li>将 MVC 和 Web API 移植到了 Core 中，但是 Webform 和 WCF 等被移除了</li>
<li>Entity Framework 多年以来背负了沉重的历史包袱，因此 Core 中将其精简了，并且加入了对非关系型数据库的支持</li>
<li>微软将很多 .NET 中自带的功能抽取剥离出来放到了 NuGet 包里。这样 .NET 的核心就变得更小，而且没有太多的依赖</li>
<li>使用 Windows Desktop pack 的方法运行 Winform/WPF 等，从而可以让 Windows 上面支持更多未移植的功能</li>
</ul></li>
</ul></li>
</ul>

<p>
2020.11，微软决定，将原本要推出的 .NET Core 3.1 改名为 .NET5，并承诺未来只有一个 .NET 平台，每年将会推出一个新的版本。
</p>
</div>
</div>

<div id="outline-container-org706c080" class="outline-3">
<h3 id="org706c080"><span class="section-number-3">1.2.</span> 规范</h3>
<div class="outline-text-3" id="text-1-2">
<p>
为了保持多个平台之间的一致性，防止出现碎片化和分化，微软推出了 <b>.NET Standard</b> (标准/规范):
</p>
<ul class="org-ul">
<li><a href="https://github.com/dotnet/standard/blob/v2.1.0/docs/versions/netstandard2.1.md">https://github.com/dotnet/standard/blob/v2.1.0/docs/versions/netstandard2.1.md</a></li>
<li>它提供了一系列的 API 规范。要求所有的平台都要去实现这些 API</li>
<li>.NET Framework 支持到了 Standard 2.0，Core 和 Mono 支持到了 2.1。C# 8 的一些特性需要 2.1 标准的支持</li>
</ul>

<p>
为了让不同的编程语言都能在 .NET 平台上和谐有序协作运行，微软定义了一系列的规范，称作 <b>CLI</b> (Common Language Infrastructure，即通用语言基础设施):
</p>
<ul class="org-ul">
<li>通过 CLS (Common Language Specification) 阐述了运行在平台上的诸多语言需要遵循的基本规范</li>
<li>通过 CTS (Common Type System) 定义了 .NET 平台上通用的内置类型，包括但不限于对象模型、基本元数组类型的库等</li>
<li>通过 <b>CIL</b> (Common Intermedia Language) 规范了编译成的中间码的格式跟规范</li>
<li>它还包括 CLR/BCL/Metadata 等的定义 (CLR 可以看做 CLI 规范的一个实现）</li>
<li>注: .NET = <b>SDK</b> (Software Development Kit, 开发工具包) + <b>CLR</b> (Common Language Runtime，通用运行时)</li>
<li>后来 CLI 被提交到了国际化标准组织，成为了一个通用的国际标准</li>
</ul>
</div>
</div>

<div id="outline-container-orgd8ec257" class="outline-3">
<h3 id="orgd8ec257"><span class="section-number-3">1.3.</span> 其他</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org13f3194" class="outline-4">
<h4 id="org13f3194"><span class="section-number-4">1.3.1.</span> JIT vs AOT</h4>
<div class="outline-text-4" id="text-1-3-1">
<ul class="org-ul">
<li>JIT (Just In Time)</li>
<li>AOT (Ahead Of Time)</li>
</ul>

<pre class="example">
.cs -&gt; .dll (IL) -&gt; 机器码
.cs   -----------&gt; 机器码
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org2e46c72" class="outline-2">
<h2 id="org2e46c72"><span class="section-number-2">2.</span> 单机 到 CS 到 BS</h2>
<div class="outline-text-2" id="text-2">
<p>
要注意，.NET 跟 C# 不是一样的概念：
</p>
<pre class="example">
   编译器                  运行
C#   -&gt;   中间码(IL) -&gt;   (.NET)  -&gt; 机器码
F#
VB
JS
Java

.java -&gt; .class -&gt; (JVM) -&gt; 机器码
kotlin
groovy
clojue
scala
</pre>


<p>
经典、传统软件 (桌面软件):
</p>
<ul class="org-ul">
<li>语言: C/C++/C#/Java/OC/Swift</li>
<li>技术: Winform/WPF/UWP/MaUI Qt/GTK</li>
</ul>

<p>
单机软件不符合应用场景，多机协助成了最大需求。
最终，出现了 CS (Client-Server) 架构。
</p>
<ul class="org-ul">
<li>多机通信使用 Socket，但是 Socket 需要处理太多细节，比较麻烦</li>
<li>都要从 0 开始构建底层界面</li>
<li>BS 能干的事情，CS <b>一定</b> 可以做到而且可以干的更好，但是 CS 要花费更高的 <b>成本</b></li>
<li>CS 能干的事情，BS 不一定能做到。CS 的客户端可以对系统进行完全的控制，它可以实现浏览器无法实现的很多行为</li>
<li>BS 架构，通过放弃了一些东西，成功降低了各种成本:
<ul class="org-ul">
<li>学习成本低</li>
<li>开发成本低</li>
<li>使用成本低</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">h1</span><span style="color: #000000;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#26631;&#39064;</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">h1</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">form</span> <span style="color: #005e8b;">action</span>=<span style="color: #3548cf;">"xxx"</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">input</span> <span style="color: #005e8b;">type</span>=<span style="color: #3548cf;">"submit"</span> <span style="color: #005e8b;">value</span>=<span style="color: #3548cf;">"&#28857;&#25105;&#21457;&#36865;"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">form</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
任务:
</p>
<ul class="org-ul">
<li>什么是 CS 架构，什么是 BS 架构?</li>
<li>CS 架构跟 BS 架构相比，各有什么优劣?</li>
<li>整理资料，了解浏览器的发展历史</li>
</ul>

<p>
360/&#x2026;.很多野生浏览器:
</p>
<ul class="org-ul">
<li>当时 IE 你不能不用，而且多个版本之间还有差别。IE6</li>
<li>当时先进生产力的代表是 Firefox, Chrome, Opera 等更加贴近标准的浏览器</li>
<li>双(多)核浏览器+兼容</li>
</ul>
</div>
</section>


<section id="outline-container-org43580bd" class="outline-2">
<h2 id="org43580bd"><span class="section-number-2">3.</span> ASP -&gt; ASP.NET -&gt; ASP.NET Core</h2>
<div class="outline-text-2" id="text-3">
<p>
大致分为三个阶段:
</p>
<ol class="org-ol">
<li>1996 年左右，ASP (Active Server Page), 使用的开发语言是 VB</li>
<li>2002 年左右，随着 .NET 平台出现，推出了 ASP.NET 技术</li>
<li>2015 年左右，微软开始推出跨平台的 .NET，称作 .NET Core</li>
</ol>
</div>
</section>

<section id="outline-container-orga16c0aa" class="outline-2">
<h2 id="orga16c0aa"><span class="section-number-2">4.</span> ASP.NET (Framework)</h2>
<div class="outline-text-2" id="text-4">
<p>
Pipeline (管道/管线) 模型:
</p>
<ul class="org-ul">
<li>最核心的接口: <code>IHttpHandler/IHttpHandlerFactory</code>, <code>IHttpModule</code></li>
<li>最核心的配置文件: Web.config</li>
<li>比较重要的类: HttpApplication, HttpContext</li>
</ul>

<p>
Pipeline 中标准的 19 个事件:
<img src="img/oimg_20220920_070127.png" alt="oimg_20220920_070127.png">
Global.asax:
</p>
<ul class="org-ul">
<li>Application_Start/End</li>
<li>Session_Start/End</li>
<li>Application_BeginRequest/AuthenticateRequest/Error</li>
</ul>

<p>
部署:
</p>
<ul class="org-ul">
<li>环境: Windows + SqlServer + IIS</li>
<li>IIS 是缩写，全称 Internet Information Services (互联网信息服务 ), 是由微软公司提供的基于运行 .NET 的互联网基本服务。</li>
<li>步骤:
<ol class="org-ol">
<li>开发项目，通过【发布】导出要部署的项目文件夹</li>
<li>在服务器上安 Windows 操作系统</li>
<li>在 Windows 中安装 SqlServer 数据库</li>
<li>在 Windows 中启用 IIS 服务器</li>
<li>在 IIS 管理器中，为项目文件夹创建新的【网站】</li>
<li>注意整个过程中的【权限】和【防火墙】问题</li>
</ol></li>
</ul>
</div>
</section>


<section id="outline-container-orge20d128" class="outline-2">
<h2 id="orge20d128"><span class="section-number-2">5.</span> ASP.NET Webform</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org4884bcb" class="outline-3">
<h3 id="org4884bcb"><span class="section-number-3">5.1.</span> aspx 文件</h3>
<div class="outline-text-3" id="text-5-1">
<p>
首先，可以将 aspx 文件看做一个加强版的 html 文件，所以，它完全接受 html 语法。
</p>

<p>
因此创建一个 Hello.aspx 文件，内容如下:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">h1</span><span style="color: #000000;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#25105;&#26159; Hello.aspx &#25991;&#20214;&#65292;&#25152;&#26377;&#30340; html &#20195;&#30721;&#22312;&#36825;&#37324;&#37117;&#20250;&#34987;&#21407;&#26679;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">h1</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span> &#20854;&#20182;&#30340;&#25110;&#31616;&#21333;&#25110;&#22797;&#26434;&#30340; html/js/css &#20195;&#30721; <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
运行项目，可以通过 <code>https://localhost:port/Hello.aspx</code> 访问这个页面。浏览器中查看源代码可以看到内容跟上述一致。
</p>

<p>
接下来，aspx 接受行内表达式语法。这种语法来源于之前的 asp 时代，是在 html 内嵌 C#/VB 代码的一种方式 (<a href="https://learn.microsoft.com/en-us/troubleshoot/developer/webapps/aspnet/development/inline-expressions">官方链接</a>)。
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">h1</span><span style="color: #000000;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#25105;&#26159; Hello.aspx &#25991;&#20214;&#65292;&#25152;&#26377;&#30340; html &#20195;&#30721;&#22312;&#36825;&#37324;&#37117;&#20250;&#34987;&#21407;&#26679;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">h1</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span> &#20854;&#20182;&#30340;&#25110;&#31616;&#21333;&#25110;&#22797;&#26434;&#30340; html/js/css &#20195;&#30721; <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>% Response.Write<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"&#36890;&#36807;&#34892;&#20869;&#34920;&#36798;&#24335;&#65292;&#21487;&#20197;&#22312;&#25991;&#20214;&#20013;&#23884;&#20837; C# &#20195;&#30721;&#20102;&#65281;"</span><span style="color: #dd22dd;">)</span>; %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>% Response.Write<span style="color: #dd22dd;">(</span>Request.UserAgent<span style="color: #dd22dd;">)</span>; %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>%
      string a = <span style="color: #3548cf;">"&#21487;&#20197;&#20889;&#24456;&#22810;&#20195;&#30721;&#65292;&#22312;&#36825;&#37324;"</span>;
      string c = <span style="color: #3548cf;">"&#29616;&#22312;&#65292;&#23450;&#20041;&#19968;&#20010;&#21464;&#37327;&#65292;&#21518;&#38754;&#20351;&#29992;"</span>;
    %<span style="color: #000000;">&gt;</span>

    <span style="color: #000000;">&lt;</span>% Response.Write<span style="color: #dd22dd;">(</span>c<span style="color: #dd22dd;">)</span>; %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>%-- &#25105;&#26159;&#19968;&#20010;&#27880;&#37322;: &#19979;&#38754;&#30340;&#19968;&#34892;&#20195;&#30721;&#65292;&#26159;&#19978;&#38754;&#20195;&#30721;&#30340;&#35821;&#27861;&#31958; --%<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>%= c <span style="color: #000000;">&gt;</span>

    <span style="color: #000000;">&lt;</span>%= <span style="color: #3548cf;">"&lt;div&gt;&#20320;&#22909;&lt;/div&gt;"</span> %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>%-- &#20351;&#29992; <span style="color: #005e8b;">%:</span> &#36827;&#34892;&#33258;&#21160;&#26684;&#24335;&#21270;&#36755;&#20986; --%<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>% Response.Write<span style="color: #dd22dd;">(</span>HttpUtility.HtmlEncode<span style="color: #008899;">(</span><span style="color: #3548cf;">"&lt;div&gt;&#20320;&#22909;&lt;/div&gt;"</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>; %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>%= HttpUtility.HtmlEncode<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"&lt;div&gt;&#20320;&#22909;&lt;/div&gt;"</span><span style="color: #dd22dd;">)</span> %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #005e8b;">%:</span> <span style="color: #3548cf;">"&lt;div&gt;&#20320;&#22909;&lt;/div&gt;"</span> %<span style="color: #000000;">&gt;</span>

    <span style="color: #000000;">&lt;</span>%# Button1.Controls %<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>%#: Button1.Controls %<span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
微软说，时代变了，行内表达式容易导致逻辑跟页面混淆，不便于维护和复用。亲，建议使用控件。
控件的使用方法，跟 Winform 中实在太像了:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">form</span> <span style="color: #005e8b;">id</span>=<span style="color: #3548cf;">"form1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span><span style="color: #000000;">&gt;</span>
     <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Calendar</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"Calendar1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span><span style="color: #000000;">&gt;&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Calendar</span><span style="color: #000000;">&gt;</span>
     <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Button</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"Button1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">OnClick</span>=<span style="color: #3548cf;">"Button1_Click"</span> <span style="color: #005e8b;">Text</span>=<span style="color: #3548cf;">"Button"</span> /<span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">form</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
如果是方法等大段的 C# 代码，可以写在 script runat server 里面:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">script</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span><span style="color: #000000;">&gt;</span>
      <span style="color: #531ab6;">public</span> string MyName = <span style="color: #3548cf;">"&#30495;&#38590;"</span>;
      <span style="color: #531ab6;">public</span> string HelloWorld<span style="color: #000000;">()</span> <span style="color: #000000;">{</span> <span style="color: #531ab6;">return</span> <span style="color: #3548cf;">"HelloWorld"</span>; <span style="color: #000000;">}</span>
      <span style="color: #531ab6;">public</span> string MyCalender<span style="color: #000000;">()</span> <span style="color: #000000;">{</span> <span style="color: #531ab6;">return</span> <span style="color: #3548cf;">"&lt;div&gt;&#25105;&#26159;&#19968;&#20010;&#24040;&#22797;&#26434;&#30340;&#26085;&#21382;&lt;/div&gt;"</span>; <span style="color: #000000;">}</span>
      <span style="color: #531ab6;">protected</span> <span style="color: #531ab6;">void</span> <span style="color: #005e8b;">Button1_Click</span><span style="color: #000000;">(</span>object sender, EventArgs e<span style="color: #000000;">)</span> <span style="color: #000000;">{</span> <span style="color: #000000;">}</span>
  <span style="color: #000000;">&lt;</span>/script<span style="color: #000000;">&gt;</span>

  <span style="color: #000000;">&lt;</span>%= MyCalender<span style="color: #dd22dd;">()</span> %<span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Calendar</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"Calendar1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span><span style="color: #000000;">&gt;&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Calendar</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
但是上述 C# 代码写在 aspx 文件里，开发成本和维护成本都比较高，所以能不能有一种机制将其<b>分离</b>出去?
有的，有的。使用页面指令，指定外部 csharp 文件即可:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span>%@ Page <span style="color: #005e8b;">Language</span>=<span style="color: #3548cf;">"C#"</span> <span style="color: #005e8b;">AutoEventWireup</span>=<span style="color: #3548cf;">"true"</span> <span style="color: #005e8b;">CodeBehind</span>=<span style="color: #3548cf;">"Balala.cs"</span> <span style="color: #005e8b;">Inherits</span>=<span style="color: #3548cf;">"WebApplication2.Balala"</span> %<span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
于是，就可以创建文件 Balala.cs 在里面专注于数据和业务逻辑，之后让 aspx 专注于页面展现了（模型与视图分离的思想）。
</p>

<p>
这个 Balala.cs 需要写成类似这个样子:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">namespace</span> <span style="color: #005e8b;">WebApplication2</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">public</span> <span style="color: #531ab6;">partial</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">Balala</span> : <span style="color: #005f5f;">Page</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">MyName</span> = <span style="color: #3548cf;">"&#30495;&#38590;"</span>;
        <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #721045;">HelloWorld</span><span style="color: #008899;">()</span>
        <span style="color: #008899;">{</span>
            <span style="color: #531ab6;">return</span> <span style="color: #3548cf;">"HelloWorld"</span>;
        <span style="color: #008899;">}</span>
        <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #721045;">MyCalender</span><span style="color: #008899;">()</span>
        <span style="color: #008899;">{</span>
            <span style="color: #531ab6;">return</span> <span style="color: #3548cf;">"&lt;div&gt;&#25105;&#26159;&#19968;&#20010;&#24040;&#22797;&#26434;&#30340;&#26085;&#21382;&lt;/div&gt;"</span>;
        <span style="color: #008899;">}</span>
        <span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Button1_Click</span><span style="color: #008899;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #008899;">)</span>
        <span style="color: #008899;">{</span>
        <span style="color: #008899;">}</span>
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
通过以上操作，一个完整的 Web 窗体就有了。
</p>

<p>
另外，不同的页面往往在整体的布局存在很多相似之处，不同页面存在大量雷同代码。
为了简化在 aspx 中构建页面，可以通过母版的方式，将整体的页面布局代码分离到外面 (挖坑-填坑)，
达到共用布局的目的。
</p>

<p>
方法很简单，首先，要创建一个母版文件。它跟 aspx 很像，只是文件的后缀和页面指令不同。比如，创建一个 yyy.Master 母版:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span>%@ Master <span style="color: #005e8b;">Language</span>=<span style="color: #3548cf;">"C#"</span> %<span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span><span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">head</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">title</span><span style="color: #000000;">&gt;&lt;</span>/<span style="color: #721045;">title</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">ContentPlaceHolder</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"head"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">head</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">body</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">aside</span><span style="color: #000000;">&gt;</span>
        &#33756;&#21333;
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">aside</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">class</span>=<span style="color: #3548cf;">"main"</span><span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">ContentPlaceHolder</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"main"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">body</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">html</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
通过使用 <code>asp:ContentPlaceHolder</code> 挖坑。使用这个母版的 aspx 文件，只需要用 <code>asp:Content</code> 填坑即可。
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span>%@ Page <span style="color: #005e8b;">Language</span>=<span style="color: #3548cf;">"C#"</span> <span style="color: #005e8b;">AutoEventWireup</span>=<span style="color: #3548cf;">"true"</span>
    <span style="color: #005e8b;">MasterPageFile</span>=<span style="color: #3548cf;">"~/yyy.Master"</span>
    <span style="color: #005e8b;">CodeBehind</span>=<span style="color: #3548cf;">"WebForm2.aspx.cs"</span> <span style="color: #005e8b;">Inherits</span>=<span style="color: #3548cf;">"WebApplication2.WebForm2"</span> %<span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Content</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">ContentPlaceHolderID</span>=<span style="color: #3548cf;">"head"</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">style</span><span style="color: #000000;">&gt;</span>
        <span style="color: #531ab6;">.main </span><span style="color: #000000;">{</span>
            <span style="color: #005f5f;">background</span>: <span style="color: #000000; background-color: #ffffe0;">lightyellow</span>;
            <span style="color: #005f5f;">height</span>: 200px;
        <span style="color: #000000;">}</span>
    <span style="color: #000000;">&lt;</span>/style<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Content</span><span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Content</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">ContentPlaceHolderID</span>=<span style="color: #3548cf;">"main"</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"color: red;"</span><span style="color: #000000;">&gt;</span>
        &#25105;&#26159;&#21478;&#22806;&#30340;&#19968;&#20010;&#39029;&#38754;
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Content</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
就这样，就实现了页面布局的可重复使用。编码可以更灵活了。
</p>
</div>
</div>

<div id="outline-container-org845bf47" class="outline-3">
<h3 id="org845bf47"><span class="section-number-3">5.2.</span> Page 类</h3>
<div class="outline-text-3" id="text-5-2">
<p>
你 (Browser) 请求 <a href="http://localhost:893232/Hello.aspx">http://localhost:893232/Hello.aspx</a> 到我 (IIS):
</p>
<ul class="org-ul">
<li>首先，查找 aspx 有没有对应的编译文件。如果有，执行之；否则，先编译，后执行之</li>
<li>aspx 会被动态转换为相应的 csharp 文件，之后会被编译进 dll 中 (HttpRuntime.CodegenDir)</li>
<li>aspx 文件实质是 <code>Page</code> 的一个子类，它实现了 <code>IHttpHandler</code> 接口</li>
<li>aspx 还实现了 <code>IRequiresSessionState</code> 接口，因此可以在 aspx 中自由使用 Session</li>
<li>在父类 Page 中，定义了控件加载的逻辑和页面渲染的逻辑</li>
<li>在父类 Page 中，初始化了很多属性和方法，可以直接使用</li>
<li>因此，掌握 Page 类的<b>生命周期</b>和 Page 的基本方法属性非常重要</li>
</ul>
</div>
</div>

<div id="outline-container-orgeca96eb" class="outline-3">
<h3 id="orgeca96eb"><span class="section-number-3">5.3.</span> Page 的生命周期</h3>
<div class="outline-text-3" id="text-5-3">

<figure id="org1287fd7">
<img src="img/oimg_20220928_005325.png" alt="oimg_20220928_005325.png">

</figure>

<p>
PreInit:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_PreInit</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#36890;&#36807;&#26816;&#26597; IsPostBack &#26469;&#30830;&#23450;&#39029;&#38754;&#26159;&#21542;&#26159;&#31532;&#19968;&#27425;&#34987;&#21152;&#36733;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#21019;&#24314;(&#25110;&#37325;&#24314;)&#26381;&#21153;&#22120;&#25511;&#20214;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#35774;&#32622;&#27597;&#29256; (Master)</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">4. &#35774;&#32622;&#20027;&#39064; (Theme)</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">&#27880;&#24847;: &#22914;&#26524;&#39029;&#38754;&#26159; postback &#37027;&#20040;&#25511;&#20214;&#30340;&#20540;&#36824;&#27809;&#26377;&#34987;&#24674;&#22797;&#65292;&#22240;&#27492;&#20320;&#22312;&#36825;&#20010;&#38454;&#27573;&#35774;&#32622;&#30340;&#25511;&#20214;&#20540;&#20063;&#35768;&#20250;&#34987;&#35206;&#30422;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
Init:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_Init</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#36825;&#20010;&#20107;&#20214;&#26159;&#22312;&#25152;&#26377;&#25511;&#20214;&#37117;&#34987;&#21021;&#22987;&#21270;&#20043;&#21518;&#34987;&#35302;&#21457;&#30340;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#20026;&#27599;&#20010;&#25511;&#20214;&#35774;&#32622; UniqueID&#65292;&#24182;&#19988;&#24212;&#29992;&#30382;&#32932;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#21487;&#20197;&#20351;&#29992;&#36825;&#20010;&#20107;&#20214;&#26469;&#35835;&#21462;&#25110;&#21021;&#22987;&#21270;&#25511;&#20214;&#30340;&#23646;&#24615;&#65288;&#65281;&#65281;&#65281;&#65289;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">4. &#22312;&#25511;&#20214;&#26641;&#20013;&#65292;Init &#20107;&#20214;&#26159;&#30001;&#20869;&#32780;&#22806;&#30340;&#39034;&#24207;&#35302;&#21457;&#30340;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
InitComplete:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_InitComplete</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#22312;&#36825;&#20010;&#38454;&#27573;&#65292;viewstate &#20540;&#36824;&#27809;&#26377;&#34987;&#21152;&#36733;&#12290;</span>
    <span style="color: #595959;">//    </span><span style="color: #595959;">&#22240;&#27492;&#24744;&#21487;&#20197;&#20351;&#29992;&#27492;&#20107;&#20214;&#23545;&#35270;&#22270;&#29366;&#24577;&#36827;&#34892;&#26356;&#25913;&#65292;&#20197;&#30830;&#20445;&#22312;&#19979;&#19968;&#27425; postback &#21518;&#20445;&#30041;&#36825;&#20123;&#26356;&#25913;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#36825;&#20010;&#20107;&#20214;&#26159;&#34987; Page &#23545;&#35937;&#35302;&#21457;&#30340;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#22914;&#26524;&#38656;&#35201;&#25152;&#26377;&#21021;&#22987;&#21270;&#24037;&#20316;&#23436;&#25104;&#25165;&#33021;&#25191;&#34892;&#30340;&#20219;&#21153;&#65292;&#21487;&#20197;&#20889;&#22312;&#36825;&#37324;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
OnPreLoad:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">OnPreLoad</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">&#26159;&#22312; Page &#23545;&#35937;&#24050;&#32463;&#21152;&#36733;&#20102; ViewState &#20013;&#30340;&#20540;&#12289;&#24182;&#21152;&#36733;&#23436;&#25104;&#25152;&#26377;&#25511;&#20214;&#12289;&#24182;&#36890;&#36807; request &#21442;&#25968;&#22788;&#29702;&#23436; postback &#25968;&#25454;&#20043;&#21518;&#65292;&#25165;&#35302;&#21457;&#30340;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
Load:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_Load</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. Page &#23545;&#35937;&#20250;&#25191;&#34892; Page &#19978;&#38754;&#30340; OnLoad &#26041;&#27861;&#65292;&#28982;&#21518;&#36882;&#24402;&#22320;&#25191;&#34892;&#23376;&#25511;&#20214;&#30340; OnLoad &#26041;&#27861;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#36825;&#26159;&#22312;&#29983;&#21629;&#21608;&#26399;&#20013;&#65292;&#31532;&#19968;&#20010;&#25152;&#26377;&#30340;&#20540;&#37117;&#34987;&#23436;&#20840;&#24674;&#22797;&#20102;&#30340;&#38454;&#27573;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#32477;&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#21487;&#20197;&#36890;&#36807;&#26816;&#26597; IsPostBack &#30340;&#20540;&#26469;&#36991;&#20813;&#19981;&#24517;&#35201;&#30340;&#37325;&#32622;&#29366;&#24577;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">4. &#22312;&#36825;&#37324;&#65292;&#36866;&#21512;&#36827;&#34892;&#36755;&#20837;&#39564;&#35777;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">5. &#22312;&#36825;&#37324;&#65292;&#36866;&#21512;&#21160;&#24577;&#21019;&#24314;&#12289;&#28155;&#21152;&#32452;&#20214;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">6. &#22312;&#36825;&#37324;&#65292;&#36866;&#21512;&#35843;&#25972;&#25511;&#20214;&#30340;&#23646;&#24615;&#65292;&#36866;&#21512;&#21019;&#24314;&#25968;&#25454;&#24211;&#36830;&#25509;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
控件上的 PostBack 事件:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Button1_Click</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. ASP.NET &#29616;&#22312;&#20250;&#35843;&#29992;&#25152;&#26377;&#22312; Page &#25110;&#23376;&#25511;&#20214;&#19978;&#30340;&#33021;&#23548;&#33268; PostBack &#30340;&#20107;&#20214;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#20351;&#29992;&#36825;&#20123;&#20107;&#20214;&#65292;&#21487;&#20197;&#22788;&#29702;&#27604;&#22914; Button &#28857;&#20987;&#12289;TextBox &#30340;&#25991;&#26412;&#21464;&#21160;&#31561;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
LoadComplete:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_LoadComplete</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#22312;&#20107;&#20214;&#22788;&#29702;&#38454;&#27573;&#30340;&#26368;&#21518;&#34987;&#35302;&#21457;&#30340;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#36825;&#37324;&#36866;&#21512;&#25152;&#26377;&#30340;&#20854;&#20182;&#25511;&#20214;&#37117;&#34987;&#23436;&#20840;&#21152;&#36733;&#20043;&#21518;&#30340;&#20219;&#21153;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
OnPreRender:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">OnPreRender</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#22312;&#25152;&#26377;&#30340;&#23545;&#35937;&#37117;&#24050;&#32463;&#23436;&#20840;&#20934;&#22791;&#22909;&#30340;&#24773;&#20917;&#19979;&#35302;&#21457;&#30340;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#20808;&#26159; Page &#19978;&#30340; OnPreRender &#34987;&#25191;&#34892;&#65292;&#28982;&#21518;&#36882;&#24402;&#25191;&#34892;&#23376;&#25511;&#20214;&#19978;&#30340; OnPreRender</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#20801;&#35768;&#23545;&#39029;&#38754;&#25110;&#20854;&#25511;&#20214;&#36827;&#34892;&#26368;&#32456;&#26356;&#25913;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">4. &#36825;&#20010;&#20107;&#20214;&#21457;&#29983;&#22312;&#20445;&#23384; ViewState &#20043;&#21069;&#65292;&#25152;&#20197;&#22312;&#36825;&#37324;&#20570;&#30340;&#20219;&#20309;&#20462;&#25913;&#37117;&#23558;&#34987;&#20445;&#23384;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">5. &#35774;&#32622;&#20102; DataSourceID &#23646;&#24615;&#30340;&#27599;&#20010;&#25968;&#25454;&#32465;&#23450;&#25511;&#20214;&#37117;&#35843;&#29992;&#20854; DataBind &#26041;&#27861;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">6. &#36825;&#37324;&#36866;&#21512;&#29992;&#26469;&#23545; Page &#25110;&#25511;&#20214;&#36827;&#34892;&#26368;&#21518;&#30340;&#35843;&#25972;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
OnSaveStateComplete:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">OnSaveStateComplete</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#22312;&#39029;&#38754;&#21644;&#25511;&#20214;&#30340; ViewState &#24050;&#32463;&#34987;&#20445;&#23384;&#20043;&#21518;&#35302;&#21457;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#22312;&#36825;&#37324;&#23545;&#39029;&#38754;&#25110;&#25511;&#20214;&#30340;&#20462;&#25913;&#65292;&#20250;&#34987;&#24573;&#30053;&#25481;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#36825;&#37324;&#36866;&#21512;&#19981;&#24819;&#25913;&#21464; ViewState &#30340;&#19968;&#20123;&#21892;&#21518;&#24037;&#20316;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
Render-Method:
</p>
<ul class="org-ul">
<li>Render 方法存在于 Page 对象和其子控件中</li>
<li>这个阶段，其实就是 ASP.NET 拼接 html 字符串，响应给用户的过程</li>
</ul>

<p>
Unload:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_Unload</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">1. &#36825;&#20010;&#26041;&#27861;&#29992;&#26469;&#36827;&#34892;&#28165;&#29702;&#24037;&#20316;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">2. &#22312;&#36825;&#20010;&#38454;&#27573;&#65292;&#25152;&#26377;&#24037;&#20316;&#37117;&#24050;&#32463;&#23436;&#25104;&#65292;&#21487;&#20197;&#25918;&#24515;&#37322;&#25918;&#20219;&#20309;&#36164;&#28304;&#65292;&#21253;&#25324; Page &#23545;&#35937;</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">3. &#22312;&#36825;&#37324;&#65292;&#19981;&#33021;&#20351;&#29992; Response.Write &#36755;&#20986;&#20869;&#23481;&#65292;&#21542;&#21017;&#20250;&#25253;&#38169;</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
参考: <a href="https://www.c-sharpcorner.com/UploadFile/8911c4/page-life-cycle-with-examples-in-Asp-Net/">https://www.c-sharpcorner.com/UploadFile/8911c4/page-life-cycle-with-examples-in-Asp-Net/</a>
</p>
</div>
</div>

<div id="outline-container-org7495188" class="outline-3">
<h3 id="org7495188"><span class="section-number-3">5.4.</span> Page 的内置对象</h3>
<div class="outline-text-3" id="text-5-4">
<p>
所谓的内置对象，是指在 Page 类中被初始化，从而在 aspx 中能直接使用的对象。
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span>%=Request<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"id"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Request.QueryString<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"id"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Request.Form<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"id"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Request.Params<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"id"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Request.Files<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"id"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Request.UserAgent %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Request.Headers<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"location"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span>%=ViewState<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"kkkkk"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>% ViewState<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"kkkkk"</span><span style="color: #dd22dd;">]</span> = 333; %<span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span>%=Request.Cookies<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"Asp_Net.SessionId"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Response.Cookies<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"ssss"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Session<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"ksdkfj"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span>% Application<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"&#32593;&#31449;url"</span><span style="color: #dd22dd;">]</span> = <span style="color: #3548cf;">"xxxx"</span>; %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>%=Application<span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"&#24635;&#20849;&#35775;&#38382;&#30340;&#25968;&#30446;"</span><span style="color: #dd22dd;">]</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>&#35775;&#38382;&#27425;&#25968;: <span style="color: #000000;">&lt;</span>%= new Random<span style="color: #dd22dd;">()</span>.Next<span style="color: #dd22dd;">()</span> %<span style="color: #000000;">&gt;&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span>%=Server.MapPath<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"/UploadedFiles"</span><span style="color: #dd22dd;">)</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>% Server.Transfer<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"Logon.aspx"</span>, true<span style="color: #dd22dd;">)</span>; %<span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
Code Action Task:
</p>
<pre class="example" id="org4c8863f">
----------------------    -------
| .                  |    | 验证 |
----------------------    -------

如果输入的内容长度小于5，下面用红色的字，提示:
: 您输入的内容不合格，请重新再填！
然后情况输入框，将光标 focus 到 input 框。

如果输入的内容合格，下面用绿色的字提示：
: 恭喜您，验证通过。
然后，将输入框变成只读状态。
</pre>

<details><summary>参考答案</summary><br />

<p>
标注着 runat=server 的控件上的状态，
在每次请求的时候，都会被通过 _ViewState 的方式自动传递着。
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">TextBox</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"tb1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Button</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"bt1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">Text</span>=<span style="color: #3548cf;">"&#39564;&#35777;"</span> <span style="color: #005e8b;">OnClick</span>=<span style="color: #3548cf;">"bt1_Click"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Label</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"lb1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">bt1_Click</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">if</span> <span style="color: #dd22dd;">(</span>tb1.Text.Length &lt; 5<span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        lb1.Text = <span style="color: #3548cf;">"&#24744;&#36755;&#20837;&#30340;&#20869;&#23481;&#19981;&#21512;&#26684;&#65292;&#35831;&#37325;&#22635;&#12290;"</span>;
        lb1.ForeColor = System.Drawing.Color.Red;
        tb1.Text = String.Empty;
        tb1.<span style="color: #721045;">Focus</span><span style="color: #008899;">()</span>;
    <span style="color: #dd22dd;">}</span>
    <span style="color: #531ab6;">else</span>
    <span style="color: #dd22dd;">{</span>
        lb1.Text = <span style="color: #3548cf;">"&#24685;&#21916;&#24744;&#65292;&#39564;&#35777;&#36890;&#36807;"</span>;
        lb1.ForeColor = System.Drawing.Color.Green;
        tb1.ReadOnly = <span style="color: #0000b0;">true</span>;
        bt1.Enabled = <span style="color: #0000b0;">false</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>
</details><br/>

<p>
Code Action Task:
</p>
<pre class="example" id="org029bf80">
在页面中，显示:
: 这是本页面在 Page 生命中，被访问的第 N 次。

这个例子用来理解如何使用 ViewState 对象。
</pre>

<details><summary>参考答案</summary><br />

<p>
第一种方案，借助 <code>asp:HiddenField</code> 控件，曲线救国。
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">HiddenField</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"hf1"</span> <span style="color: #005e8b;">Value</span>=<span style="color: #3548cf;">"0"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
    &#36825;&#26159;&#26412;&#39029;&#38754;&#22312; Page &#29983;&#21629;&#20013;&#65292;&#34987;&#35775;&#38382;&#30340;&#31532; <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Label</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"sd"</span> <span style="color: #005e8b;">Text</span>=<span style="color: #3548cf;">"&lt;%# hf1.Value %&gt;"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span>/<span style="color: #000000;">&gt;</span> &#27425;&#12290;
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_Load</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    hf1.Value = <span style="color: #dd22dd;">(</span><span style="color: #005f5f;">int</span>.<span style="color: #721045;">Parse</span><span style="color: #008899;">(</span>hf1.Value<span style="color: #008899;">)</span> + 1<span style="color: #dd22dd;">)</span>.<span style="color: #721045;">ToString</span><span style="color: #dd22dd;">()</span>;
    sd.<span style="color: #721045;">DataBind</span><span style="color: #dd22dd;">()</span>;
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
第二种方案，使用 ViewState 对象，即手动模式。
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
    &#36825;&#26159;&#26412;&#39029;&#38754;&#22312; Page &#29983;&#21629;&#20013;&#65292;&#34987;&#35775;&#38382;&#30340;&#31532; <span style="color: #000000;">&lt;</span>%= VisitCount %<span style="color: #000000;">&gt;</span> &#27425;&#12290;
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">VisitCount</span> <span style="color: #000000;">{</span>
    <span style="color: #531ab6;">get</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #531ab6;">return</span> ViewState<span style="color: #008899;">[</span><span style="color: #3548cf;">"vc"</span><span style="color: #008899;">]</span> != <span style="color: #0000b0;">null</span> ? <span style="color: #008899;">(</span><span style="color: #005f5f;">int</span><span style="color: #008899;">)</span>ViewState<span style="color: #008899;">[</span><span style="color: #3548cf;">"vc"</span><span style="color: #008899;">]</span> : 0;
    <span style="color: #dd22dd;">}</span>
    <span style="color: #531ab6;">set</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #005f5f;">ViewState</span><span style="color: #008899;">[</span><span style="color: #3548cf;">"vc"</span><span style="color: #008899;">]</span> = <span style="color: #0000b0;">value</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_Load</span><span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    VisitCount += 1;
<span style="color: #000000;">}</span>
</pre>
</div>

</details>
</div>
</div>

<div id="outline-container-org0fe4293" class="outline-3">
<h3 id="org0fe4293"><span class="section-number-3">5.5.</span> 常用控件</h3>
<div class="outline-text-3" id="text-5-5">
</div>
<div id="outline-container-orgd97114a" class="outline-4">
<h4 id="orgd97114a"><span class="section-number-4">5.5.1.</span> GridView</h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
<a href="https://learn.microsoft.com/zh-cn/dotnet/api/system.web.ui.webcontrols.gridview?view=netframework-4.8">https://learn.microsoft.com/zh-cn/dotnet/api/system.web.ui.webcontrols.gridview?view=netframework-4.8</a>
</p>

<p>
最简方式:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">SqlDataSource</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"DS1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span>
                   <span style="color: #005e8b;">SelectCommand</span>=<span style="color: #3548cf;">"select * from students"</span>
                   <span style="color: #005e8b;">ConnectionString</span>=<span style="color: #3548cf;">"&lt;%$ ConnectionStrings: mydb %&gt;"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">GridView</span> <span style="color: #005e8b;">DataSourceID</span>=<span style="color: #3548cf;">"DS1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
编程方式的数据源:
</p>
<div class="org-src-container">
<pre class="src src-csharp">studentsGV.DataSource =
    DbHelper.<span style="color: #721045;">DoExecuteQuery</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"select * from students"</span><span style="color: #000000;">)</span>;
studentsGV.<span style="color: #721045;">DataBind</span><span style="color: #000000;">()</span>;
</pre>
</div>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">GridView</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"studentsGV"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
</pre>
</div>

<p>
灵活定义视图格式:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">GridView</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"studentsGV"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span>
    <span style="color: #005e8b;">ShowFooter</span>=<span style="color: #3548cf;">"true"</span>
    <span style="color: #005e8b;">AutoGenerateColumns</span>=<span style="color: #3548cf;">"false"</span>
    <span style="color: #005e8b;">AllowSorting</span>=<span style="color: #3548cf;">"true"</span>
    <span style="color: #005e8b;">EmptyDataText</span>=<span style="color: #3548cf;">"&#27809;&#26377;&#26597;&#35810;&#21040;&#20219;&#20309;&#23398;&#29983;"</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">Columns</span><span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">BoundField</span> <span style="color: #005e8b;">DataField</span>=<span style="color: #3548cf;">"name"</span> <span style="color: #005e8b;">HeaderText</span>=<span style="color: #3548cf;">"&#22995;&#21517;"</span> <span style="color: #005e8b;">SortExpression</span>=<span style="color: #3548cf;">"id"</span>/<span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">BoundField</span> <span style="color: #005e8b;">DataField</span>=<span style="color: #3548cf;">"homecity"</span> /<span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">ButtonField</span> <span style="color: #005e8b;">ButtonType</span>=<span style="color: #3548cf;">"Link"</span> <span style="color: #005e8b;">Text</span>=<span style="color: #3548cf;">"dksk"</span> /<span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">CommandField</span> <span style="color: #005e8b;">ShowDeleteButton</span>=<span style="color: #3548cf;">"true"</span> <span style="color: #005e8b;">ShowEditButton</span>=<span style="color: #3548cf;">"true"</span> /<span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">TemplateField</span><span style="color: #000000;">&gt;</span>
            <span style="color: #000000;">&lt;</span><span style="color: #721045;">ItemTemplate</span><span style="color: #000000;">&gt;</span>
                <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
                    <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;&lt;</span>%# Eval<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"name"</span><span style="color: #dd22dd;">)</span> %<span style="color: #000000;">&gt;</span> <span style="color: #000000;">(</span><span style="color: #dd22dd;">&lt;</span>%# Eval<span style="color: #008899;">(</span><span style="color: #3548cf;">"homecity"</span><span style="color: #008899;">)</span> %<span style="color: #dd22dd;">&gt;</span><span style="color: #000000;">)&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
                    <span style="color: #000000;">&lt;</span><span style="color: #721045;">h3</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"color: red"</span><span style="color: #000000;">&gt;</span><span style="font-style: italic; text-decoration: underline;">&#25105;&#26159;&#35841;</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">h3</span><span style="color: #000000;">&gt;</span>
                    <span style="color: #000000;">&lt;</span><span style="color: #721045;">h5</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"color: green"</span><span style="color: #000000;">&gt;</span><span style="text-decoration: underline;">&#25105;&#23601;&#26159;&#25105;&#65292;&#19981;&#19968;&#26679;&#30340;&#28895;&#28779;</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">h5</span><span style="color: #000000;">&gt;</span>
                    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Button</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"dddd"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">Text</span>=<span style="color: #3548cf;">"&#25105;&#26159;&#25353;&#38062;"</span> /<span style="color: #000000;">&gt;</span>
                <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
            <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">ItemTemplate</span><span style="color: #000000;">&gt;</span>
            <span style="color: #000000;">&lt;</span><span style="color: #721045;">ItemStyle</span> <span style="color: #005e8b;">BackColor</span>=<span style="color: #3548cf;">"Green"</span> /<span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">TemplateField</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">Columns</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">AlternatingRowStyle</span> <span style="color: #005e8b;">BackColor</span>=<span style="color: #3548cf;">"LightBlue"</span> <span style="color: #005e8b;">Font-Size</span>=<span style="color: #3548cf;">"XX-Large"</span>/<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">HeaderStyle</span> <span style="color: #005e8b;">BackColor</span>=<span style="color: #3548cf;">"Gray"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">GridView</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1c7ab0" class="outline-4">
<h4 id="orge1c7ab0"><span class="section-number-4">5.5.2.</span> Repeater</h4>
<div class="outline-text-4" id="text-5-5-2">
<p>
专门进行数据迭代的一个控件，可以生成更高效更优雅的代码。
</p>

<p>
<a href="https://learn.microsoft.com/zh-cn/dotnet/api/system.web.ui.webcontrols.repeater?view=netframework-4.8">https://learn.microsoft.com/zh-cn/dotnet/api/system.web.ui.webcontrols.repeater?view=netframework-4.8</a>
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">if</span> <span style="color: #000000;">(</span><span style="color: #a60000; font-weight: bold;">!</span>IsPostBack<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    sl.DataSource = DbHelper.<span style="color: #721045;">DoExecuteQuery</span><span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"select * from students"</span><span style="color: #dd22dd;">)</span>;
    sl.<span style="color: #721045;">DataBind</span><span style="color: #dd22dd;">()</span>;
<span style="color: #000000;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Repeater</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"sl"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">HeaderTemplate</span><span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #721045;">ul</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">HeaderTemplate</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">ItemTemplate</span><span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span><span style="color: #721045;">li</span><span style="color: #000000;">&gt;&lt;</span>%# Eval<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"name"</span><span style="color: #dd22dd;">)</span> %<span style="color: #000000;">&gt;</span>, <span style="color: #000000;">&lt;</span>%# Eval<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"homecity"</span><span style="color: #dd22dd;">)</span> %<span style="color: #000000;">&gt;&lt;</span>/<span style="color: #721045;">li</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">ItemTemplate</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">FooterTemplate</span><span style="color: #000000;">&gt;</span>
        <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">ul</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">FooterTemplate</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Repeater</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org27e318c" class="outline-3">
<h3 id="org27e318c"><span class="section-number-3">5.6.</span> 用户自定义控件</h3>
<div class="outline-text-3" id="text-5-6">
<p>
控件的主要目的，是复用。使用控件跟调用方法很类似，只不过方法的核心是逻辑，控件的核心是视图。
</p>

<p>
自定义控件的后缀名为 ascx，用 &lt;%@ Control&gt; 作为标记。以 MyLogin.ascx 为例:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span>%@ Control <span style="color: #005e8b;">Language</span>=<span style="color: #3548cf;">"C#"</span> <span style="color: #005e8b;">AutoEventWireup</span>=<span style="color: #3548cf;">"true"</span>
    <span style="color: #005e8b;">CodeBehind</span>=<span style="color: #3548cf;">"MyLogin.ascx.cs"</span>
    <span style="color: #005e8b;">Inherits</span>=<span style="color: #3548cf;">"StudentManageSystem_WF.MyLogin"</span> %<span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">TextBox</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"username"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">TextBox</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"TextBox1"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> /<span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">Button</span> <span style="color: #005e8b;">ID</span>=<span style="color: #3548cf;">"skdfjskdjf"</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">Text</span>=<span style="color: #3548cf;">"denglu"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #531ab6;">partial</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">MyLogin</span> : System.Web.UI.<span style="color: #005f5f;">UserControl</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">DefaultUsername</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #531ab6;">set</span>; <span style="color: #dd22dd;">}</span>

    <span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Page_Load</span><span style="color: #dd22dd;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">sender</span>, <span style="color: #005f5f;">EventArgs</span> <span style="color: #005e8b;">e</span><span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #531ab6;">if</span> <span style="color: #008899;">(</span><span style="color: #a60000; font-weight: bold;">!</span>IsPostBack<span style="color: #008899;">)</span>
        <span style="color: #008899;">{</span>
            username.Text = DefaultUsername;
        <span style="color: #008899;">}</span>
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
要使用控件，需要通过 &lt;%@ Register &gt; 对控件进行注册:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span>%@ Register <span style="color: #005e8b;">Src</span>=<span style="color: #3548cf;">"~/MyLogin.ascx"</span> <span style="color: #005e8b;">TagName</span>=<span style="color: #3548cf;">"MyLogin"</span> <span style="color: #005e8b;">TagPrefix</span>=<span style="color: #3548cf;">"fl"</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #8f0075;">fl</span>:<span style="color: #721045;">MyLogin</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">DefaultUsername</span>=<span style="color: #3548cf;">"xxx"</span> /<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org14fe1f4" class="outline-3">
<h3 id="org14fe1f4"><span class="section-number-3">5.7.</span> 其他</h3>
<div class="outline-text-3" id="text-5-7">
</div>
<div id="outline-container-org3ed183e" class="outline-4">
<h4 id="org3ed183e"><span class="section-number-4">5.7.1.</span> 路由 (Route)</h4>
<div class="outline-text-4" id="text-5-7-1">
<div class="org-src-container">
<pre class="src src-csharp">RouteTable.Routes.<span style="color: #721045;">MapPageRoute</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"hello"</span>, <span style="color: #3548cf;">"hello"</span>, <span style="color: #3548cf;">"~/Students1.aspx"</span><span style="color: #000000;">)</span>;
RouteTable.Routes.<span style="color: #721045;">EnableFriendlyUrls</span><span style="color: #000000;">(</span>
    <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">FriendlyUrlSettings</span><span style="color: #dd22dd;">()</span>
    <span style="color: #dd22dd;">{</span>
        AutoRedirectMode = RedirectMode.Permanent
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb2d469" class="outline-4">
<h4 id="orgbb2d469"><span class="section-number-4">5.7.2.</span> 捆绑 (Bundle)</h4>
<div class="outline-text-4" id="text-5-7-2">
<pre class="example">
让 css/js (1) 变少 (2) 变小
</pre>


<p>
配置:
</p>
<div class="org-src-container">
<pre class="src src-csharp">BundleTable.Bundles.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span><span style="color: #531ab6;">new</span> <span style="color: #005f5f;">ScriptBundle</span><span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"~/bundles/MsAjaxJs"</span><span style="color: #dd22dd;">)</span>.<span style="color: #721045;">Include</span><span style="color: #dd22dd;">(</span>
    <span style="color: #3548cf;">"~/Scripts/WebForms/MsAjax/MicrosoftAjax.js"</span>,
    <span style="color: #3548cf;">"~/Scripts/WebForms/MsAjax/MicrosoftAjaxApplicationServices.js"</span>,
    <span style="color: #3548cf;">"~/Scripts/WebForms/MsAjax/MicrosoftAjaxTimer.js"</span>,
    <span style="color: #3548cf;">"~/Scripts/WebForms/MsAjax/MicrosoftAjaxWebForms.js"</span><span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>;
</pre>
</div>

<p>
使用:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #8f0075;">asp</span>:<span style="color: #721045;">PlaceHolder</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #005e8b;">%:</span> Scripts.Render<span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"~/bundles/modernizr"</span><span style="color: #dd22dd;">)</span> %<span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #8f0075;">asp</span>:<span style="color: #721045;">PlaceHolder</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span><span style="color: #8f0075;">webopt</span>:<span style="color: #721045;">bundlereference</span> <span style="color: #005e8b;">runat</span>=<span style="color: #3548cf;">"server"</span> <span style="color: #005e8b;">path</span>=<span style="color: #3548cf;">"~/Content/css"</span> /<span style="color: #000000;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6449b61" class="outline-4">
<h4 id="org6449b61"><span class="section-number-4">5.7.3.</span> 网站 Logo (favicon.ico)</h4>
<div class="outline-text-4" id="text-5-7-3">
<p>
放在网站的根目录。
</p>
</div>
</div>

<div id="outline-container-orgd80584e" class="outline-4">
<h4 id="orgd80584e"><span class="section-number-4">5.7.4.</span> IHttpHandler.IsReusable</h4>
<div class="outline-text-4" id="text-5-7-4">
<p>
重用。
</p>
</div>
</div>
</div>
</section>

<section id="outline-container-org1228952" class="outline-2">
<h2 id="org1228952"><span class="section-number-2">6.</span> ASP.NET MVC</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgf24ab64" class="outline-3">
<h3 id="orgf24ab64"><span class="section-number-3">6.1.</span> MVC</h3>
<div class="outline-text-3" id="text-6-1">
<p>
ASP.NET MVC:
</p>
<ul class="org-ul">
<li>基于 MVC 概念:
<ul class="org-ul">
<li>Model (模型)</li>
<li>View  (视图), 默认使用 Razor 作为页面的模板引擎</li>
<li>Controller (控制器)</li>
</ul></li>
<li>约定大于配置 (CoC, Convention Over Configuration) 的理念</li>
</ul>

<p>
项目文件夹:
</p>
<ul class="org-ul">
<li>Controller</li>
<li>View</li>
<li>Model</li>
</ul>
</div>
</div>

<div id="outline-container-orgc171ad9" class="outline-3">
<h3 id="orgc171ad9"><span class="section-number-3">6.2.</span> Lifecycle</h3>
<div class="outline-text-3" id="text-6-2">

<figure id="orga090d86">
<img src="img/mvc-lifecycle.png" alt="mvc-lifecycle.png">

</figure>

<p>
首先，在 <code>UrlRoutingModule</code> 中获取路由数据，并找到要处理的 MvcHandler:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#36890;&#36807; RouteTable &#33719;&#21462;&#36335;&#30001;&#25968;&#25454;</span>
<span style="color: #005f5f;">RouteData</span> <span style="color: #005e8b;">routeData</span> = <span style="color: #531ab6;">this</span>.RouteCollection.<span style="color: #721045;">GetRouteData</span><span style="color: #000000;">(</span>context<span style="color: #000000;">)</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">&#20351;&#29992; MvcHandler &#22788;&#29702;&#25509;&#19979;&#26469;&#30340;&#35831;&#27714;</span>
<span style="color: #005f5f;">IRouteHandler</span> <span style="color: #005e8b;">routeHandler</span> = routeData.RouteHandler;
<span style="color: #005f5f;">IHttpHandler</span> <span style="color: #005e8b;">httpHandler</span> = routeHandler.<span style="color: #721045;">GetHttpHandler</span><span style="color: #000000;">(</span>requestContext<span style="color: #000000;">)</span>;
context.<span style="color: #721045;">RemapHandler</span><span style="color: #000000;">(</span>httpHandler<span style="color: #000000;">)</span>;
</pre>
</div>

<p>
其次，在 <code>MvcHandler</code> 中，创建对应的 Controller 对象，并调用其 Execute 方法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#21019;&#24314; Controller &#23545;&#35937;</span>
<span style="color: #531ab6;">this</span>.<span style="color: #721045;">ProcessRequestInit</span><span style="color: #000000;">(</span><span style="color: #005f5f;">httpContext</span>, <span style="color: #531ab6;">out</span> <span style="color: #005f5f;">controller</span>, <span style="color: #531ab6;">out</span> <span style="color: #005f5f;">controllerFactory</span><span style="color: #000000;">)</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">&#35843;&#29992; Controller &#20013;&#30340; Execute &#26041;&#27861;</span>
controller.<span style="color: #721045;">Execute</span><span style="color: #000000;">(</span><span style="color: #531ab6;">this</span>.RequestContext<span style="color: #000000;">)</span>;
</pre>
</div>

<p>
然后，通过 <code>Controller.InvokeAction</code> 调用对应的 Action 方法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#33719;&#21462; Action &#19978;&#25152;&#26377;&#36807;&#28388;&#22120;</span>
<span style="color: #005f5f;">FilterInfo</span> <span style="color: #005e8b;">filters</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">GetFilters</span><span style="color: #000000;">(</span>controllerContext, actionDescriptor<span style="color: #000000;">)</span>;
<span style="color: #531ab6;">try</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">&#25191;&#34892;&#20854;&#20013;&#30340; Authentication (&#35748;&#35777;) &#36807;&#28388;&#22120;</span>
    <span style="color: #005f5f;">AuthenticationContext</span> <span style="color: #005e8b;">authenticationContext</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">InvokeAuthenticationFilters</span><span style="color: #dd22dd;">(</span>controllerContext, filters.AuthenticationFilters, actionDescriptor<span style="color: #dd22dd;">)</span>;
    <span style="color: #595959;">// </span><span style="color: #595959;">&#25191;&#34892;&#20854;&#20013;&#30340; Authorization (&#25480;&#26435;) &#36807;&#28388;&#22120; </span>
    <span style="color: #005f5f;">AuthorizationContext</span> <span style="color: #005e8b;">authorizationContext</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">InvokeAuthorizationFilters</span><span style="color: #dd22dd;">(</span>controllerContext, filters.AuthorizationFilters, actionDescriptor<span style="color: #dd22dd;">)</span>;
    <span style="color: #595959;">// </span><span style="color: #595959;">&#33719;&#21462;&#24182;&#32465;&#23450;&#35831;&#27714;&#21442;&#25968;</span>
    <span style="color: #005f5f;">IDictionary</span><span style="color: #dd22dd;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">object</span><span style="color: #dd22dd;">&gt;</span> <span style="color: #005e8b;">parameterValues</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">GetParameterValues</span><span style="color: #dd22dd;">(</span>controllerContext, actionDescriptor<span style="color: #dd22dd;">)</span>;
    <span style="color: #595959;">// </span><span style="color: #595959;">(&#25191;&#34892; ActionFilter.OnActionExecuting &#28982;&#21518;) &#25191;&#34892; Action &#26041;&#27861;&#65281;</span>
    <span style="color: #005f5f;">ActionExecutedContext</span> <span style="color: #005e8b;">actionExecutedContext</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">InvokeActionMethodWithFilters</span><span style="color: #dd22dd;">(</span>controllerContext, filters.ActionFilters, actionDescriptor, parameterValues<span style="color: #dd22dd;">)</span>;
    <span style="color: #595959;">// </span><span style="color: #595959;">&#25191;&#34892;&#21518;&#32622;&#36807;&#28388;&#22120;</span>
    <span style="color: #005f5f;">AuthenticationChallengeContext</span> <span style="color: #005e8b;">authenticationChallengeContext3</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">InvokeAuthenticationFiltersChallenge</span><span style="color: #dd22dd;">(</span>controllerContext, filters.AuthenticationFilters, actionDescriptor, actionExecutedContext.Result<span style="color: #dd22dd;">)</span>;
    <span style="color: #531ab6;">this</span>.<span style="color: #721045;">InvokeActionResultWithFilters</span><span style="color: #dd22dd;">(</span>controllerContext, filters.ResultFilters, authenticationChallengeContext3.<span style="color: #005f5f;">Result</span> ?? actionExecutedContext.<span style="color: #005e8b;">Result</span><span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>
<span style="color: #531ab6;">catch</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">// </span><span style="color: #595959;">&#25191;&#34892;&#24322;&#24120;&#36807;&#28388;&#22120;</span>
    <span style="color: #005f5f;">ExceptionContext</span> <span style="color: #005e8b;">exceptionContext</span> = <span style="color: #531ab6;">this</span>.<span style="color: #721045;">InvokeExceptionFilters</span><span style="color: #dd22dd;">(</span>controllerContext, filters.ExceptionFilters, exception<span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
最后，通过 ViewEngines 选择合适的 IViewEngine，并根据结果类型调用响应的 <code>IView.Render</code> 方法，完成渲染:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #2a5045;">/// &#21487;&#20197;&#23450;&#20041;&#24182;&#20351;&#29992;&#33258;&#24049;&#30340; ViewEngine</span>
<span style="color: #531ab6;">protected</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Application_Start</span><span style="color: #000000;">()</span>
<span style="color: #000000;">{</span>
    <span style="color: #595959;">//</span><span style="color: #595959;">&#31227;&#38500;&#25152;&#26377;&#30340;View&#24341;&#25806;&#21253;&#25324;Webform&#21644;Razor</span>
    ViewEngines.Engines.<span style="color: #721045;">Clear</span><span style="color: #dd22dd;">()</span>;

    <span style="color: #595959;">//</span><span style="color: #595959;">&#27880;&#20876;&#20320;&#33258;&#24049;&#30340;View&#24341;&#25806;</span>
    ViewEngines.Engines.<span style="color: #721045;">Add</span><span style="color: #dd22dd;">(</span><span style="color: #531ab6;">new</span> <span style="color: #005f5f;">CustomViewEngine</span><span style="color: #008899;">()</span><span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
参考: <a href="https://www.cnblogs.com/PatrickLiu/p/15175388.html">https://www.cnblogs.com/PatrickLiu/p/15175388.html</a>
</p>
</div>
</div>

<div id="outline-container-org727ab03" class="outline-3">
<h3 id="org727ab03"><span class="section-number-3">6.3.</span> Action</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li>Action 是 Controller 里面用来处理请求产生响应的一个方法</li>
<li>返回值是一个普通的 string/int 等或者是一个 ActionResult</li>
</ul>

<p>
ActionResult:
</p>
<ul class="org-ul">
<li>Content() 方法用来返回一个 ContentResult 对象，即返回字符串本身</li>
<li>View() 方法用来返回一个 ViewResult，利用 razor 引擎生成 html 字符串</li>
<li>Json() 方法用来返回一个 JsonResult 对象，即将数据序列化</li>
<li>File() 方法用来返回一个 FileResult 对象，用来处理文件的下载</li>
<li>HttpNotFound, new HttpNotFoundResult, new HttpStatusCodeResult(505)</li>
<li>Redirect/RedirectToAction/RedirectToRoute</li>
</ul>

<p>
传递数据的方式:
</p>
<ul class="org-ul">
<li>ViewBag</li>
<li>ViewData</li>
<li>Model</li>
</ul>
</div>
</div>

<div id="outline-container-org592c73d" class="outline-3">
<h3 id="org592c73d"><span class="section-number-3">6.4.</span> Razor</h3>
<div class="outline-text-3" id="text-6-4">
<ul class="org-ul">
<li>Html 代码跟 CSharp 代码混编</li>
<li>分解符: 遇到 @ 就是 csharp, 遇到 &lt; 就是 html 代码</li>
<li>常用指令: @model, @functions 等</li>
<li>常用的类: Html/Ajax/Url/Model/ViewBag/ViewData/Layout</li>
<li>Q: ViewBag vs ViewData 有什么区别?</li>
</ul>
</div>
</div>

<div id="outline-container-org946e302" class="outline-3">
<h3 id="org946e302"><span class="section-number-3">6.5.</span> Binding/Validation</h3>
<div class="outline-text-3" id="text-6-5">
<ul class="org-ul">
<li>参数是自动绑定的，注意 [Bind] 的使用</li>
<li>验证，推荐使用的是 Model 验证方式:
<ol class="org-ol">
<li>定义或者选择适当的 <code>ValidationAttribute</code></li>
<li>放置到 Model 的相关属性上</li>
<li>在 Action 中使用 <code>ModelState.IsValid</code> 来判断有没有验证的错误</li>
<li>在 Razor 中使用 <code>@Html.ValidationSummary/ValidationMessageFor</code> 对错误信息进行输出</li>
</ol></li>
<li><p>
其他方式，比如手动验证:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">if</span> <span style="color: #000000;">(</span>student.Name.Length &gt; 2<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    ModelState.<span style="color: #721045;">AddModelError</span><span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"Name"</span>, <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Exception</span><span style="color: #008899;">(</span><span style="color: #3548cf;">"&#22826;&#38271;"</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>
</pre>
</div></li>
</ul>

<p>
内置的很多 Attribute 在 System.ComponentModel.DataAnnotations 包下面:
</p>
<ul class="org-ul">
<li>Required</li>
<li>StringLength</li>
<li>Range</li>
<li>RegularExpression</li>
</ul>

<p>
自定义验证 Attribute:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">MyRequiredAttribute</span> : <span style="color: #005f5f;">ValidationAttribute</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">public</span> <span style="color: #531ab6;">override</span> <span style="color: #005f5f;">bool</span> <span style="color: #721045;">IsValid</span><span style="color: #dd22dd;">(</span><span style="color: #005f5f;">object</span> <span style="color: #0000b0;">value</span><span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3a6654" class="outline-3">
<h3 id="orgc3a6654"><span class="section-number-3">6.6.</span> Filter</h3>
<div class="outline-text-3" id="text-6-6">
<p>
接口、方法:
</p>
<ul class="org-ul">
<li>IAuthenticationFilter/IAuthorizationFilter (AuthorizeAttribute)</li>
<li>IActionFilter (ActionFilterAttribute)</li>
<li>IResultFilter (ActionFilterAttribute)</li>
<li>IExceptionFilter (HandleErrorAttribute)</li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org9b9ef2f" class="outline-2">
<h2 id="org9b9ef2f"><span class="section-number-2">7.</span> ASP.NET WebAPI</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orge8f9cc3" class="outline-3">
<h3 id="orge8f9cc3"><span class="section-number-3">7.1.</span> JSON</h3>
<div class="outline-text-3" id="text-7-1">
<p>
JavaScript Object Notation.
</p>

<p>
来源于 Javascript 的对象语法:
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #531ab6;">var</span> <span style="color: #005e8b;">i</span> = 1;
<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">j</span> = <span style="color: #3548cf;">"hello"</span>;
<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">arr</span> = <span style="color: #000000;">[</span>2, 3, 4<span style="color: #000000;">]</span>;
<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">obj</span> = <span style="color: #000000;">{</span>
    <span style="color: #3548cf;">"a"</span>: 1,
    <span style="color: #3548cf;">"b"</span>: 2,
    <span style="color: #3548cf;">"c"</span>: 3
<span style="color: #000000;">}</span>;
<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">students</span> = <span style="color: #000000;">[</span>
    <span style="color: #dd22dd;">{</span>
        id: 1,
        name: 222,
        age: 333
    <span style="color: #dd22dd;">}</span>,
    <span style="color: #dd22dd;">{</span>
        id: 2,
        name: 222,
        age: 333
    <span style="color: #dd22dd;">}</span>,
    <span style="color: #dd22dd;">{</span>
        id: 3,
        name: 222,
        age: 333
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">]</span>;
</pre>
</div>

<p>
使用 JS 在 Json 字符串和对象之间进行转换:
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #531ab6;">var</span> <span style="color: #005e8b;">s1</span> = <span style="color: #000000;">[</span><span style="color: #dd22dd;">{</span>id: 1, name: <span style="color: #3548cf;">'zs'</span><span style="color: #dd22dd;">}</span>, <span style="color: #dd22dd;">{</span>id:2, name:<span style="color: #3548cf;">'ls'</span><span style="color: #dd22dd;">}</span><span style="color: #000000;">]</span>;
<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">stringS1</span> = JSON.stringify<span style="color: #000000;">(</span>s1<span style="color: #000000;">)</span>;

<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">s2</span> = <span style="color: #3548cf;">'[{"id": 3333, "name": "lisi"},{"id": 444, "name": "wangwu"}]'</span>;
<span style="color: #531ab6;">var</span> <span style="color: #005e8b;">jsonS2</span> = JSON.parse<span style="color: #000000;">(</span>s2<span style="color: #000000;">)</span>;
</pre>
</div>

<p>
使用 CSharp 在 Json 字符串和 C# 对象之间进行转换:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">var</span> <span style="color: #005e8b;">students</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">Student</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Student</span> <span style="color: #dd22dd;">{</span> Id = <span style="color: #3548cf;">"1"</span>, Name = <span style="color: #3548cf;">"zhangsan"</span> <span style="color: #dd22dd;">}</span>,
    <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Student</span> <span style="color: #dd22dd;">{</span> <span style="color: #005e8b;">Id</span> = <span style="color: #3548cf;">"2"</span>, <span style="color: #005e8b;">Name</span> = <span style="color: #3548cf;">"lisi"</span> <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>;
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">s1</span> = JsonConvert.<span style="color: #721045;">SerializeObject</span><span style="color: #000000;">(</span>students<span style="color: #000000;">)</span>;
<span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">Student</span><span style="color: #000000;">&gt;</span> <span style="color: #005e8b;">s2</span> = JsonConvert.DeserializeObject<span style="color: #000000;">&lt;</span><span style="color: #005f5f;">List</span><span style="color: #dd22dd;">&lt;</span><span style="color: #005f5f;">Student</span><span style="color: #dd22dd;">&gt;</span><span style="color: #000000;">&gt;(</span>s1<span style="color: #000000;">)</span>;
s2.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span><span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Student</span> <span style="color: #dd22dd;">{</span> <span style="color: #005e8b;">Id</span> = <span style="color: #3548cf;">"3"</span>, <span style="color: #005e8b;">Name</span> = <span style="color: #3548cf;">"ww"</span> <span style="color: #dd22dd;">}</span><span style="color: #000000;">)</span>;
<span style="color: #531ab6;">return</span> JsonConvert.<span style="color: #721045;">SerializeObject</span><span style="color: #000000;">(</span>s2<span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org680ebb4" class="outline-3">
<h3 id="org680ebb4"><span class="section-number-3">7.2.</span> WebApiConfig.cs</h3>
<div class="outline-text-3" id="text-7-2">
<p>
可以在这里配置 WebAPI 相关的选项。
</p>

<p>
比如，设置返回数据格式:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#35753;&#40664;&#35748;&#24773;&#20917;&#19979;&#19981;&#36820;&#22238; xml &#32467;&#26524;&#30340;&#25968;&#25454;&#65292;&#32780;&#26159; JSON &#30340;</span>
config.Formatters.XmlFormatter.SupportedMediaTypes.<span style="color: #721045;">Clear</span><span style="color: #000000;">()</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">&#23545; JSON &#25968;&#25454;&#20351;&#29992;&#28151;&#21512;&#22823;&#23567;&#20889;</span>
config.Formatters.JsonFormatter.SerializerSettings.ContractResolver = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">CamelCasePropertyNamesContractResolver</span><span style="color: #000000;">()</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">&#28155;&#21152;&#33258;&#23450;&#20041;&#30340; Formatter</span>
config.Formatters.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span><span style="color: #531ab6;">new</span> <span style="color: #005f5f;">YourFormatter</span><span style="color: #dd22dd;">()</span><span style="color: #000000;">)</span>;
</pre>
</div>

<p>
比如，设置路由格式:
</p>
<div class="org-src-container">
<pre class="src src-csharp">config.Routes.<span style="color: #721045;">MapHttpRoute</span><span style="color: #000000;">(</span>
    name: <span style="color: #3548cf;">"DefaultApi"</span>,
    routeTemplate: <span style="color: #3548cf;">"api/{controller}/{id}"</span>,
    defaults: <span style="color: #531ab6;">new</span> <span style="color: #dd22dd;">{</span> <span style="color: #005e8b;">id</span> = RouteParameter.Optional <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf1b1de" class="outline-3">
<h3 id="orgaf1b1de"><span class="section-number-3">7.3.</span> Router</h3>
<div class="outline-text-3" id="text-7-3">
<p>
默认的路由规则是在 WebApiConfig.cs 中定义的:
</p>
<pre class="example">
api/{controller}/{id}
</pre>


<p>
因此:
</p>
<ul class="org-ul">
<li>请求 <code>GET /zoos</code> 对应 ZoosController 的 <code>GetXxx</code> 方法</li>
<li>请求 <code>PUT /zoos/3</code> 对应 ZoosController 的 <code>PutXxx(id)</code> 方法</li>
<li>默认情况是通过方法名的前缀判断 HTTP METHOD 的。
可以通过在 Action 上添加 <code>[HttpGet]</code> 等特性显式指定</li>
<li>可以将 <code>[Route("xxx")]</code> 添加到 Controller 或 Action 上，单独设置独立的路由</li>
</ul>
</div>
</div>

<div id="outline-container-org0c62dfc" class="outline-3">
<h3 id="org0c62dfc"><span class="section-number-3">7.4.</span> Action</h3>
<div class="outline-text-3" id="text-7-4">
<p>
方法名字 vs 请求方法:
</p>
<ul class="org-ul">
<li>按照 CoC 的设计思想，GetBook 默认将处理 GET 请求，DeleteBook 默认将处理 Delete 请求，如此类推</li>
<li>可以通过在 Action 上添加 [HttpXxx] 特性，显式指定请求方法</li>
</ul>

<p>
返回类型:
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">返回类型</th>
<th scope="col" class="org-left">Web API 如何创建响应</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">void</td>
<td class="org-left">返回空 204 (无内容)</td>
</tr>

<tr>
<td class="org-left">HttpResponseMessage</td>
<td class="org-left">直接转换为 HTTP 响应消息。</td>
</tr>

<tr>
<td class="org-left">IHttpActionResult</td>
<td class="org-left">调用 ExecuteAsync 以创建 HttpResponseMessage，然后转换为 HTTP 响应消息。</td>
</tr>

<tr>
<td class="org-left">其他类型的</td>
<td class="org-left">将序列化的返回值写入响应正文;返回 200 (OK) 。</td>
</tr>
</tbody>
</table>

<p>
示例:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#23558;&#20250;&#33258;&#21160;&#24207;&#21015;&#21270;&#20026; JSON &#36820;&#22238;</span>
<span style="color: #531ab6;">public</span> <span style="color: #005f5f;">Book</span> <span style="color: #721045;">GetBook</span><span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">id</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">return</span> db.Books.<span style="color: #721045;">Find</span><span style="color: #dd22dd;">(</span>id<span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">&#28789;&#27963;&#36827;&#34892;&#19981;&#21516;&#30340;&#21709;&#24212;</span>
<span style="color: #531ab6;">public</span> <span style="color: #005f5f;">IHttpActionResult</span> <span style="color: #721045;">GetBook</span><span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">id</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">Book</span> <span style="color: #005e8b;">book</span> = db.Books.<span style="color: #721045;">Find</span><span style="color: #dd22dd;">(</span>id<span style="color: #dd22dd;">)</span>;
    <span style="color: #531ab6;">return</span> book == <span style="color: #0000b0;">null</span> ? <span style="color: #721045;">NotFound</span><span style="color: #dd22dd;">()</span> : <span style="color: #721045;">Ok</span><span style="color: #dd22dd;">(</span>book<span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8b8cf9" class="outline-3">
<h3 id="orgb8b8cf9"><span class="section-number-3">7.5.</span> Help</h3>
<div class="outline-text-3" id="text-7-5">
<p>
在 Areas 下面存在一个 HelpPage 的域，里面实现了展示当前所有 API 文档的功能。
</p>

<p>
可以通过 <code>https://localhost:23232/Help</code> 的方式进行访问。
</p>

<p>
<a href="https://learn.microsoft.com/zh-cn/aspnet/web-api/overview/getting-started-with-aspnet-web-api/creating-api-help-pages">https://learn.microsoft.com/zh-cn/aspnet/web-api/overview/getting-started-with-aspnet-web-api/creating-api-help-pages</a>
</p>
</div>
</div>
</section>

<section id="outline-container-org445dddf" class="outline-2">
<h2 id="org445dddf"><span class="section-number-2">8.</span> .NET Core</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org00073ce" class="outline-3">
<h3 id="org00073ce"><span class="section-number-3">8.1.</span> 跨平台开发</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>推出了跨平台的 VSCode (lsp, Language Server Prototol)</li>
<li>Windows 下面安装环境 (<a href="https://learn.microsoft.com/zh-cn/dotnet/core/install/windows?tabs=net60">https://learn.microsoft.com/zh-cn/dotnet/core/install/windows?tabs=net60</a>)</li>
<li>NuGet (<a href="https://www.nuget.org/">https://www.nuget.org/</a>)</li>
<li>dotnet 命令行工具</li>
</ul>
</div>
</div>

<div id="outline-container-org342f262" class="outline-3">
<h3 id="org342f262"><span class="section-number-3">8.2.</span> dotnet 命令行工具</h3>
<div class="outline-text-3" id="text-8-2">
<p>
<a href="https://learn.microsoft.com/zh-cn/dotnet/core/tools/dotnet">https://learn.microsoft.com/zh-cn/dotnet/core/tools/dotnet</a>
</p>

<p>
创建项目:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet new --list  <span style="color: #595959;"># </span><span style="color: #595959;">&#21015;&#20986;&#25152;&#26377;&#30340;&#39033;&#30446;&#27169;&#26495;</span>
dotnet new console
dotnet new console -o first
dotnet new console --output first
dotnet new console -o <span style="color: #3548cf;">"second console project"</span>

dotnet new mvc
dotnet new webapi
</pre>
</div>

<p>
构建项目:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet build
</pre>
</div>

<p>
运行构建完成的 dll 可执行文件:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet exec myapp.dll
dotnet myapp.dll
</pre>
</div>

<p>
为项目添加项目或 NuGet 依赖：
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet add reference lib1/lib1.csproj lib2/lib2.csproj
dotnet add package Microsoft.EntityFrameworkCore
</pre>
</div>

<p>
其他命令:
</p>
<div class="org-src-container">
<pre class="src src-shell">dotnet restore
dotnet run
dotnet watch run
dotnet clean
dotnet publish
dotnet test
</pre>
</div>
</div>
</div>


<div id="outline-container-orgeb51a6b" class="outline-3">
<h3 id="orgeb51a6b"><span class="section-number-3">8.3.</span> C# 语法拾遗</h3>
<div class="outline-text-3" id="text-8-3">
<p>
语法糖 (Syntax Sugar), 用来锦上添花的。
</p>
</div>

<div id="outline-container-org2be1c7c" class="outline-4">
<h4 id="org2be1c7c"><span class="section-number-4">8.3.1.</span> NULL</h4>
<div class="outline-text-4" id="text-8-3-1">
<p>
正则表达式
</p>

<ul class="org-ul">
<li>可空类型 (decimal?), 为值类型增加一个 null 选项。用于区分默认值跟未赋值</li>
<li><code>A?.X</code>, 其实是 <code>A =</code> null ? null : A.X= 的语法糖。主要用于避免 NullPointerException</li>
</ul>

<p>
?. 语法糖:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">string</span> <span style="color: #005e8b;">name</span>;
<span style="color: #531ab6;">if</span> <span style="color: #000000;">(</span>p == <span style="color: #0000b0;">null</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    name = <span style="color: #0000b0;">null</span>;
<span style="color: #000000;">}</span>
<span style="color: #531ab6;">else</span>
<span style="color: #000000;">{</span>
    name = p.Name;
<span style="color: #000000;">}</span>
<span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">price</span> = <span style="color: #000000;">(</span>p == <span style="color: #0000b0;">null</span> ? <span style="color: #0000b0;">null</span> : p.Price<span style="color: #000000;">)</span>;
<span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">price</span> = p?.Price;
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">rname</span> = p?.Related?.Name;
results.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span>$<span style="color: #3548cf;">"Name: {p?.Name}, Price: {p?.Price}, Related: {rname}"</span><span style="color: #000000;">)</span>;


<span style="color: #595959;">// </span><span style="color: #595959;">&#20351;&#29992;&#20102; ?. &#35821;&#27861;&#31958;&#30340;&#20889;&#27861;</span>
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">rname</span> = p?.Related?.Name;

<span style="color: #595959;">// </span><span style="color: #595959;">&#19981;&#20351;&#29992;&#35821;&#27861;&#31958;&#30340;&#23454;&#29616;</span>
<span style="color: #531ab6;">if</span> <span style="color: #000000;">(</span>p != <span style="color: #0000b0;">null</span> &amp;&amp; p.Related != <span style="color: #0000b0;">null</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    rname = p.Related.Name;
<span style="color: #000000;">}</span>
<span style="color: #531ab6;">else</span>
<span style="color: #000000;">{</span>
    rname = <span style="color: #0000b0;">null</span>;
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
?? 语法糖:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">string</span> <span style="color: #005e8b;">author</span> = db.Authors.<span style="color: #721045;">Find</span><span style="color: #000000;">(</span>3<span style="color: #000000;">)</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">....</span>
<span style="color: #531ab6;">if</span> <span style="color: #000000;">(</span>author == <span style="color: #0000b0;">null</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    author = <span style="color: #3548cf;">"&#26410;&#21517;"</span>;
<span style="color: #000000;">}</span>
Console.<span style="color: #721045;">WriteLine</span><span style="color: #000000;">(</span>$<span style="color: #3548cf;">"{author}"</span><span style="color: #000000;">)</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#31616;&#21270;&#20026;</span>
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">author</span> = db.Authors.<span style="color: #721045;">Find</span><span style="color: #000000;">(</span>3<span style="color: #000000;">)</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">....</span>
author ?? <span style="color: #3548cf;">"&#26410;&#21517;"</span>
</pre>
</div>

<p>
?. 和 ?? 混合使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">string</span> <span style="color: #005e8b;">name</span> = p.Name;
<span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">price</span> = p.Price;
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">relatedName</span> = p.Related.Name;

<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">name</span> = p?.Name ?? <span style="color: #3548cf;">"&lt;No Name&gt;"</span>;
<span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">price</span> = p?.Price ?? 9999;
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">relatedName</span> = p?.Related?.Name ?? <span style="color: #3548cf;">"&lt;none&gt;"</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6716ac1" class="outline-4">
<h4 id="org6716ac1"><span class="section-number-4">8.3.2.</span> 自动属性</h4>
<div class="outline-text-4" id="text-8-3-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">DRY</span>
<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">Suibian</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">private</span> <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">name</span>;
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">Name</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #531ab6;">get</span>
        <span style="color: #008899;">{</span>
            <span style="color: #531ab6;">return</span> name;
        <span style="color: #008899;">}</span>
        <span style="color: #531ab6;">set</span>
        <span style="color: #008899;">{</span>
            name = <span style="color: #0000b0;">value</span>;
        <span style="color: #008899;">}</span>
    <span style="color: #dd22dd;">}</span>

    <span style="color: #595959;">// </span><span style="color: #595959;">&#22810;&#35874;&#32534;&#35793;&#22120;&#21733;&#21733;</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">Price</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #531ab6;">set</span>; <span style="color: #dd22dd;">}</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">Related</span> <span style="color: #005e8b;">Suibian</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #531ab6;">private</span> <span style="color: #531ab6;">set</span>; <span style="color: #dd22dd;">}</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">Price</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #531ab6;">set</span>; <span style="color: #dd22dd;">}</span> = 9999M;
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">Price</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #dd22dd;">}</span> = 9999M;

    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">Price</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span> <span style="color: #008899;">{</span> <span style="color: #531ab6;">return</span> 33; <span style="color: #008899;">}</span><span style="color: #dd22dd;">}</span>;
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">Price</span> =&gt; 33;   <span style="color: #595959;">// </span><span style="color: #595959;">&#23646;&#24615;&#23450;&#20041;</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">decimal</span>? <span style="color: #005e8b;">_price</span> = 33;   <span style="color: #595959;">// </span><span style="color: #595959;">&#23383;&#27573;&#23450;&#20041;</span>
<span style="color: #000000;">}</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-orga4990fe" class="outline-4">
<h4 id="orga4990fe"><span class="section-number-4">8.3.3.</span> 插值字符串</h4>
<div class="outline-text-4" id="text-8-3-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">string</span> <span style="color: #005e8b;">info</span> = <span style="color: #3548cf;">"hello"</span> + name + <span style="color: #3548cf;">", wo men yao dao "</span> + place + <span style="color: #3548cf;">"play"</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">StringBuilder sb = new(); sb.Append.....;</span>
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">info</span> = <span style="color: #005f5f;">string</span>.<span style="color: #721045;">Format</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"hello {0}, wo men yao dao {1} play"</span>, name, place<span style="color: #000000;">)</span>;
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">info</span> = $<span style="color: #3548cf;">"hello {name}, wo men yao dao {place} play"</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef21bee" class="outline-4">
<h4 id="orgef21bee"><span class="section-number-4">8.3.4.</span> 初始化器</h4>
<div class="outline-text-4" id="text-8-3-4">
<p>
对象初始化:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">Factory</span> <span style="color: #005e8b;">f</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Factory</span><span style="color: #000000;">()</span>;
f.Name = <span style="color: #3548cf;">"fsk"</span>;
<span style="color: #005f5f;">Product</span> <span style="color: #005e8b;">p</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Product</span><span style="color: #000000;">()</span>;
p.Name = <span style="color: #3548cf;">"hello"</span>;
p.Price = 333;
f.Weixin = <span style="color: #3548cf;">"dkfjdkfj"</span>;
p.Weixin = <span style="color: #3548cf;">"ksjdfksdjkfjdsk"</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#31616;&#21270;</span>
<span style="color: #005f5f;">Factory</span> <span style="color: #005e8b;">f</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Factory</span> <span style="color: #000000;">()</span>
<span style="color: #000000;">{</span>
    Name = <span style="color: #3548cf;">"fsk"</span>, Weixin = <span style="color: #3548cf;">"bzd"</span>
<span style="color: #000000;">}</span>;
<span style="color: #005f5f;">Product</span> <span style="color: #005e8b;">p</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Product</span>
<span style="color: #000000;">{</span>
    <span style="color: #005e8b;">Name</span> = <span style="color: #3548cf;">"hello"</span>, <span style="color: #005e8b;">Weixin</span> = <span style="color: #3548cf;">"kkk"</span>, <span style="color: #005e8b;">Price</span> = 333
<span style="color: #000000;">}</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">p</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Product</span>
<span style="color: #000000;">{</span>
    <span style="color: #005e8b;">Name</span> = <span style="color: #3548cf;">"hello"</span>, <span style="color: #005e8b;">Weixin</span> = <span style="color: #3548cf;">"kkk"</span>, <span style="color: #005e8b;">Price</span> = 333
<span style="color: #000000;">}</span>;
</pre>
</div>

<p>
数组初始化:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">string</span><span style="color: #000000;">[]</span> <span style="color: #005e8b;">names</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">string</span><span style="color: #000000;">[]</span>
<span style="color: #000000;">{</span>
    <span style="color: #3548cf;">"aaa"</span>, <span style="color: #3548cf;">"bbb"</span>, <span style="color: #3548cf;">"ccc"</span>
<span style="color: #000000;">}</span>;
</pre>
</div>

<p>
List 初始化:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;</span> <span style="color: #005e8b;">r1</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;()</span>;
r1.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"aaa"</span><span style="color: #000000;">)</span>;
r1.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"bbb"</span><span style="color: #000000;">)</span>;
r1.<span style="color: #721045;">Add</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"ccc"</span><span style="color: #000000;">)</span>;
<span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;</span> <span style="color: #005e8b;">r2</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;</span> <span style="color: #005e8b;">r3</span> = <span style="color: #531ab6;">new</span><span style="color: #000000;">()</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">r4</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">r5</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">List</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #000000;">&gt;()</span>
<span style="color: #000000;">{</span>
    <span style="color: #3548cf;">"aaa"</span>, <span style="color: #3548cf;">"bbb"</span>, <span style="color: #3548cf;">"ccc"</span>
<span style="color: #000000;">}</span>;
</pre>
</div>

<p>
Dictionary 初始化:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #005f5f;">Dictionary</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">int</span><span style="color: #000000;">&gt;</span> <span style="color: #005e8b;">scores1</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Dictionary</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">int</span><span style="color: #000000;">&gt;()</span>;
scores1<span style="color: #000000;">[</span><span style="color: #3548cf;">"zs"</span><span style="color: #000000;">]</span> = 33;
scores1<span style="color: #000000;">[</span><span style="color: #3548cf;">"ls"</span><span style="color: #000000;">]</span> = 66;
<span style="color: #005f5f;">Dictionary</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">int</span><span style="color: #000000;">&gt;</span> <span style="color: #005e8b;">scores2</span> = <span style="color: #531ab6;">new</span> <span style="color: #000000;">()</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">scores3</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Dictionary</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">int</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">scores4</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Dictionary</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">int</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">{</span>
    <span style="color: #dd22dd;">{</span><span style="color: #3548cf;">"zs"</span>, 33<span style="color: #dd22dd;">}</span>, <span style="color: #dd22dd;">{</span><span style="color: #3548cf;">"ls"</span>, 66<span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">scores5</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Dictionary</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">string</span>, <span style="color: #005f5f;">int</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">{</span>
    <span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"zs"</span><span style="color: #dd22dd;">]</span> = 33,
    <span style="color: #dd22dd;">[</span><span style="color: #3548cf;">"ls"</span><span style="color: #dd22dd;">]</span> = 66
<span style="color: #000000;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6dff4ee" class="outline-4">
<h4 id="org6dff4ee"><span class="section-number-4">8.3.5.</span> 模式匹配 (Patter-Match)</h4>
<div class="outline-text-4" id="text-8-3-5">
<p>
模式匹配是函数型语言 (F#, Haskell) 的标配，微软将其引入了面向对象的 C# 中。
</p>

<p>
switch -&gt; case when:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#21407;&#20889;&#27861;&#65292;&#20351;&#29992; if/else</span>
<span style="color: #005f5f;">object</span><span style="color: #000000;">[]</span> <span style="color: #005e8b;">arr</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">object</span><span style="color: #000000;">[]</span> <span style="color: #000000;">{</span> 333, <span style="color: #3548cf;">"hello"</span>, 444M, 1M, 223f <span style="color: #000000;">}</span>;
<span style="color: #005f5f;">decimal</span> <span style="color: #005e8b;">total</span> = 0;
<span style="color: #531ab6;">foreach</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">item</span> <span style="color: #531ab6;">in</span> arr<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">if</span> <span style="color: #dd22dd;">(</span>item <span style="color: #531ab6;">is</span> <span style="color: #005f5f;">decimal</span> d<span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        total += d;
    <span style="color: #dd22dd;">}</span>
    <span style="color: #531ab6;">else</span> <span style="color: #531ab6;">if</span> <span style="color: #dd22dd;">(</span>item <span style="color: #531ab6;">is</span> <span style="color: #005f5f;">int</span> i<span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        total += i;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">&#21407; switch/case</span>
<span style="color: #005f5f;">string</span> <span style="color: #005e8b;">aaa</span> = <span style="color: #3548cf;">"dkfjd"</span>;
<span style="color: #531ab6;">switch</span> <span style="color: #000000;">(</span>aaa<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">case</span> <span style="color: #3548cf;">"hello"</span>:
        System.Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"dkfj"</span><span style="color: #dd22dd;">)</span>;
        <span style="color: #531ab6;">break</span>;
    <span style="color: #531ab6;">case</span> <span style="color: #3548cf;">"world"</span>:
        System.Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"dkkfk"</span><span style="color: #dd22dd;">)</span>;
        <span style="color: #531ab6;">break</span>;
<span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">&#20351;&#29992; switch...case...when &#35821;&#27861;&#36827;&#34892;&#27169;&#24335;&#21305;&#37197;</span>
<span style="color: #005f5f;">object</span><span style="color: #000000;">[]</span> <span style="color: #005e8b;">arr</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">object</span><span style="color: #000000;">[]</span> <span style="color: #000000;">{</span> 333, <span style="color: #3548cf;">"hello"</span>, 444M, 1M, 223f <span style="color: #000000;">}</span>;
<span style="color: #005f5f;">decimal</span> <span style="color: #005e8b;">total</span> = 0;
<span style="color: #531ab6;">foreach</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">object</span> <span style="color: #005e8b;">item</span> <span style="color: #531ab6;">in</span> arr<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">switch</span> <span style="color: #dd22dd;">(</span>item<span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #531ab6;">case</span> <span style="color: #005f5f;">decimal</span> d:
            total += d;
            <span style="color: #531ab6;">break</span>;
        <span style="color: #531ab6;">case</span> <span style="color: #005f5f;">int</span> i <span style="color: #531ab6;">when</span> i &gt; 3:
            total += i;
            <span style="color: #531ab6;">break</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org853755d" class="outline-4">
<h4 id="org853755d"><span class="section-number-4">8.3.6.</span> 扩展方法</h4>
<div class="outline-text-4" id="text-8-3-6">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #531ab6;">static</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">MyKuozhanMethod</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">public</span> <span style="color: #531ab6;">static</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">Eat</span><span style="color: #dd22dd;">(</span><span style="color: #531ab6;">this</span> <span style="color: #005f5f;">IALive</span> <span style="color: #005e8b;">d</span>, <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">food</span><span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        System.Console.<span style="color: #721045;">WriteLine</span><span style="color: #008899;">(</span>$<span style="color: #3548cf;">"{food} zhenhaochi"</span><span style="color: #008899;">)</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">interface</span> <span style="color: #005f5f;">IALive</span> <span style="color: #000000;">{</span> <span style="color: #000000;">}</span>
<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">Dog</span> : <span style="color: #005f5f;">IALive</span> <span style="color: #000000;">{</span> <span style="color: #000000;">}</span>
<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">Cat</span> : <span style="color: #005f5f;">IALive</span> <span style="color: #000000;">{</span> <span style="color: #000000;">}</span>
<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">Person</span> : <span style="color: #005f5f;">IALive</span> <span style="color: #000000;">{</span> <span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">test</span>
<span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Dog</span><span style="color: #000000;">()</span>.<span style="color: #721045;">Eat</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"xiang"</span><span style="color: #000000;">)</span>;
<span style="color: #531ab6;">new</span> <span style="color: #005f5f;">Cat</span><span style="color: #000000;">()</span>.<span style="color: #721045;">Eat</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"ksdfksjd"</span><span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org66ef195" class="outline-4">
<h4 id="org66ef195"><span class="section-number-4">8.3.7.</span> 异步编程</h4>
<div class="outline-text-4" id="text-8-3-7">
<p>
async/await
</p>
</div>
</div>

<div id="outline-container-orgcc32f0e" class="outline-4">
<h4 id="orgcc32f0e"><span class="section-number-4">8.3.8.</span> nameof</h4>
<div class="outline-text-4" id="text-8-3-8">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">class</span> <span style="color: #005f5f;">Program</span> <span style="color: #000000;">{}</span>

Console.<span style="color: #721045;">WriteLine</span><span style="color: #000000;">(</span><span style="color: #3548cf;">"Program"</span><span style="color: #000000;">)</span>;
Console.<span style="color: #721045;">WriteLine</span><span style="color: #000000;">(</span><span style="color: #721045;">nameof</span><span style="color: #dd22dd;">(</span><span style="color: #005e8b;">Program</span><span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf8529c6" class="outline-3">
<h3 id="orgf8529c6"><span class="section-number-3">8.4.</span> 软件工程</h3>
<div class="outline-text-3" id="text-8-4">
<p>
<a href="img/software-flow.svg">软件开发流程</a>
</p>
</div>

<div id="outline-container-org6c7ee03" class="outline-4">
<h4 id="org6c7ee03"><span class="section-number-4">8.4.1.</span> xUnit/Moq</h4>
<div class="outline-text-4" id="text-8-4-1">
<p>
xUnit:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #005f5f;">int</span> <span style="color: #721045;">MyAdd</span><span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    a++;
    a--;
    a = a * a;
    a = <span style="color: #dd22dd;">(</span><span style="color: #005f5f;">int</span><span style="color: #dd22dd;">)</span>Math.<span style="color: #721045;">Sqrt</span><span style="color: #dd22dd;">(</span>a<span style="color: #dd22dd;">)</span>;
    <span style="color: #531ab6;">return</span> a + b;
<span style="color: #000000;">}</span>


<span style="color: #531ab6;">public</span> <span style="color: #005f5f;">void</span> <span style="color: #721045;">TestMyAdd</span><span style="color: #000000;">()</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">var</span> <span style="color: #005e8b;">p</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">ConsoleApp4</span>.<span style="color: #721045;">Program</span><span style="color: #dd22dd;">()</span>;
    Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span>$<span style="color: #3548cf;">"{p.MyAdd(2, 3) == 5}"</span><span style="color: #dd22dd;">)</span>;
    Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span>$<span style="color: #3548cf;">"{p.MyAdd(-2, 3) == 1}"</span><span style="color: #dd22dd;">)</span>;
    Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span>$<span style="color: #3548cf;">"{p.MyAdd(-2, -3) == -5}"</span><span style="color: #dd22dd;">)</span>;
    Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span>$<span style="color: #3548cf;">"{p.MyAdd(2, 33434334) == 33434336}"</span><span style="color: #dd22dd;">)</span>;
    Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span>$<span style="color: #3548cf;">"{p.MyAdd(0, 3) == 3}"</span><span style="color: #dd22dd;">)</span>;
    Console.<span style="color: #721045;">WriteLine</span><span style="color: #dd22dd;">(</span>$<span style="color: #3548cf;">"{p.MyAdd(0, 0) == 0}"</span><span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>

<span style="color: #000000;">[</span><span style="color: #005e8b;">Fact</span><span style="color: #000000;">]</span>
<span style="color: #531ab6;">public</span> <span style="color: #005f5f;">void</span> MyAddIsRight <span style="color: #000000;">()</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">var</span> <span style="color: #005e8b;">p</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">HomeController</span><span style="color: #dd22dd;">()</span>;
    Assert.<span style="color: #721045;">Equal</span><span style="color: #dd22dd;">(</span>5, p.<span style="color: #721045;">MyAdd</span><span style="color: #008899;">(</span>2, 3<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>;
    Assert.<span style="color: #721045;">Equal</span><span style="color: #dd22dd;">(</span>-5, p.<span style="color: #721045;">MyAdd</span><span style="color: #008899;">(</span>-2, -3<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>;
    Assert.<span style="color: #721045;">Equal</span><span style="color: #dd22dd;">(</span>-1111, p.<span style="color: #721045;">MyAdd</span><span style="color: #008899;">(</span>-2222, 1111<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>;
    Assert.<span style="color: #721045;">Equal</span><span style="color: #dd22dd;">(</span>0, p.<span style="color: #721045;">MyAdd</span><span style="color: #008899;">(</span>0, 0<span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span>;
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
Moq links:
</p>
<ul class="org-ul">
<li><a href="https://github.com/Moq">https://github.com/Moq</a></li>
<li><a href="https://learn.microsoft.com/en-us/shows/visual-studio-toolbox/unit-testing-moq-framework">https://learn.microsoft.com/en-us/shows/visual-studio-toolbox/unit-testing-moq-framework</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org96b4954" class="outline-3">
<h3 id="org96b4954"><span class="section-number-3">8.5.</span> Dependency Injection</h3>
<div class="outline-text-3" id="text-8-5">
<p>
参考:
</p>
<ul class="org-ul">
<li>官方文档: <a href="https://learn.microsoft.com/zh-cn/dotnet/core/extensions/dependency-injection">https://learn.microsoft.com/zh-cn/dotnet/core/extensions/dependency-injection</a></li>
<li>IoC: <a href="https://learn.microsoft.com/zh-cn/dotnet/architecture/modern-web-apps-azure/architectural-principles#dependency-inversion">https://learn.microsoft.com/zh-cn/dotnet/architecture/modern-web-apps-azure/architectural-principles#dependency-inversion</a></li>
</ul>
</div>

<div id="outline-container-org3f41ee7" class="outline-4">
<h4 id="org3f41ee7"><span class="section-number-4">8.5.1.</span> 分离是技术进步的象征</h4>
<div class="outline-text-4" id="text-8-5-1">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>;
a + b;
<span style="color: #721045;">aaa</span><span style="color: #000000;">()</span>;

<span style="color: #005f5f;">int</span> <span style="color: #721045;">nfit_173_ccc</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> bbb<span style="color: #dd22dd;">(</span>a, b<span style="color: #dd22dd;">)</span>; <span style="color: #000000;">}</span>
<span style="color: #005f5f;">int</span> <span style="color: #721045;">ddd</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> ccc<span style="color: #dd22dd;">(</span>a, b<span style="color: #dd22dd;">)</span>; <span style="color: #000000;">}</span>
<span style="color: #005f5f;">int</span> <span style="color: #721045;">abc</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> ccc<span style="color: #dd22dd;">(</span>a, b<span style="color: #dd22dd;">)</span>; <span style="color: #000000;">}</span>
<span style="color: #005f5f;">int</span> <span style="color: #721045;">cba</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> ccc<span style="color: #dd22dd;">(</span>a, b<span style="color: #dd22dd;">)</span>; <span style="color: #000000;">}</span>
<span style="color: #005f5f;">int</span> <span style="color: #721045;">cab</span> <span style="color: #000000;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> ccc<span style="color: #dd22dd;">(</span>a, b<span style="color: #dd22dd;">)</span>; <span style="color: #000000;">}</span>
<span style="color: #a0132f;">#include</span> <span style="color: #3548cf;">"z.c"</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-cpp"><span style="color: #531ab6;">class</span> <span style="color: #005f5f;">xxx</span> <span style="color: #000000;">{</span>
    <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span> = 2;
    <span style="color: #005f5f;">int</span> <span style="color: #721045;">aa</span> <span style="color: #dd22dd;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span><span style="color: #dd22dd;">)</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">return</span> a + b; <span style="color: #dd22dd;">}</span>
    <span style="color: #005f5f;">int</span> <span style="color: #721045;">bb</span> <span style="color: #dd22dd;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span><span style="color: #dd22dd;">)</span> <span style="color: #dd22dd;">{</span> b = a; <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>;
<span style="color: #531ab6;">class</span> <span style="color: #005f5f;">yyy</span> <span style="color: #000000;">{</span>
    <span style="color: #005f5f;">int</span> <span style="color: #721045;">aaa</span> <span style="color: #dd22dd;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #dd22dd;">)</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">return</span> a + b; <span style="color: #dd22dd;">}</span>
    <span style="color: #005f5f;">int</span> <span style="color: #721045;">bbb</span> <span style="color: #dd22dd;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #dd22dd;">)</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">return</span> a + b; <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">namespace</span> xxx <span style="color: #000000;">{</span>
    <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">xxx</span> <span style="color: #dd22dd;">{</span>
        <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span> = 2;
        <span style="color: #005f5f;">int</span> <span style="color: #721045;">aa</span> <span style="color: #008899;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span><span style="color: #008899;">)</span> <span style="color: #008899;">{</span> <span style="color: #531ab6;">return</span> a + b; <span style="color: #008899;">}</span>
        <span style="color: #005f5f;">int</span> <span style="color: #721045;">bb</span> <span style="color: #008899;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span><span style="color: #008899;">)</span> <span style="color: #008899;">{</span> b = a; <span style="color: #008899;">}</span>
    <span style="color: #dd22dd;">}</span>;
    <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">yyy</span> <span style="color: #dd22dd;">{</span>
        <span style="color: #005f5f;">int</span> <span style="color: #721045;">aaa</span> <span style="color: #008899;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #008899;">)</span> <span style="color: #008899;">{</span> <span style="color: #531ab6;">return</span> a + b; <span style="color: #008899;">}</span>
        <span style="color: #005f5f;">int</span> <span style="color: #721045;">bbb</span> <span style="color: #008899;">(</span><span style="color: #005f5f;">int</span> <span style="color: #005e8b;">a</span>, <span style="color: #005f5f;">int</span> <span style="color: #005e8b;">b</span><span style="color: #008899;">)</span> <span style="color: #008899;">{</span> <span style="color: #531ab6;">return</span> a + b; <span style="color: #008899;">}</span>
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"dkfjdkjfkdjk"</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">center</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">b</span><span style="color: #000000;">&gt;</span><span style="font-weight: bold;">ksdfjkd</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">b</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">u</span><span style="color: #000000;">&gt;</span><span style="text-decoration: underline;">skdfjksdj</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">u</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">i</span><span style="color: #000000;">&gt;</span><span style="font-style: italic;">ksdfjksdjf</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">i</span><span style="color: #000000;">&gt;</span>
    ksdfjkd
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">center</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">font</span> <span style="color: #005e8b;">name</span>=<span style="color: #3548cf;">"&#24494;&#36719;&#38597;&#40657;"</span><span style="color: #000000;">&gt;</span>kdfjkd<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">font</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">a</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"kdjfdkfjkdj"</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">a</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"color: red; padding: 3em; border: 1px solid green; background=..."</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"dkfjdkjfkdjk"</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">h3</span><span style="color: #000000;">&gt;</span><span style="font-style: italic; text-decoration: underline;">dkfjdkj</span><span style="color: #000000;">&lt;</span>/<span style="color: #721045;">h3</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"font-weight: bold"</span><span style="color: #000000;">&gt;</span>ksdfjkd<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"text-align: center"</span><span style="color: #000000;">&gt;</span>ksdfjkd<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"font-family: &#24494;&#36719;&#38597;&#40657;"</span><span style="color: #000000;">&gt;</span>kdfjkd<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">a</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"kdjfdkfjkdj"</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">a</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">p</span> <span style="color: #005e8b;">style</span>=<span style="color: #3548cf;">"color: red; padding: 3em; border: 1px solid green; background=..."</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">p</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>

<span style="color: #000000;">&lt;</span><span style="color: #721045;">style</span><span style="color: #000000;">&gt;</span>
  <span style="color: #531ab6;">#headr </span><span style="color: #000000;">{</span> <span style="color: #005f5f;">color</span>: <span style="color: #ffffff; background-color: #ff0000;">red</span>; <span style="color: #000000;">}</span>
  <span style="color: #531ab6;">.x </span><span style="color: #000000;">{</span> <span style="color: #005f5f;">color</span>: <span style="color: #ffffff; background-color: #008000;">green</span>; <span style="color: #000000;">}</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">style</span><span style="color: #000000;">&gt;</span>

&#24456;&#22810;&#26679;&#24335;&#31867;&#21734;&#65292;&#36214;&#32039;&#26469;&#20351;&#29992;&#21543;

<span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">id</span>=<span style="color: #3548cf;">"headr"</span> <span style="color: #005e8b;">class</span>=<span style="color: #3548cf;">"x"</span><span style="color: #000000;">&gt;&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">id</span>=<span style="color: #3548cf;">"main"</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>kdsfjk<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
    <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>kdjfkdjf<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
  <span style="color: #000000;">&lt;</span><span style="color: #721045;">div</span> <span style="color: #005e8b;">id</span>=<span style="color: #3548cf;">"footer"</span> <span style="color: #005e8b;">class</span>=<span style="color: #3548cf;">"x"</span><span style="color: #000000;">&gt;&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
<span style="color: #000000;">&lt;</span>/<span style="color: #721045;">div</span><span style="color: #000000;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb825645" class="outline-4">
<h4 id="orgb825645"><span class="section-number-4">8.5.2.</span> DI 容器是在解耦合的需求中，一步步发展出来的</h4>
<div class="outline-text-4" id="text-8-5-2">
<p>
亲自创建自己需要的对象，高耦合:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">HomeController</span> : <span style="color: #005f5f;">Controller</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">UserService</span> <span style="color: #005e8b;">service</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">UserService</span><span style="color: #dd22dd;">(</span><span style="color: #3548cf;">"xxx"</span>, <span style="color: #3548cf;">"kdfjk"</span><span style="color: #dd22dd;">)</span>;

    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">IActionResult</span> <span style="color: #721045;">Index</span><span style="color: #dd22dd;">()</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #005f5f;">var</span> <span style="color: #005e8b;">users</span> = service.<span style="color: #721045;">GetUsers</span><span style="color: #008899;">()</span>;
        <span style="color: #531ab6;">return</span> <span style="color: #721045;">View</span><span style="color: #008899;">(</span>users<span style="color: #008899;">)</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">UserService</span> <span style="color: #000000;">{</span> <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">List</span><span style="color: #dd22dd;">&lt;</span><span style="color: #005f5f;">User</span><span style="color: #dd22dd;">&gt;</span> <span style="color: #721045;">GetUsers</span><span style="color: #dd22dd;">()</span> <span style="color: #dd22dd;">{</span> <span style="color: #dd22dd;">}</span> <span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">var controller = new HomeController();</span>
</pre>
</div>

<p>
不要写死了，需要用什么，直接传进去:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">HomeController</span> : <span style="color: #005f5f;">Controller</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">UserService</span> <span style="color: #005e8b;">service</span>;

    <span style="color: #531ab6;">public</span> <span style="color: #721045;">HomeController</span><span style="color: #dd22dd;">(</span><span style="color: #005f5f;">UserService</span> <span style="color: #005e8b;">s</span><span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        service = s;
    <span style="color: #dd22dd;">}</span>

    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">IActionResult</span> <span style="color: #721045;">Index</span><span style="color: #dd22dd;">()</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #005f5f;">var</span> <span style="color: #005e8b;">users</span> = service.<span style="color: #721045;">GetUsers</span><span style="color: #008899;">()</span>;
        <span style="color: #531ab6;">return</span> <span style="color: #721045;">View</span><span style="color: #008899;">(</span>users<span style="color: #008899;">)</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">var service = new UserService(....);</span>
<span style="color: #595959;">// </span><span style="color: #595959;">var controller = new HomeController(service);</span>
</pre>
</div>

<p>
放宽限制 (is -&gt; as) 利用接口，更加利于分工协作，灵活分离:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">public</span> <span style="color: #531ab6;">interface</span> <span style="color: #005f5f;">IUserService</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">List</span><span style="color: #dd22dd;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #dd22dd;">&gt;</span> <span style="color: #721045;">GetUsers</span><span style="color: #dd22dd;">()</span>;
<span style="color: #000000;">}</span>

<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">HomeController</span>
<span style="color: #000000;">{</span>
    <span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">service</span>;

    <span style="color: #531ab6;">public</span> <span style="color: #721045;">HomeController</span><span style="color: #dd22dd;">(</span><span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s</span><span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        service = s;
    <span style="color: #dd22dd;">}</span>

    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">List</span><span style="color: #dd22dd;">&lt;</span><span style="color: #005f5f;">string</span><span style="color: #dd22dd;">&gt;</span> <span style="color: #721045;">Index</span><span style="color: #dd22dd;">()</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #531ab6;">return</span> service.<span style="color: #721045;">GetUsers</span><span style="color: #008899;">()</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
使用对象管理器，简化对象的使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#21018;&#24320;&#22987;, &#27604;&#22914;:</span>
<span style="color: #595959;">// </span><span style="color: #595959;">om &#34920;&#31034;&#23545;&#35937;&#31649;&#29702;&#22120;&#65292;</span>
<span style="color: #595959;">// </span><span style="color: #595959;">&#26377;&#19968;&#20010; Add &#26041;&#27861;&#29992;&#26469;&#24448;&#37324;&#21021;&#22987;&#21270;&#23545;&#35937;</span>
<span style="color: #595959;">// </span><span style="color: #595959;">new A; new B; new C</span>
om.<span style="color: #721045;">Add</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">UserDAO</span><span style="color: #000000;">&gt;()</span>; <span style="color: #595959;">// </span><span style="color: #595959;">&#23427;&#20250;&#21019;&#24314;&#19968;&#20010; UserDAO &#23545;&#35937;&#65292;&#24182;&#20445;&#23384;&#36215;&#26469;</span>
om.<span style="color: #721045;">Add</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">UserService</span><span style="color: #000000;">&gt;()</span>;
om.<span style="color: #721045;">Add</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">HomeController</span><span style="color: #000000;">&gt;()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">Index</span>
<span style="color: #005f5f;">HomeController</span> <span style="color: #005e8b;">controller</span> = om.<span style="color: #721045;">Get</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">HomeController</span><span style="color: #000000;">&gt;()</span>;
controller.<span style="color: #721045;">Index</span><span style="color: #000000;">()</span>;
<span style="color: #005f5f;">IUserDAO</span> <span style="color: #005e8b;">userDAO</span> = om.<span style="color: #721045;">Get</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">UserDAO</span><span style="color: #000000;">&gt;()</span>;
userDAO.<span style="color: #721045;">GetUsers</span><span style="color: #000000;">()</span>;
</pre>
</div>

<p>
DI:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#23481;&#22120;&#30340;&#21021;&#22987;&#21270;</span>
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">collection</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">ServiceCollection</span><span style="color: #000000;">()</span>;
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserDAO</span>, <span style="color: #005f5f;">UserDAO</span><span style="color: #000000;">&gt;()</span>;
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span>, <span style="color: #005f5f;">UserService</span><span style="color: #000000;">&gt;()</span>;
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">HomeController</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">provider</span> = collection.<span style="color: #721045;">BuildServiceProvider</span><span style="color: #000000;">()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#20351;&#29992;&#30340;&#29615;&#33410;</span>
<span style="color: #005f5f;">HomeController</span> <span style="color: #005e8b;">c</span> = provider.<span style="color: #721045;">GetService</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">HomeController</span><span style="color: #000000;">&gt;()</span>;
c.<span style="color: #721045;">Index</span><span style="color: #000000;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org63dadcb" class="outline-4">
<h4 id="org63dadcb"><span class="section-number-4">8.5.3.</span> DI 容器的基本使用</h4>
<div class="outline-text-4" id="text-8-5-3">
<p>
三个主要接口:
</p>
<ul class="org-ul">
<li>IServiceCollection</li>
<li>IServiceProvider</li>
<li>IOptions</li>
</ul>

<p>
<code>IServiceCollection</code>:
</p>
<ul class="org-ul">
<li>表示服务的集合。它主要用来注册、保存 Service。它实现了 IList 接口，是可迭代的</li>
<li>实现类 <code>ServiceCollection</code>, 主要有 <code>AddTransient/AddSingleton/AddScoped</code> 方法</li>
<li>按照生命周期 (Lifetime) 划分，服务分为 Transient/Singleton/Scoped 三种</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#27880;&#20876;&#26381;&#21153;</span>
<span style="color: #005f5f;">ServiceCollection</span> <span style="color: #005e8b;">collection</span> = <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">ServiceCollection</span><span style="color: #000000;">()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#30452;&#25509;&#27880;&#20876;&#26576;&#20010;&#31867;</span>
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">(</span><span style="color: #531ab6;">typeof</span><span style="color: #dd22dd;">(</span>UserService<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>;
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">HomeController</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">&#22522;&#20110;&#25509;&#21475;&#36827;&#34892;&#27880;&#20876;</span>
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserDAO</span>, <span style="color: #005f5f;">UserDAO</span><span style="color: #000000;">&gt;()</span>;
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span>, <span style="color: #005f5f;">UserService</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #595959;">// </span><span style="color: #595959;">&#36890;&#36807; lambda &#36827;&#34892;&#28789;&#27963;&#27880;&#20876;</span>
collection.<span style="color: #721045;">AddSingleton</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserDAO</span><span style="color: #000000;">&gt;(</span>provider =&gt;
<span style="color: #dd22dd;">{</span>
    <span style="color: #531ab6;">return</span> <span style="color: #531ab6;">new</span> <span style="color: #005f5f;">UserDAO</span><span style="color: #008899;">()</span>;
<span style="color: #dd22dd;">}</span><span style="color: #000000;">)</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#20854;&#20182;&#29983;&#21629;&#21608;&#26399;&#30340;&#26381;&#21153;&#65292;&#27880;&#20876;&#35821;&#27861;&#31867;&#20284;</span>
collection.<span style="color: #721045;">AddTransient</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserDAO</span><span style="color: #000000;">&gt;()</span>;
collection.<span style="color: #721045;">AddScoped</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserDAO</span><span style="color: #000000;">&gt;()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#36890;&#36807; ServiceCollection &#21487;&#20197;&#29983;&#25104; ServiceProvider &#23545;&#35937;</span>
<span style="color: #595959;">// </span><span style="color: #595959;">&#36825;&#20010;&#23545;&#35937;&#65292;&#29992;&#26469;&#22312;&#21518;&#38754;&#20026;&#31243;&#24207;&#36816;&#34892;&#25552;&#20379; DI &#26381;&#21153;</span>
<span style="color: #005f5f;">ServiceProvider</span> <span style="color: #005e8b;">provider</span> = collection.<span style="color: #721045;">BuildServiceProvider</span><span style="color: #000000;">()</span>;
</pre>
</div>

<p>
<code>IServideProvider</code>:
</p>
<ul class="org-ul">
<li>通过 <code>IServideCollection.BuildProvider()</code> 的方法生成</li>
<li>其核心方法是 <code>GetServide(serviceType)</code>, 用来返回一个可用服务</li>
<li>其实现类 <code>ServiceProvider</code> 有 <code>GetService/GetRequiredService/CreateScope</code> 等方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">Provider &#26159;&#23481;&#22120;&#26381;&#21153;&#30340;&#25552;&#20379;&#32773;</span>
<span style="color: #005f5f;">ServiceProvider</span> <span style="color: #005e8b;">provider</span> = collection.<span style="color: #721045;">BuildServiceProvider</span><span style="color: #000000;">()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#20197;&#19979;&#20004;&#21477;&#31561;&#20215;&#12290;&#21482;&#19981;&#36807;&#21518;&#38754;&#19968;&#20010;&#26159;&#22522;&#20110;&#27867;&#22411;&#65292;&#35821;&#27861;&#26356;&#31616;&#27905;</span>
<span style="color: #595959;">// </span><span style="color: #595959;">&#23581;&#35797;&#20174;&#23481;&#22120;&#37324;&#33719;&#21462; IUserService &#31867;&#22411;&#30340;&#19968;&#20010;&#23545;&#35937;&#12290;&#22914;&#26524;&#25214;&#19981;&#21040;&#65292;&#36820;&#22238; null</span>
<span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s0</span> = <span style="color: #000000;">(</span><span style="color: #005f5f;">IUserService</span><span style="color: #000000;">)</span>provider.<span style="color: #721045;">GetService</span><span style="color: #000000;">(</span><span style="color: #531ab6;">typeof</span><span style="color: #dd22dd;">(</span>IUserService<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>;
<span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s1</span> = provider.<span style="color: #721045;">GetService</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span><span style="color: #000000;">&gt;()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#36319; GetService &#31867;&#20284;&#65292;&#21482;&#19981;&#36807;&#22914;&#26524;&#25214;&#19981;&#21040;&#23601;&#25243;&#20986;&#24322;&#24120;</span>
<span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s2</span> = provider.<span style="color: #721045;">GetRequiredService</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span><span style="color: #000000;">&gt;()</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#33719;&#21462;&#24182;&#20351;&#29992;&#19968;&#20010;&#20351;&#29992; AddScoped &#28155;&#21152;&#36827;&#23481;&#22120;&#30340;&#23545;&#35937;</span>
<span style="color: #595959;">// </span><span style="color: #595959;">&#36890;&#36807;&#21516;&#19968;&#20010; scope &#33719;&#21462;&#30340;&#23558;&#26159;&#21516;&#19968;&#20010;&#23545;&#35937;&#65307;&#19981;&#21516; scope &#33719;&#21462;&#30340;&#23558;&#26159;&#19981;&#21516;&#30340;&#23545;&#35937;</span>
<span style="color: #531ab6;">using</span> <span style="color: #005e8b;">IServiceScope</span> s<span style="color: #005e8b;">cope</span> = <span style="color: #005e8b;">provider</span>.<span style="color: #005e8b;">CreateScope</span><span style="color: #000000;">()</span>;
<span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s3</span> = scope.ServiceProvider.<span style="color: #721045;">GetService</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s4</span> = scope.ServiceProvider.<span style="color: #721045;">GetService</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span><span style="color: #000000;">&gt;()</span>;
<span style="color: #005f5f;">IUserService</span> <span style="color: #005e8b;">s5</span> = scope.ServiceProvider.<span style="color: #721045;">GetService</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">IUserService</span><span style="color: #000000;">&gt;()</span>;
</pre>
</div>

<p>
可以使用 <a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/options">IOptions Pattern</a> 为容器中的对象提供额外参数:
</p>
<ul class="org-ul">
<li>需要向项目中添加 <b>Microsoft.Extensions.Options</b> 包</li>
<li>上述的包，将会通过扩展方法的方式，为 ServiceCollection 添加了 <code>AddOptions/Configure</code> 等方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #595959;">// </span><span style="color: #595959;">&#39318;&#20808;&#65292;&#23450;&#20041;&#19968;&#20010;&#26222;&#36890;&#30340;&#31867; (POCO)&#65292;&#29992;&#26469;&#24403;&#20570;&#25968;&#25454;&#30340;&#36733;&#20307;</span>
<span style="color: #595959;">// </span><span style="color: #595959;">&#25353;&#29031;&#32422;&#23450;&#25104;&#20439;&#30340;&#20064;&#24815;&#65292;&#36825;&#20010;&#31867;&#26368;&#22909;&#20197; Options &#32467;&#23614;</span>
<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">UserServiceOptions</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">Name</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #531ab6;">set</span>; <span style="color: #dd22dd;">}</span>
    <span style="color: #531ab6;">public</span> <span style="color: #005f5f;">string</span> <span style="color: #005e8b;">Weixin</span> <span style="color: #dd22dd;">{</span> <span style="color: #531ab6;">get</span>; <span style="color: #531ab6;">set</span>; <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #595959;">// </span><span style="color: #595959;">&#20351;&#29992; Options &#25552;&#20379;&#30340; Configure &#26041;&#27861;&#65292;&#21521;&#23481;&#22120;&#20013;&#27880;&#20876;&#25968;&#25454;</span>
collection.<span style="color: #721045;">Configure</span><span style="color: #000000;">&lt;</span><span style="color: #005f5f;">MyUserOptions</span><span style="color: #000000;">&gt;(</span>option =&gt;
<span style="color: #dd22dd;">{</span>
    option.Name = <span style="color: #3548cf;">"&#24352;&#19977;"</span>;
    option.Weixin = <span style="color: #3548cf;">"sanzhang"</span>;
<span style="color: #dd22dd;">}</span><span style="color: #000000;">)</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">&#22312;&#26381;&#21153;&#30340;&#23454;&#29616;&#20013;&#65292;&#36890;&#36807;&#26500;&#36896;&#26041;&#27861;&#30340;&#26041;&#24335;&#25509;&#25910;&#25968;&#25454;</span>
<span style="color: #531ab6;">public</span> <span style="color: #531ab6;">class</span> <span style="color: #005f5f;">UserService</span> : <span style="color: #005f5f;">IUserService</span>
<span style="color: #000000;">{</span>
    <span style="color: #531ab6;">public</span> <span style="color: #721045;">UserService</span><span style="color: #dd22dd;">(</span><span style="color: #005f5f;">IUserDAO</span> <span style="color: #005e8b;">dao</span>, <span style="color: #005f5f;">IOptions</span><span style="color: #008899;">&lt;</span><span style="color: #005f5f;">UserServiceOptions</span><span style="color: #008899;">&gt;</span> <span style="color: #005e8b;">options</span><span style="color: #dd22dd;">)</span>
    <span style="color: #dd22dd;">{</span>
        <span style="color: #005f5f;">UserServiceOptions</span> <span style="color: #005e8b;">opt</span> = options.Value;
        Console.<span style="color: #721045;">WriteLine</span><span style="color: #008899;">(</span>opt.Name<span style="color: #008899;">)</span>;
        Console.<span style="color: #721045;">WriteLine</span><span style="color: #008899;">(</span>opt.Weixin<span style="color: #008899;">)</span>;
    <span style="color: #dd22dd;">}</span>
<span style="color: #000000;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0de2a0" class="outline-4">
<h4 id="orgc0de2a0"><span class="section-number-4">8.5.4.</span> Autofac</h4>
<div class="outline-text-4" id="text-8-5-4">
<p>
<a href="https://autofac.org/">https://autofac.org/</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgb4b5e87" class="outline-3">
<h3 id="orgb4b5e87"><span class="section-number-3">8.6.</span> 加密、解密</h3>
<div class="outline-text-3" id="text-8-6">
<p>
使用 SHA256 进行加密的过程:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #531ab6;">using</span> <span style="color: #005e8b;">System</span>;
<span style="color: #531ab6;">using</span> <span style="color: #005e8b;">System</span>.<span style="color: #005e8b;">Text</span>;
<span style="color: #531ab6;">using</span> <span style="color: #005e8b;">System</span>.<span style="color: #005e8b;">Linq</span>;
<span style="color: #531ab6;">using</span> <span style="color: #005e8b;">System</span>.<span style="color: #005e8b;">Security</span>.<span style="color: #005e8b;">Cryptography</span>;

<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">s</span> = <span style="color: #3548cf;">"hello&#19981;&#24212;&#35813;"</span>;

<span style="color: #005f5f;">byte</span><span style="color: #000000;">[]</span> <span style="color: #005e8b;">hash</span> = SHA256.<span style="color: #721045;">Create</span><span style="color: #000000;">()</span>.<span style="color: #721045;">ComputeHash</span><span style="color: #000000;">(</span>Encoding.UTF8.<span style="color: #721045;">GetBytes</span><span style="color: #dd22dd;">(</span>s<span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>;

<span style="color: #595959;">// </span><span style="color: #595959;">var sb = new StringBuilder();</span>
<span style="color: #595959;">// </span><span style="color: #595959;">foreach(var b in hash)</span>
<span style="color: #595959;">// </span><span style="color: #595959;">{</span>
<span style="color: #595959;">//     </span><span style="color: #595959;">sb.Append(b.ToString("X2"));</span>
<span style="color: #595959;">// </span><span style="color: #595959;">}</span>

<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">sb</span> = <span style="color: #005f5f;">string</span>.<span style="color: #721045;">Join</span><span style="color: #000000;">(</span><span style="color: #3548cf;">""</span>, hash.<span style="color: #721045;">Select</span><span style="color: #dd22dd;">(</span>b =&gt; b.<span style="color: #721045;">ToString</span><span style="color: #008899;">(</span><span style="color: #3548cf;">"X2"</span><span style="color: #008899;">)</span><span style="color: #dd22dd;">)</span><span style="color: #000000;">)</span>;
<span style="color: #005f5f;">var</span> <span style="color: #005e8b;">base64Result</span> = Convert.<span style="color: #721045;">ToBase64String</span><span style="color: #000000;">(</span>hash<span style="color: #000000;">)</span>;

Console.<span style="color: #721045;">WriteLine</span><span style="color: #000000;">(</span>base64Result<span style="color: #000000;">)</span>;
Console.<span style="color: #721045;">WriteLine</span><span style="color: #000000;">(</span>sb.<span style="color: #721045;">ToString</span><span style="color: #dd22dd;">()</span><span style="color: #000000;">)</span>;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgfe4d7fe" class="outline-2">
<h2 id="orgfe4d7fe"><span class="section-number-2">9.</span> ASP.NET Core MVC</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org3de7c5d" class="outline-3">
<h3 id="org3de7c5d"><span class="section-number-3">9.1.</span> 配置文件</h3>
<div class="outline-text-3" id="text-9-1">
<ul class="org-ul">
<li>xxx.proj</li>
<li>Program.cs</li>
<li>Startup.cs</li>
</ul>

<p>
增加 package 的方法:
</p>
<ol class="org-ol">
<li><p>
直接在 xxx.proj 中添加:
</p>
<pre class="example">
&lt;PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.17"&gt;
</pre></li>
<li>使用 VS 的【管理 Nuget 包】添加</li>
<li><p>
使用 dotnet 命令行添加:
</p>
<pre class="example">
dotnet package add Microsoft.EntityFrameworkCore.Tools
</pre></li>
</ol>
</div>
</div>

<div id="outline-container-orgcbf2bf2" class="outline-3">
<h3 id="orgcbf2bf2"><span class="section-number-3">9.2.</span> Summary</h3>
<div class="outline-text-3" id="text-9-2">
<ul class="org-ul">
<li>IActionResult</li>
<li>asp-for</li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org9ef3dd5" class="outline-2">
<h2 id="org9ef3dd5"><span class="section-number-2">10.</span> RESTful/GraphQL</h2>
<div class="outline-text-2" id="text-10">
<p>
RESTful (Representational State Transfer)，表现层状态转换:
</p>
<ul class="org-ul">
<li>它是一种编程风格 (并非严格的标准)</li>
<li>每个 URL 表示一种资源。对资源的 CRUD 通过 HTTP METHOD (GET/POST/PUT/DELETE/PATCH) 来表达</li>
<li>配合 JSON 进行数据的交换 (application/json)</li>
</ul>

<p>
链接:
</p>
<ul class="org-ul">
<li><a href="https://restfulapi.cn/">https://restfulapi.cn/</a></li>
<li><a href="https://graphql.cn/">https://graphql.cn/</a></li>
<li><a href="https://juejin.cn/post/6965318116154802206">https://juejin.cn/post/6965318116154802206</a></li>
</ul>

<p>
更多内容自行总结，并领会。
</p>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 1a2y</p>
<p class="date">Created: 2023-02-27</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
