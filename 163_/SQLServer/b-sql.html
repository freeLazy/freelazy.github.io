<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-03-07 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SQL 语句</title>
<meta name="author" content="31415929" />
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' href='/asset/common.css?33442' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/asset/common.js'></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">SQL 语句</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgcd17136">1. SQL 是什么</a></li>
<li><a href="#org20c1242">2. SQL 的分类</a>
<ul>
<li><a href="#org60bab73">2.1. DDL (Data Definition Language) 数据定义语言</a></li>
<li><a href="#org4867db2">2.2. DML (Data Manipulation Language) 数据操纵语言</a></li>
<li><a href="#org30ff36f">2.3. DCL (Data Control Language) 数据控制语言</a></li>
<li><a href="#org9b6f2c4">2.4. TCL (Transaction Control Language) 事务控制语言</a></li>
</ul>
</li>
<li><a href="#org7cd3982">3. SQLServer 中的 SQL 语句</a>
<ul>
<li><a href="#orgae36dac">3.1. database 的创建和删除</a></li>
<li><a href="#org41d952b">3.2. table 的创建</a></li>
<li><a href="#org73489df">3.3. 常见数据类型</a>
<ul>
<li><a href="#orgda9d4ad">3.3.1. 数值</a></li>
<li><a href="#org9bad0c6">3.3.2. 字符串</a></li>
<li><a href="#org4d032ec">3.3.3. 日期/时间</a></li>
<li><a href="#org3dac796">3.3.4. 其他类型</a></li>
<li><a href="#orgbd93745">3.3.5. 使用例子</a></li>
</ul>
</li>
<li><a href="#org2cd06f2">3.4. table 的修改</a></li>
<li><a href="#org118fc94">3.5. table 的删除</a></li>
<li><a href="#orgda6fec0">3.6. constraint 的管理</a></li>
<li><a href="#org22058e8">3.7. insert 插入</a></li>
<li><a href="#org05d2fea">3.8. delete/truncate 删除</a></li>
<li><a href="#orgac017e8">3.9. update 更新</a></li>
<li><a href="#orge7c8b21">3.10. select 查询</a>
<ul>
<li><a href="#org5f5bffb">3.10.1. 测试数据</a></li>
<li><a href="#org133c7f1">3.10.2. 基本查询</a></li>
<li><a href="#org46f6915">3.10.3. 子查询 (subquery)</a>
<ul>
<li><a href="#org8f15826">3.10.3.1. 作为临时表存在</a></li>
<li><a href="#orgd4a8a73">3.10.3.2. 作为字段存在</a></li>
<li><a href="#orgb6f25f6">3.10.3.3. 作为条件存在</a></li>
<li><a href="#org9daf6f8">3.10.3.4. 阶段性作业 (subquery)</a></li>
</ul>
</li>
<li><a href="#orgbdf6575">3.10.4. 连接查询 (join)</a></li>
<li><a href="#org495b354">3.10.5. 合并 (union)</a></li>
<li><a href="#org8361702">3.10.6. 分组、窗口查询 (group by/over)</a></li>
<li><a href="#orgdf76542">3.10.7. 分页查询 (top/row_number/fetch-offset)</a></li>
</ul>
</li>
<li><a href="#org164a474">3.11. Transaction 事务</a>
<ul>
<li><a href="#org11d398d">3.11.1. 什么是事务 (ACID)</a></li>
<li><a href="#org5c32bfb">3.11.2. 事务的状态</a></li>
<li><a href="#orgca2c640">3.11.3. SQLServer 中的事务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org761e0b2">4. MySQL 中的 SQL 语句</a>
<ul>
<li><a href="#org97804b6">4.1. create</a></li>
<li><a href="#orgf29fe09">4.2. 分页</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-orgcd17136" class="outline-2">
<h2 id="orgcd17136"><span class="section-number-2">1.</span> SQL 是什么</h2>
<div class="outline-text-2" id="text-1">
<p>
Structured Query Language, 结构化查询语言。
</p>

<p>
它是操作<a href="../roam/20200826034745-关系型数据库.html">关系型数据</a>的标准语言。
</p>

<p>
发展简史:
</p>
<ul class="org-ul">
<li>1976 左右，IBM 发表了想法</li>
<li>1979 左右，Oracle 给出了实现</li>
<li>1990 左右，SQL 成了工业标准</li>
</ul>
</div>
</section>

<section id="outline-container-org20c1242" class="outline-2">
<h2 id="org20c1242"><span class="section-number-2">2.</span> SQL 的分类</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org60bab73" class="outline-3">
<h3 id="org60bab73"><span class="section-number-3">2.1.</span> DDL (Data Definition Language) 数据定义语言</h3>
<div class="outline-text-3" id="text-2-1">
<p>
用来对数据的对象进行定义的一些语句:
</p>
<ul class="org-ul">
<li>创建: <code>create 类型 名字 详细定义</code> 例: <code>create table xxx ()</code></li>
<li>修改: <code>alter 类型 名字 你要修改的东西</code> 例: <code>alter table xxx add column (yyy int)</code></li>
<li>删掉: <code>drop 类型 名字</code> 例: <code>drop table xxx</code></li>
</ul>
</div>
</div>

<div id="outline-container-org4867db2" class="outline-3">
<h3 id="org4867db2"><span class="section-number-3">2.2.</span> DML (Data Manipulation Language) 数据操纵语言</h3>
<div class="outline-text-3" id="text-2-2">
<p>
对数据的操作:
</p>
<ul class="org-ul">
<li>增(C): <code>insert into</code></li>
<li>删(D): <code>delete from</code></li>
<li>改(U): <code>update</code></li>
<li>查(R): <code>select from</code>  <b>-</b>-</li>
</ul>
</div>
</div>

<div id="outline-container-org30ff36f" class="outline-3">
<h3 id="org30ff36f"><span class="section-number-3">2.3.</span> DCL (Data Control Language) 数据控制语言</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>授予权限: <code>grant to</code></li>
<li>撤回权限: <code>revoke from</code></li>
</ul>
</div>
</div>

<div id="outline-container-org9b6f2c4" class="outline-3">
<h3 id="org9b6f2c4"><span class="section-number-3">2.4.</span> TCL (Transaction Control Language) 事务控制语言</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>设置保存点: <code>savepoint xxx</code></li>
<li>撤回: <code>rollback [xxx]</code></li>
<li>提交: <code>commit</code></li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org7cd3982" class="outline-2">
<h2 id="org7cd3982"><span class="section-number-2">3.</span> SQLServer 中的 SQL 语句</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgae36dac" class="outline-3">
<h3 id="orgae36dac"><span class="section-number-3">3.1.</span> database 的创建和删除</h3>
<div class="outline-text-3" id="text-3-1">
<p>
最基本的创建语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> database demo;
<span style="color: #fb4933;">go</span>
</pre>
</div>

<p>
带各种参数的创建语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> database school
<span style="color: #fb4933;">on</span>
<span style="color: #458588;">(</span>
   <span style="color: #fb4933;">name</span> = school,                   <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#36923;&#36753;&#21517;&#31216;</span>
   filename = <span style="color: #b8bb26;">'d:\data\school.mdf'</span>, <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20027;&#25968;&#25454;&#25991;&#20214;&#25968;&#25454;&#20445;&#23384;&#30340;&#20301;&#32622;</span>
   <span style="color: #fb4933;">size</span> = 10,                       <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#21021;&#22987;&#21270;&#22823;&#23567;&#20026; 10M</span>
   maxsize = 500,                   <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#26368;&#22823;&#20540;&#20026; 500M</span>
   filegrowth = 10%                 <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#22686;&#38271;&#31574;&#30053;</span>
<span style="color: #458588;">)</span>
log <span style="color: #fb4933;">on</span>
<span style="color: #458588;">(</span>
   <span style="color: #fb4933;">name</span> = school_log,                   <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26085;&#24535;&#25991;&#20214;&#30340;&#36923;&#36753;&#21517;&#23383;</span>
   filename = <span style="color: #b8bb26;">'d:\data\school_log.ldf'</span>, <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26085;&#24535;&#25991;&#20214;&#30340;&#20445;&#23384;&#20301;&#32622;</span>
   <span style="color: #fb4933;">size</span> = 10,
   maxsize = 100,
   filegrowth = 2
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">go</span>
</pre>
</div>

<p>
删除的语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">drop</span> database school;
<span style="color: #fb4933;">drop</span> database home;
<span style="color: #fb4933;">drop</span> database demo;
</pre>
</div>
</div>
</div>

<div id="outline-container-org41d952b" class="outline-3">
<h3 id="org41d952b"><span class="section-number-3">3.2.</span> table 的创建</h3>
<div class="outline-text-3" id="text-3-2">
<p>
基本的创建示例:
</p>
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #fb4933;">go</span>
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">room_type</span>
<span style="color: #458588;">(</span>
   type_number <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>4<span style="color: #b16286;">)</span> <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span>,
   type_name <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>40<span style="color: #b16286;">)</span>,
   pricE money,
   <span style="color: #b16286;">[</span>coPrice<span style="color: #b16286;">]</span> money,
   total_number <span style="color: #d3869b;">decimal</span><span style="color: #b16286;">(</span>3, 0<span style="color: #b16286;">)</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span> <span style="color: #fb4933;">default</span> 0
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">go</span>
</pre>
</div>

<p>
稍复杂一点的例子:
</p>
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #fb4933;">go</span>
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuInfo</span>
<span style="color: #458588;">(</span>
   stuNo <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">identity</span> <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span>,         <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20027;&#38190;+&#33258;&#22686;</span>
   stuName <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>12<span style="color: #b16286;">)</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>,           <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#38750;&#31354;&#32422;&#26463;</span>
   stuAge <span style="color: #d3869b;">int</span>                              <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26377;&#38382;&#39064;!!!</span>
     <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>                              <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#38750;&#31354;&#32422;&#26463;</span>
     <span style="color: #fb4933;">check</span><span style="color: #b16286;">(</span>stuAge &gt;= 0 <span style="color: #fb4933;">and</span> stuAge &lt;= 100<span style="color: #b16286;">)</span>, <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26816;&#26597;&#32422;&#26463;</span>
   stuSex <span style="color: #d3869b;">nchar</span><span style="color: #b16286;">(</span>1<span style="color: #b16286;">)</span>
     <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>                              <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#38750;&#31354;&#32422;&#26463;</span>
     <span style="color: #fb4933;">check</span><span style="color: #b16286;">(</span>stuSex = <span style="color: #b8bb26;">'&#30007;'</span> <span style="color: #fb4933;">or</span> stuSex = <span style="color: #b8bb26;">'&#22899;'</span><span style="color: #b16286;">)</span> <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26816;&#26597;&#32422;&#26463;</span>
     <span style="color: #fb4933;">default</span> <span style="color: #b16286;">(</span><span style="color: #b8bb26;">'&#30007;'</span><span style="color: #b16286;">)</span>,                       <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#40664;&#35748;&#20540;</span>
   stuTel <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>15<span style="color: #b16286;">)</span>,
   stuAddress <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>50<span style="color: #b16286;">)</span> <span style="color: #fb4933;">default</span> <span style="color: #b16286;">(</span><span style="color: #b8bb26;">'&#22320;&#22336;&#19981;&#35814;'</span><span style="color: #b16286;">)</span>,
   className <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>12<span style="color: #b16286;">)</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">go</span>
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">exam</span>
<span style="color: #458588;">(</span>
  examNo <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span> <span style="color: #fb4933;">identity</span><span style="color: #b16286;">(</span>1, 1<span style="color: #b16286;">)</span>,
  stuNo <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">foreign</span> <span style="color: #fb4933;">key</span> <span style="color: #fb4933;">references</span> stuInfo<span style="color: #b16286;">(</span>stuNo<span style="color: #b16286;">)</span>,       <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22806;&#38190;&#32422;&#26463;</span>
  written <span style="color: #d3869b;">float</span> <span style="color: #fb4933;">check</span> <span style="color: #b16286;">(</span>written &gt;= 0 <span style="color: #fb4933;">and</span> written &lt;= 100<span style="color: #b16286;">)</span>, <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#31508;&#35797;</span>
  lab <span style="color: #d3869b;">float</span> <span style="color: #fb4933;">check</span> <span style="color: #b16286;">(</span>lab &gt;= 0 <span style="color: #fb4933;">and</span> lab &lt;= 100<span style="color: #b16286;">)</span>              <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26426;&#35797;</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">go</span>
</pre>
</div>

<p>
Question:
</p>
<ul class="org-ul">
<li><p>
char/nchar/varchar/nvarchar 类型的区别
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">x</span> <span style="color: #458588;">(</span>s <span style="color: #d3869b;">char</span><span style="color: #b16286;">(</span>1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">y</span> <span style="color: #458588;">(</span>s <span style="color: #d3869b;">nchar</span><span style="color: #b16286;">(</span>1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> y <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'&#30007;'</span><span style="color: #458588;">)</span>;
</pre>
</div></li>
<li>GBK/UTF8/UTF16 的区别</li>
<li>什么是外键，它有什么作用，是不是必须的? 外键有哪些添加方式?</li>
</ul>

<p>
小结:
</p>
<ul class="org-ul">
<li>默认情况下，字段的大小写不敏感，可以使用 <code>[xxx]</code> 方式强制其敏感</li>
<li>在数据库中，字段/表名字使用的是下划线分割的命名规则</li>
<li>数据应该是静态的，年龄 (Age) 不适合作为一个字段，用 birth 代替</li>
<li>建议使用 <b>代理主键</b> 代替 *自然主键*，即主键不应与业务有关</li>
<li><p>
表跟列的命名，有不同风格:
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">student</span> <span style="color: #458588;">(</span>id, <span style="color: #fb4933;">name</span>, tel, addr<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">t_student</span> <span style="color: #458588;">(</span>stu_id, stu_name, stu_tel, stu_addr<span style="color: #458588;">)</span>;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org73489df" class="outline-3">
<h3 id="org73489df"><span class="section-number-3">3.3.</span> 常见数据类型</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orgda9d4ad" class="outline-4">
<h4 id="orgda9d4ad"><span class="section-number-4">3.3.1.</span> 数值</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
整数:
</p>
<ul class="org-ul">
<li>tinyint</li>
<li>smallint</li>
<li>int</li>
<li>bigint</li>
</ul>

<p>
浮点:
</p>
<ul class="org-ul">
<li>real</li>
<li>float</li>
<li>decimal(5,2)</li>
</ul>

<p>
另外:
</p>
<ul class="org-ul">
<li>smallmoney</li>
<li>money</li>
</ul>
</div>
</div>

<div id="outline-container-org9bad0c6" class="outline-4">
<h4 id="org9bad0c6"><span class="section-number-4">3.3.2.</span> 字符串</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>char/nchar</li>
<li>varchar/nvarchar，有存储上限的 8000</li>
<li>text/ntext，表示巨大的存储</li>
</ul>
</div>
</div>

<div id="outline-container-org4d032ec" class="outline-4">
<h4 id="org4d032ec"><span class="section-number-4">3.3.3.</span> 日期/时间</h4>
<div class="outline-text-4" id="text-3-3-3">
<ul class="org-ul">
<li>date</li>
<li>time</li>
<li>datetime</li>
<li>datetime2</li>
<li>getdate()</li>
</ul>
</div>
</div>

<div id="outline-container-org3dac796" class="outline-4">
<h4 id="org3dac796"><span class="section-number-4">3.3.4.</span> 其他类型</h4>
<div class="outline-text-4" id="text-3-3-4">
<ul class="org-ul">
<li>image</li>
<li>binary</li>
<li>varbinary</li>
</ul>
</div>
</div>

<div id="outline-container-orgbd93745" class="outline-4">
<h4 id="orgbd93745"><span class="section-number-4">3.3.5.</span> 使用例子</h4>
<div class="outline-text-4" id="text-3-3-5">
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #fb4933;">go</span>
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">xx13</span> <span style="color: #458588;">(</span>aaa datetime2 <span style="color: #fb4933;">default</span> getdate<span style="color: #b16286;">()</span>, b <span style="color: #d3869b;">int</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> xx13 <span style="color: #458588;">(</span>b<span style="color: #458588;">)</span> <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>1<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">go</span>

<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> xx13;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2cd06f2" class="outline-3">
<h3 id="org2cd06f2"><span class="section-number-3">3.4.</span> table 的修改</h3>
<div class="outline-text-3" id="text-3-4">
<p>
基本修改:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#28155;&#21152;&#23383;&#27573;</span>
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">add</span> stuEmail <span style="color: #d3869b;">varchar</span><span style="color: #458588;">(</span>50<span style="color: #458588;">)</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20462;&#25913;&#23383;&#27573;</span>
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">column</span> stuname nvarchar<span style="color: #458588;">(</span>9<span style="color: #458588;">)</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21024;&#38500;&#23383;&#27573;</span>
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">drop</span> <span style="color: #fb4933;">column</span> stuEmail;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#32422;&#26463;&#30340;&#28155;&#21152;&#21644;&#21024;&#38500;</span>
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">add</span> <span style="color: #fb4933;">constraint</span> pk_stuno <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span> <span style="color: #458588;">(</span>stuno<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">drop</span> <span style="color: #fb4933;">constraint</span> pk_stuno;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">add</span> <span style="color: #fb4933;">constraint</span> fk_stuno <span style="color: #fb4933;">foreign</span> <span style="color: #fb4933;">key</span> <span style="color: #458588;">(</span>stuno<span style="color: #458588;">)</span> <span style="color: #fb4933;">references</span> xxx<span style="color: #458588;">(</span><span style="color: #fb4933;">no</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">stuinfo</span> <span style="color: #fb4933;">drop</span> <span style="color: #fb4933;">constraint</span> fk_stuno;
</pre>
</div>
</div>
</div>

<div id="outline-container-org118fc94" class="outline-3">
<h3 id="org118fc94"><span class="section-number-3">3.5.</span> table 的删除</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">drop</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">xxx</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda6fec0" class="outline-3">
<h3 id="orgda6fec0"><span class="section-number-3">3.6.</span> constraint 的管理</h3>
<div class="outline-text-3" id="text-3-6">
<p>
分类:
</p>
<ul class="org-ul">
<li>主键约束 (Primary Key)</li>
<li>唯一约束 (Unique)</li>
<li>检查约束 (Check)</li>
<li>默认约束 (Default)</li>
<li>外键约束 (Foreign Key)</li>
</ul>

<p>
到底使用外键否? 取决于 <b>场景</b> 和 *权衡*。
</p>

<p>
添加到列上的约束:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span>
<span style="color: #458588;">(</span>
   aaa <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span>,
   bbb <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>,
   ccc <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">default</span> 1,
   ddd <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">check</span> <span style="color: #b16286;">(</span>ddd &gt; 5<span style="color: #b16286;">)</span>,
   eee <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">unique</span>,
   fff <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">references</span> xxx<span style="color: #b16286;">(</span><span style="color: #fb4933;">number</span><span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22914;&#26524;&#20462;&#25913;&#65292;&#21487;&#20197;&#20351;&#29992; alter table ... alter column ...</span>
</pre>
</div>

<p>
表级约束 (建表的时候添加):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span>
<span style="color: #458588;">(</span>
   aaa <span style="color: #d3869b;">int</span>,
   bbb <span style="color: #d3869b;">int</span>,
   ccc <span style="color: #d3869b;">int</span>,
   ddd <span style="color: #d3869b;">int</span>,
   eee <span style="color: #d3869b;">int</span>,
   fff <span style="color: #d3869b;">int</span>,
   <span style="color: #b16286;">[</span><span style="color: #fb4933;">constraint</span> pk_aaa<span style="color: #b16286;">]</span> <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span> <span style="color: #b16286;">(</span>aaa<span style="color: #b16286;">)</span>,
   <span style="color: #b16286;">[</span><span style="color: #fb4933;">constraint</span> fk_fff<span style="color: #b16286;">]</span> <span style="color: #fb4933;">foreign</span> <span style="color: #fb4933;">key</span> <span style="color: #b16286;">(</span>fff<span style="color: #b16286;">)</span> <span style="color: #fb4933;">references</span> xxx<span style="color: #b16286;">(</span><span style="color: #fb4933;">number</span><span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span> <span style="color: #fb4933;">drop</span> <span style="color: #fb4933;">constraint</span> pk_aaa;
</pre>
</div>

<p>
表级约束 (建完表之后添加，在实际中更常用):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span>
<span style="color: #458588;">(</span>
   aaa <span style="color: #d3869b;">int</span>,
   bbb <span style="color: #d3869b;">int</span>,
   ccc <span style="color: #d3869b;">int</span>,
   ddd <span style="color: #d3869b;">int</span>,
   eee <span style="color: #d3869b;">int</span>,
   fff <span style="color: #d3869b;">int</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span> <span style="color: #fb4933;">add</span> <span style="color: #fb4933;">constraint</span> pk_aaa <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span> <span style="color: #458588;">(</span>aaa<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span> <span style="color: #fb4933;">add</span> <span style="color: #fb4933;">constraint</span> fk_fff <span style="color: #fb4933;">foreign</span> <span style="color: #fb4933;">key</span> <span style="color: #458588;">(</span>fff<span style="color: #458588;">)</span> <span style="color: #fb4933;">references</span> xxx<span style="color: #458588;">(</span><span style="color: #fb4933;">number</span><span style="color: #458588;">)</span>;
</pre>
</div>

<p>
在实际中，可能要综合使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span>
<span style="color: #458588;">(</span>
   aaa <span style="color: #d3869b;">int</span>,
   bbb <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>,
   ccc <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">unique</span>,
   ddd <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">default</span> 2,
   eee <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">check</span> <span style="color: #b16286;">(</span>eee &gt; 4<span style="color: #b16286;">)</span>,
   fff <span style="color: #d3869b;">int</span>,
   <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span> <span style="color: #b16286;">(</span>aaa<span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">demo_constraint</span> <span style="color: #fb4933;">add</span> <span style="color: #fb4933;">constraint</span> fk_fff <span style="color: #fb4933;">foreign</span> <span style="color: #fb4933;">key</span> <span style="color: #458588;">(</span>fff<span style="color: #458588;">)</span> <span style="color: #fb4933;">references</span> xxx<span style="color: #458588;">(</span><span style="color: #fb4933;">number</span><span style="color: #458588;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org22058e8" class="outline-3">
<h3 id="org22058e8"><span class="section-number-3">3.7.</span> insert 插入</h3>
<div class="outline-text-3" id="text-3-7">
<p>
基本写法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">zzz</span> <span style="color: #458588;">(</span>a <span style="color: #d3869b;">int</span>, b text, c <span style="color: #d3869b;">date</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#25353;&#29031;&#39034;&#24207;&#23545;&#24212;&#34920;&#20013;&#30340;&#23383;&#27573; (&#19981;&#25512;&#33616;)</span>
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> zzz <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>111, <span style="color: #b8bb26;">'abc'</span>, <span style="color: #b8bb26;">'2009-02-13'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22914;&#26524;&#21457;&#29983;&#34920;&#30340;&#23383;&#27573;&#22686;&#21152;&#30340;&#24773;&#20917;&#65292;&#19978;&#36848;&#30340;&#35821;&#21477;&#20250;&#20986;&#38169;</span>
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">zzz</span> <span style="color: #fb4933;">add</span> ddd <span style="color: #d3869b;">varchar</span><span style="color: #458588;">(</span>20<span style="color: #458588;">)</span> <span style="color: #fb4933;">default</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'bossisevil'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> zzz <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>111, <span style="color: #b8bb26;">'abc'</span>, <span style="color: #b8bb26;">'2009-02-13'</span><span style="color: #458588;">)</span>; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20986;&#38169;</span>
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> zzz <span style="color: #458588;">(</span>a, b, c<span style="color: #458588;">)</span> <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>111, <span style="color: #b8bb26;">'abc'</span>, <span style="color: #b8bb26;">'2009-02-13'</span><span style="color: #458588;">)</span>; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#27491;&#30830;&#20889;&#27861;!</span>

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20026;&#25968;&#25454;&#34920;&#65292;&#22686;&#21152;&#19968;&#20010;&#40664;&#35748;&#25554;&#20837;&#26102;&#38388;&#30340;&#23383;&#27573;</span>
<span style="color: #fb4933;">alter</span> <span style="color: #fb4933;">table</span> zzz <span style="color: #fb4933;">add</span> created_at datetime <span style="color: #fb4933;">default</span> <span style="color: #fabd2f;">getdate</span><span style="color: #458588;">()</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> zzz <span style="color: #458588;">(</span>a, b, c<span style="color: #458588;">)</span> <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>111, <span style="color: #b8bb26;">'abc'</span>, <span style="color: #b8bb26;">'2009-02-13'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> zzz; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">created_at &#23383;&#27573;&#34987;&#22635;&#20805;&#20102;&#20540;</span>
</pre>
</div>

<p>
复制表的数据:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22797;&#21046;&#34920;&#30340;&#32467;&#26524;&#65292;&#20197;&#21450;&#25968;&#25454;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">into</span> zzzzz <span style="color: #fb4933;">from</span> zzz;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21482;&#26159;&#22797;&#21046;&#25968;&#25454;</span>
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> zzzz <span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> zzz <span style="color: #fb4933;">where</span> ddd <span style="color: #fb4933;">is</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org05d2fea" class="outline-3">
<h3 id="org05d2fea"><span class="section-number-3">3.8.</span> delete/truncate 删除</h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21024;&#38500; zzz &#20013;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #fb4933;">delete</span> <span style="color: #fb4933;">from</span> zzz;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21024;&#38500; zzz &#20013;&#37096;&#20998;&#25968;&#25454;</span>
<span style="color: #fb4933;">delete</span> <span style="color: #fb4933;">from</span> zzz <span style="color: #fb4933;">where</span> ddd <span style="color: #fb4933;">is</span> <span style="color: #fb4933;">null</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21024;&#38500;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#27604; delete &#26356;&#39640;&#25928; (&#19981;&#29992;&#35760;&#24405;&#26085;&#24535;)</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">truncate &#19981;&#33021;&#21152;&#26465;&#20214;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#23646;&#20110; DDL &#35821;&#21477;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22362;&#20915;&#35201;&#24910;&#29992;&#27492;&#35821;&#21477;</span>
truncate <span style="color: #fb4933;">table</span> zzz;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac017e8" class="outline-3">
<h3 id="orgac017e8"><span class="section-number-3">3.9.</span> update 更新</h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#19968;&#23450;&#19981;&#35201;&#33853;&#19979; where &#26465;&#20214;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22312;&#26356;&#26032;&#21069;&#65292;&#19968;&#23450;&#20808;&#36890;&#36807; select &#30830;&#23450;&#35201;&#20462;&#25913;&#30340;&#25968;&#25454;&#26465;&#30446;</span>
<span style="color: #fb4933;">update</span> zzz <span style="color: #fb4933;">set</span> a = 2 <span style="color: #fb4933;">where</span> a = 1;
<span style="color: #fb4933;">update</span> zzz <span style="color: #fb4933;">set</span> a = a + 2 <span style="color: #fb4933;">where</span> a = 1;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7c8b21" class="outline-3">
<h3 id="orge7c8b21"><span class="section-number-3">3.10.</span> select 查询</h3>
<div class="outline-text-3" id="text-3-10">
</div>
<div id="outline-container-org5f5bffb" class="outline-4">
<h4 id="org5f5bffb"><span class="section-number-4">3.10.1.</span> 测试数据</h4>
<div class="outline-text-4" id="text-3-10-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">CREATE</span> DATABASE oa;
use oa;

<span style="color: #fb4933;">CREATE</span> <span style="color: #fb4933;">TABLE</span> <span style="color: #fabd2f;">dept</span> <span style="color: #458588;">(</span> <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">department</span>
  deptno <span style="color: #d3869b;">int</span>,
  dname  <span style="color: #d3869b;">VARCHAR</span><span style="color: #b16286;">(</span>14<span style="color: #b16286;">)</span>,
  loc    <span style="color: #d3869b;">VARCHAR</span><span style="color: #b16286;">(</span>13<span style="color: #b16286;">)</span>, <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">location/address</span>
  <span style="color: #fb4933;">CONSTRAINT</span> pk_dept <span style="color: #fb4933;">PRIMARY</span> <span style="color: #fb4933;">KEY</span> <span style="color: #b16286;">(</span>deptno<span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">CREATE</span> <span style="color: #fb4933;">TABLE</span> <span style="color: #fabd2f;">emp</span> <span style="color: #458588;">(</span> <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">employee</span>
  empno    <span style="color: #d3869b;">int</span>,
  ename    <span style="color: #d3869b;">VARCHAR</span><span style="color: #b16286;">(</span>10<span style="color: #b16286;">)</span>,
  job      <span style="color: #d3869b;">VARCHAR</span><span style="color: #b16286;">(</span>9<span style="color: #b16286;">)</span>,
  mgr      <span style="color: #d3869b;">int</span>,
  hiredate <span style="color: #d3869b;">DATE</span>,
  sal      <span style="color: #d3869b;">float</span>,
  comm     <span style="color: #d3869b;">float</span>,
  deptno   <span style="color: #d3869b;">int</span>,
  <span style="color: #fb4933;">CONSTRAINT</span> pk_emp <span style="color: #fb4933;">PRIMARY</span> <span style="color: #fb4933;">KEY</span> <span style="color: #b16286;">(</span>empno<span style="color: #b16286;">)</span>,
  <span style="color: #fb4933;">CONSTRAINT</span> fk_deptno <span style="color: #fb4933;">FOREIGN</span> <span style="color: #fb4933;">KEY</span> <span style="color: #b16286;">(</span>deptno<span style="color: #b16286;">)</span> <span style="color: #fb4933;">REFERENCES</span> dept <span style="color: #b16286;">(</span>deptno<span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">CREATE</span> <span style="color: #fb4933;">TABLE</span> <span style="color: #fabd2f;">bonus</span> <span style="color: #458588;">(</span> <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">bonus</span>
  ename <span style="color: #d3869b;">VARCHAR</span><span style="color: #b16286;">(</span>10<span style="color: #b16286;">)</span>,
  job   <span style="color: #d3869b;">VARCHAR</span><span style="color: #b16286;">(</span>9<span style="color: #b16286;">)</span>,
  sal   <span style="color: #d3869b;">float</span>,
  comm  <span style="color: #d3869b;">float</span>
<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">CREATE</span> <span style="color: #fb4933;">TABLE</span> <span style="color: #fabd2f;">salgrade</span> <span style="color: #458588;">(</span> <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">salary grade</span>
  grade <span style="color: #d3869b;">int</span>,
  losal <span style="color: #d3869b;">float</span>,
  hisal <span style="color: #d3869b;">float</span>
<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> dept <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span>10, <span style="color: #b8bb26;">'ACCOUNTING'</span>, <span style="color: #b8bb26;">'NEW YORK'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> dept <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span>20, <span style="color: #b8bb26;">'RESEARCH'</span>, <span style="color: #b8bb26;">'DALLAS'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> dept <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span>30, <span style="color: #b8bb26;">'SALES'</span>, <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> dept <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span>40, <span style="color: #b8bb26;">'OPERATIONS'</span>, <span style="color: #b8bb26;">'BOSTON'</span><span style="color: #458588;">)</span>;

<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7839, <span style="color: #b8bb26;">'KING'</span>, <span style="color: #b8bb26;">'PRESIDENT'</span>, <span style="color: #fb4933;">null</span>, <span style="color: #b8bb26;">'1981-11-17'</span>, 5000, <span style="color: #fb4933;">null</span>, 10 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7698, <span style="color: #b8bb26;">'BLAKE'</span>, <span style="color: #b8bb26;">'MANAGER'</span>, 7839, <span style="color: #b8bb26;">'1981-05-01'</span>, 2850, <span style="color: #fb4933;">null</span>, 30<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7782, <span style="color: #b8bb26;">'CLARK'</span>, <span style="color: #b8bb26;">'MANAGER'</span>, 7839, <span style="color: #b8bb26;">'1981-06-09'</span>, 2450, <span style="color: #fb4933;">null</span>, 10<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7566, <span style="color: #b8bb26;">'JONES'</span>, <span style="color: #b8bb26;">'MANAGER'</span>, 7839, <span style="color: #b8bb26;">'1981-04-02'</span>, 2975, <span style="color: #fb4933;">null</span>, 20<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7788, <span style="color: #b8bb26;">'SCOTT'</span>, <span style="color: #b8bb26;">'ANALYST'</span>, 7566, <span style="color: #b8bb26;">'1987-07-13'</span>, 3000, <span style="color: #fb4933;">null</span>, 20<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7902, <span style="color: #b8bb26;">'FORD'</span>, <span style="color: #b8bb26;">'ANALYST'</span>, 7566, <span style="color: #b8bb26;">'1981-12-03'</span>, 3000, <span style="color: #fb4933;">null</span>, 20 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7369, <span style="color: #b8bb26;">'SMITH'</span>, <span style="color: #b8bb26;">'CLERK'</span>, 7902, <span style="color: #b8bb26;">'1980-12-17'</span>, 800, <span style="color: #fb4933;">null</span>, 20 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7499, <span style="color: #b8bb26;">'ALLEN'</span>, <span style="color: #b8bb26;">'SALESMAN'</span>, 7698, <span style="color: #b8bb26;">'1981-02-20'</span>, 1600, 300, 30<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7521, <span style="color: #b8bb26;">'WARD'</span>, <span style="color: #b8bb26;">'SALESMAN'</span>, 7698, <span style="color: #b8bb26;">'1981-02-22'</span>, 1250, 500, 30 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7654, <span style="color: #b8bb26;">'MARTIN'</span>, <span style="color: #b8bb26;">'SALESMAN'</span>, 7698, <span style="color: #b8bb26;">'1981-09-28'</span>, 1250, 1400, 30 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7844, <span style="color: #b8bb26;">'TURNER'</span>, <span style="color: #b8bb26;">'SALESMAN'</span>, 7698, <span style="color: #b8bb26;">'1981-09-08'</span>, 1500, 0, 30<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7876, <span style="color: #b8bb26;">'ADAMS'</span>, <span style="color: #b8bb26;">'CLERK'</span>, 7788, <span style="color: #b8bb26;">'1987-07-13'</span>, 1100, <span style="color: #fb4933;">null</span>, 20 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7900, <span style="color: #b8bb26;">'JAMES'</span>, <span style="color: #b8bb26;">'CLERK'</span>, 7698, <span style="color: #b8bb26;">'1981-12-03'</span>, 950, <span style="color: #fb4933;">null</span>, 30 <span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> emp <span style="color: #fb4933;">VALUES</span><span style="color: #458588;">(</span> 7934, <span style="color: #b8bb26;">'MILLER'</span>, <span style="color: #b8bb26;">'CLERK'</span>, 7782, <span style="color: #b8bb26;">'1982-01-23'</span>, 1300, <span style="color: #fb4933;">null</span>, 10 <span style="color: #458588;">)</span>;

<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> salgrade <span style="color: #fb4933;">VALUES</span> <span style="color: #458588;">(</span>1, 700, 1200<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> salgrade <span style="color: #fb4933;">VALUES</span> <span style="color: #458588;">(</span>2, 1201, 1400<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> salgrade <span style="color: #fb4933;">VALUES</span> <span style="color: #458588;">(</span>3, 1401, 2000<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> salgrade <span style="color: #fb4933;">VALUES</span> <span style="color: #458588;">(</span>4, 2001, 3000<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">INSERT</span> <span style="color: #fb4933;">INTO</span> salgrade <span style="color: #fb4933;">VALUES</span> <span style="color: #458588;">(</span>5, 3001, 9999<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">go</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org133c7f1" class="outline-4">
<h4 id="org133c7f1"><span class="section-number-4">3.10.2.</span> 基本查询</h4>
<div class="outline-text-4" id="text-3-10-2">
<p>
基本句式:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> &#23383;&#27573;&#20204; 
  <span style="color: #fb4933;">from</span> &#34920;&#21517;
  <span style="color: #fb4933;">where</span> &#26465;&#20214; <span style="color: #fb4933;">or</span>/<span style="color: #fb4933;">and</span>/<span style="color: #fb4933;">not</span> &#20854;&#20182;&#26465;&#20214;
  <span style="color: #fb4933;">group</span> <span style="color: #fb4933;">by</span> &#32452;
  <span style="color: #fb4933;">having</span> &#20998;&#32452;&#22522;&#30784;&#19978;&#30340;&#26465;&#20214;
  <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> &#25490;&#24207;&#30340;&#20381;&#25454;;
</pre>
</div>

<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26368;&#31616;&#21333;&#30340;&#26597;&#35810;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#25351;&#23450;&#23383;&#27573;</span>
<span style="color: #fb4933;">select</span> empno, ename <span style="color: #fb4933;">from</span> emp;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#28155;&#21152;&#26465;&#20214;</span>
<span style="color: #fb4933;">select</span> empno, ename, sal, comm <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &lt; 1500;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#32452;&#21512;&#26465;&#20214;</span>
<span style="color: #fb4933;">select</span> empno, ename, sal, comm <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &lt; 1500 <span style="color: #fb4933;">and</span> comm <span style="color: #fb4933;">is</span> <span style="color: #fb4933;">null</span>;
<span style="color: #fb4933;">select</span> empno, ename, sal, comm <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> <span style="color: #458588;">(</span>sal &lt; 1500 <span style="color: #fb4933;">and</span> comm <span style="color: #fb4933;">is</span> <span style="color: #fb4933;">null</span><span style="color: #458588;">)</span> <span style="color: #fb4933;">or</span> sal &lt; 1300;
<span style="color: #fb4933;">select</span> empno, ename, sal, comm <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> &lt; 1800;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20351;&#29992;&#21035;&#21517;</span>
<span style="color: #fb4933;">select</span> empno, ename, sal - 200 <span style="color: #fb4933;">as</span> sal, comm <span style="color: #fb4933;">from</span> emp;
<span style="color: #fb4933;">select</span> empno, ename, sal - 200 + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> total_sal <span style="color: #fb4933;">from</span> emp;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#36827;&#34892;&#35745;&#31639;</span>
<span style="color: #fb4933;">select</span> empno,
       ename + <span style="color: #b8bb26;">' - '</span> + job <span style="color: #fb4933;">as</span> who,
       sal - 200 + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> total_sal
  <span style="color: #fb4933;">from</span> emp;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#36827;&#34892;&#25490;&#24207;</span>
<span style="color: #fb4933;">select</span> empno,
         ename + <span style="color: #b8bb26;">' - '</span> + job <span style="color: #fb4933;">as</span> who,
         sal - 200 + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> total_sal
    <span style="color: #fb4933;">from</span> emp
    <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> total_sal;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21453;&#21521;&#25490;&#24207;</span>
<span style="color: #fb4933;">select</span> empno,
         ename + <span style="color: #b8bb26;">' - '</span> + job <span style="color: #fb4933;">as</span> who,
         sal - 200 + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> total_sal
    <span style="color: #fb4933;">from</span> emp
    <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> total_sal <span style="color: #fb4933;">desc</span>; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">Ascending</span>

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22810;&#20010;&#25490;&#24207;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> <span style="color: #fb4933;">desc</span>,
           hiredate <span style="color: #fb4933;">desc</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#32467;&#21512; where&#65292;&#27880;&#24847;&#39034;&#24207;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> empno &lt;&gt; 7839
  <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal + isnull<span style="color: #458588;">(</span>comm, 0<span style="color: #458588;">)</span> <span style="color: #fb4933;">desc</span>,
           hiredate <span style="color: #fb4933;">desc</span>;
</pre>
</div>

<p>
统计查询:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">count</span><span style="color: #458588;">(</span>*<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp;
<span style="color: #fb4933;">select</span> <span style="color: #fe8019;">count</span><span style="color: #458588;">(</span>1<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp;     <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#19981;&#25512;&#33616;</span>
<span style="color: #fb4933;">select</span> <span style="color: #fe8019;">count</span><span style="color: #458588;">(</span>empno<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#19981;&#25512;&#33616;</span>

<span style="color: #fb4933;">select</span> <span style="color: #fe8019;">max</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp;
<span style="color: #fb4933;">select</span> <span style="color: #fe8019;">min</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp;
<span style="color: #fb4933;">select</span> <span style="color: #fe8019;">avg</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno = 20;
</pre>
</div>

<p>
快捷方式:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#23436;&#20840;&#31561;&#25928;&#65292;&#34920;&#31034;&#21306;&#38388;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> score &gt;= 60 <span style="color: #fb4933;">and</span> score &lt;= 90;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> score <span style="color: #fb4933;">between</span> 60 <span style="color: #fb4933;">and</span> 90;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#23436;&#20840;&#31561;&#25928;&#65292;&#34920;&#31034;&#36873;&#39033;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">class</span>=<span style="color: #b8bb26;">'163'</span> <span style="color: #fb4933;">or</span> <span style="color: #fb4933;">class</span>=<span style="color: #b8bb26;">'165'</span> <span style="color: #fb4933;">or</span> <span style="color: #fb4933;">class</span>=<span style="color: #b8bb26;">'168'</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">class</span> <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'163'</span>, <span style="color: #b8bb26;">'165'</span>, <span style="color: #b8bb26;">'168'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">class</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'163'</span>, <span style="color: #b8bb26;">'165'</span>, <span style="color: #b8bb26;">'168'</span><span style="color: #458588;">)</span>;
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>使用 * 代表所有字段，结果会按照定义的顺序返回</li>
<li>使用 count(*) 来统计总数</li>
<li>注意 where/group/order-by 的顺序</li>
<li>使用 != 或 &lt;&gt; 来表示不等于</li>
<li>使用 is null 或 is not null 表示空或非空</li>
<li>SQLServer 中使用 + 连接字符串</li>
</ul>
</div>
</div>

<div id="outline-container-org46f6915" class="outline-4">
<h4 id="org46f6915"><span class="section-number-4">3.10.3.</span> 子查询 (subquery)</h4>
<div class="outline-text-4" id="text-3-10-3">
</div>
<div id="outline-container-org8f15826" class="outline-5">
<h5 id="org8f15826"><span class="section-number-5">3.10.3.1.</span> 作为临时表存在</h5>
<div class="outline-text-5" id="text-3-10-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#23454;&#38469;&#19978;&#65292;&#23601;&#26159;&#20869;&#23384;&#20013;&#30340;&#20020;&#26102;&#34920;</span>
<span style="color: #fb4933;">select</span> ename, job <span style="color: #fb4933;">from</span> <span style="color: #458588;">(</span>
    <span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &gt; 2000
  <span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> a1
  <span style="color: #fb4933;">where</span> sal &lt; 5000;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#30127;&#29378;&#27169;&#24335;</span>
<span style="color: #fb4933;">select</span> ename <span style="color: #fb4933;">from</span> <span style="color: #458588;">(</span>
  <span style="color: #fb4933;">select</span> ename <span style="color: #fb4933;">from</span> <span style="color: #b16286;">(</span>
    <span style="color: #fb4933;">select</span> ename <span style="color: #fb4933;">from</span> <span style="color: #8ec07c;">(</span>
      <span style="color: #fb4933;">select</span> ename <span style="color: #fb4933;">from</span> <span style="color: #d65d0e;">(</span>
        <span style="color: #fb4933;">select</span> ename, job <span style="color: #fb4933;">from</span> <span style="color: #458588;">(</span>
          <span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &gt; 2000
        <span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> a1
        <span style="color: #fb4933;">where</span> sal &lt; 5000<span style="color: #d65d0e;">)</span>
      <span style="color: #fb4933;">as</span> a2 <span style="color: #8ec07c;">)</span>
    <span style="color: #fb4933;">as</span> a3<span style="color: #b16286;">)</span>
  <span style="color: #fb4933;">as</span> a4<span style="color: #458588;">)</span>
<span style="color: #fb4933;">as</span> a5;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4a8a73" class="outline-5">
<h5 id="orgd4a8a73"><span class="section-number-5">3.10.3.2.</span> 作为字段存在</h5>
<div class="outline-text-5" id="text-3-10-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> empno, ename,
       job, sal, comm,
       deptno,
       sal - <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">avg</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> chaju <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21333;&#34892;&#21333;&#23383;&#27573;</span>
   <span style="color: #fb4933;">from</span> emp
   <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> job;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6f25f6" class="outline-5">
<h5 id="orgb6f25f6"><span class="section-number-5">3.10.3.3.</span> 作为条件存在</h5>
<div class="outline-text-5" id="text-3-10-3-3">
<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#25152;&#26377;&#24037;&#36164;&#25302;&#21518;&#33151;&#30340;&#20154;</span>

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#39318;&#20808;&#65292;&#25105;&#20204;&#26597;:</span>
<span style="color: #7c6f64;">--   </span><span style="color: #7c6f64;">select * from emp;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20854;&#27425;&#65292;&#35201;&#36807;&#28388;&#65292;&#24037;&#36164;&#20302;</span>
<span style="color: #7c6f64;">--   </span><span style="color: #7c6f64;">select * from emp where sal &lt; ?;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#28982;&#21518;&#65292;&#23569;&#20110;&#22810;&#23569;&#21602;&#65311;&#24179;&#22343;&#24037;&#36164;</span>
<span style="color: #7c6f64;">--   </span><span style="color: #7c6f64;">select avg(sal) from emp;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26368;&#21518;&#65292;&#32467;&#21512;&#36215;&#26469;:</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &lt; <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">avg</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22686;&#24378;&#29256;: &#23454;&#38469;&#25910;&#20837;&#25302;&#21518;&#33151;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp 
  <span style="color: #fb4933;">where</span> sal + ISNULL<span style="color: #458588;">(</span>comm,0<span style="color: #458588;">)</span> &lt; <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">AVG</span><span style="color: #b16286;">(</span>sal +ISNULL<span style="color: #8ec07c;">(</span>comm,0<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#25152;&#26377;&#30340;&#38750; ANALYST &#20013;&#24037;&#36164;&#27604; ANALYST &#26368;&#20302;&#24037;&#36164;&#36824;&#39640;&#30340;&#20154;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#25152;&#26377;[&#30340;[&#38750; ANALYST &#20013;][&#24037;&#36164;&#27604; [ANALYST &#26368;&#20302;&#24037;&#36164;]&#36824;&#39640;]]&#30340;&#20154;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#27493;&#39588;&#25286;&#35299;:</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">1. &#26368;&#20302;&#24037;&#36164;&#26159;&#22810;&#23569;?</span>
<span style="color: #fb4933;">select</span> <span style="color: #fe8019;">min</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> job = <span style="color: #b8bb26;">'ANALYST'</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">2. &#36807;&#28388;&#31532;&#19968;&#27493;: &#38750; ANALYST</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> job &lt;&gt; <span style="color: #b8bb26;">'ANALYST'</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">3. &#36807;&#28388;&#31532;&#20108;&#27493;: &#24037;&#36164;&#27604; ? &#39640;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &gt; <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">min</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> job = <span style="color: #b8bb26;">'ANALYST'</span><span style="color: #458588;">)</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">4. &#25972;&#21512;&#25152;&#26377;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> job &lt;&gt; <span style="color: #b8bb26;">'ANALYST'</span>
    <span style="color: #fb4933;">and</span> sal &gt; <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">min</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> job = <span style="color: #b8bb26;">'ANALYST'</span><span style="color: #458588;">)</span>;
</pre>
</div>

<p>
IN 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20351;&#29992; in &#32467;&#21512; subquery &#23558;&#26465;&#20214;&#21160;&#24577;&#21270; (&#22810;&#34892;&#21333;&#21015;)</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">class</span> <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span>163, 165, 169<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">class</span> <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> classname <span style="color: #fb4933;">from</span> <span style="color: #fb4933;">class</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#35831;&#24744;&#26597;&#25214;&#25152;&#26377; Research &#37096;&#38376;&#30340;&#20154;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp;          <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#24754;&#20652;&#30340;&#26159;&#65292;emp &#34920;&#20013;&#27809;&#26377; dname &#23383;&#27573;; &#27427;&#21916;&#30340;&#26159;&#65292;&#23427;&#26377; deptno &#23383;&#27573;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span>; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#36890;&#36807;&#36825;&#27493;&#65292;&#21487;&#20197;&#24471;&#21040; RESEARCH &#37096;&#38376;&#30340;&#32534;&#21495;&#20026; 20</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno = 20;         <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#32467;&#21512;&#19978;&#19968;&#27493;&#65292;&#31579;&#36873;&#20986;&#31526;&#21512;&#26465;&#20214;&#30340;&#20154;&#21363;&#21487;</span>

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#25214;&#25152;&#26377;&#30340;&#20154;; &#20854; deptno &#23646;&#20110; dept &#34920;&#20013; dname &#20026; Research &#30340;&#37027;&#20123; dept</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22686;&#24378;&#29256;: &#26597;&#25214;&#25152;&#26377; RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;&#20154;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span> <span style="color: #fb4933;">or</span> loc = <span style="color: #b8bb26;">'BOSTON'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22686;&#24378;&#29256;: &#26597;&#25214;&#25152;&#26377; RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;&#65292;&#24182;&#19988;&#24037;&#36164;&#31561;&#32423;&#20026; 4 &#25110; 5 &#30340;&#20154;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26029;&#21477;: &#26597;&#25214;&#25152;&#26377;[( RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;)&#65292;&#24182;&#19988;(&#24037;&#36164;&#31561;&#32423;&#20026; 4 &#25110; 5 &#30340;)]&#20154;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span> <span style="color: #fb4933;">or</span> loc = <span style="color: #b8bb26;">'BOSTON'</span><span style="color: #458588;">)</span>
    <span style="color: #fb4933;">and</span> sal &gt;= 2001;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20351;&#29992; subquery &#21160;&#24577;&#21270;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span> <span style="color: #fb4933;">or</span> loc = <span style="color: #b8bb26;">'BOSTON'</span><span style="color: #458588;">)</span>
    <span style="color: #fb4933;">and</span> sal &gt;= <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> losal <span style="color: #fb4933;">from</span> salgrade <span style="color: #fb4933;">where</span> grade = 4<span style="color: #458588;">)</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#35753;&#20107;&#24773;&#26356;&#32454;&#33268;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span> <span style="color: #fb4933;">or</span> loc = <span style="color: #b8bb26;">'BOSTON'</span><span style="color: #458588;">)</span>
    <span style="color: #fb4933;">and</span> sal <span style="color: #fb4933;">between</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> losal <span style="color: #fb4933;">from</span> salgrade <span style="color: #fb4933;">where</span> grade = 4<span style="color: #458588;">)</span>
                <span style="color: #fb4933;">and</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> hisal <span style="color: #fb4933;">from</span> salgrade <span style="color: #fb4933;">where</span> grade = 5<span style="color: #458588;">)</span>;
</pre>
</div>

<p>
EXISTS 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#19979;&#38754;&#20004;&#21477;&#21151;&#33021;&#19978;&#26159;&#31561;&#25928;&#30340;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">exists</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> emp.deptno = dept.deptno 
                                     <span style="color: #fb4933;">and</span> dept.loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #458588;">)</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#24615;&#33021;&#27604;&#36739; (&#33041;&#34917;)</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> cardid <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> id <span style="color: #fb4933;">from</span> renkou <span style="color: #fb4933;">where</span> shengfen=<span style="color: #b8bb26;">'&#24191;&#19996;'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">exists</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> id <span style="color: #fb4933;">from</span> renkou <span style="color: #fb4933;">where</span> renkou.id = student.cardid <span style="color: #fb4933;">and</span> shenfen = <span style="color: #b8bb26;">'&#24191;&#19996;'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student s <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">exists</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> id <span style="color: #fb4933;">from</span> renkou r <span style="color: #fb4933;">where</span> r.id = s.cardid <span style="color: #fb4933;">and</span> r.shenfen = <span style="color: #b8bb26;">'&#24191;&#19996;'</span><span style="color: #458588;">)</span>;
</pre>
</div>

<p>
ALL/ANY/SOME 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student s
  <span style="color: #fb4933;">where</span> stuno = <span style="color: #fb4933;">any</span><span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> stuno <span style="color: #fb4933;">from</span> exam e <span style="color: #fb4933;">where</span> written &gt;= 60 <span style="color: #fb4933;">and</span> lab &gt;= 60<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student s
  <span style="color: #fb4933;">where</span> stuno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> stuno <span style="color: #fb4933;">from</span> exam e <span style="color: #fb4933;">where</span> written &gt;= 60 <span style="color: #fb4933;">and</span> lab &gt;= 60<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student s
  <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">exists</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> exam e <span style="color: #fb4933;">where</span> s.stuno = e.stuno <span style="color: #fb4933;">and</span> e.written &gt;= 60 <span style="color: #fb4933;">and</span> e.lab &gt;= 60<span style="color: #458588;">)</span>;

<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">t1</span> <span style="color: #458588;">(</span>n <span style="color: #d3869b;">int</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">t2</span> <span style="color: #458588;">(</span>n <span style="color: #d3869b;">int</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> t1 <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>2<span style="color: #458588;">)</span>, <span style="color: #458588;">(</span>3<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> t2 <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span>1<span style="color: #458588;">)</span>, <span style="color: #458588;">(</span>2<span style="color: #458588;">)</span>, <span style="color: #458588;">(</span>3<span style="color: #458588;">)</span>, <span style="color: #458588;">(</span>4<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t2 <span style="color: #fb4933;">where</span> n &gt; <span style="color: #fb4933;">all</span><span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t1<span style="color: #458588;">)</span>;   <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">4</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t2 <span style="color: #fb4933;">where</span> n &gt; <span style="color: #fb4933;">some</span><span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t1<span style="color: #458588;">)</span>;  <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">3, 4</span>
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>很多人不愿意用 exists，而是喜欢用 in，因为 in 更容易理解并且语句更简短</li>
<li><p>
实际上，更推荐使用 exists，因为在很多场合 exists 更有效率
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#39640;&#39069;&#30340;&#31354;&#38388;&#21344;&#29992;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#24040;&#22823;&#30340;&#23545;&#27604;&#27425;&#25968;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> student <span style="color: #fb4933;">where</span> cardid <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> id <span style="color: #fb4933;">from</span> renkoubiao <span style="color: #fb4933;">where</span> shengfen=<span style="color: #b8bb26;">'&#24191;&#19996;'</span><span style="color: #458588;">)</span>;
</pre>
</div></li>
<li>ANY/SOME/ALL 是 exists 的语法糖，在某些场景之下，更加直观</li>
</ul>
</div>
</div>

<div id="outline-container-org9daf6f8" class="outline-5">
<h5 id="org9daf6f8"><span class="section-number-5">3.10.3.4.</span> 阶段性作业 (subquery)</h5>
<div class="outline-text-5" id="text-3-10-3-4">
<p>
查询出芝加哥工作的工资最高的人的上司的工资，超出平均工资的数目:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#25152;&#26377;&#20154;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno = <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20998;&#35299;&#39064;&#30446;:</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">1. &#23450;&#20301;&#21040;&#33437;&#21152;&#21733;&#22478;&#24066;&#30340;&#37096;&#38376;&#32534;&#21495; (select deptno from dept where loc = 'CHICAGO');</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">2. &#26597;&#25214;&#25152;&#26377;&#22312;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#20154; (&#26681;&#25454;&#19978;&#36848;&#30340;&#37096;&#38376;&#32534;&#21495;) (select * from emp where deptno = ?);</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">3. &#35745;&#31639;&#25152;&#26377;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#20154;&#30340;&#26368;&#39640;&#24037;&#36164; (select max(sal) from emp where deptno = ?);</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">4. &#33719;&#21462;&#24037;&#36164;&#26368;&#39640;&#30340;&#20154;&#30340;&#20449;&#24687; (select * from emp where deptno = ? and sal = ?);</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno = <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #458588;">)</span>
    <span style="color: #fb4933;">and</span> sal = <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">max</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno = <span style="color: #b16286;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20511;&#21161;&#25490;&#24207;&#21644; top &#36827;&#34892;&#23454;&#29616;</span>
<span style="color: #fb4933;">select</span> top 1 * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno = <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #458588;">)</span>
  <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal <span style="color: #fb4933;">desc</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#30340;&#19978;&#21496;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> empno = <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> top 1 mgr <span style="color: #fb4933;">from</span> emp
                   <span style="color: #fb4933;">where</span> deptno = <span style="color: #b16286;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #b16286;">)</span>
                   <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal <span style="color: #fb4933;">desc</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#30340;&#19978;&#21496;&#24037;&#36164;&#36319;&#24179;&#22343;&#24037;&#36164;&#30340;&#24046;&#36317;</span>
<span style="color: #fb4933;">select</span> *, sal - <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> <span style="color: #fe8019;">AVG</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> chaju <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> empno = <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> top 1 mgr <span style="color: #fb4933;">from</span> emp
                   <span style="color: #fb4933;">where</span> deptno = <span style="color: #b16286;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span><span style="color: #b16286;">)</span>
                   <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal <span style="color: #fb4933;">desc</span><span style="color: #458588;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbdf6575" class="outline-4">
<h4 id="orgbdf6575"><span class="section-number-4">3.10.4.</span> 连接查询 (join)</h4>
<div class="outline-text-4" id="text-3-10-4">
<ul class="org-ul">
<li>emp
<ul class="org-ul">
<li>ename</li>
<li>sal</li>
<li>deptno</li>
</ul></li>
<li>dept
<ul class="org-ul">
<li>deptno</li>
<li>dname</li>
<li>loc</li>
</ul></li>
</ul>

<p>
这其实是三种解决问题的思路:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">---- </span><span style="color: #7c6f64;">&#26597;&#35810;&#20986;&#25152;&#26377;&#22312;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#21592;&#24037;</span>

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">1. &#25105;&#30340;&#32534;&#21495;&#65292;&#22312;&#20320;&#30340;&#32534;&#21495;&#20043;&#20869;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> deptno <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> deptno <span style="color: #fb4933;">from</span> dept <span style="color: #fb4933;">where</span> loc=<span style="color: #b8bb26;">'xxx'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">2. &#25105;&#30340;&#25968;&#25454;&#65292;&#35201;&#36880;&#26465;&#36319;&#20320;&#30340;&#27604;&#23545;&#65292;&#36880;&#27493;&#36807;&#28388;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp e
  <span style="color: #fb4933;">where</span> <span style="color: #fb4933;">exists</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> dept d <span style="color: #fb4933;">where</span> d.deptno = e.deptno <span style="color: #fb4933;">and</span> d.loc = <span style="color: #b8bb26;">'xxx'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">3. &#20808;&#25289;&#20320;&#21019;&#24314;&#20020;&#26102;&#34920;&#65292;&#20877;&#32771;&#34385;&#26465;&#20214;&#30340;&#20107;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp
   <span style="color: #fb4933;">join</span> dept <span style="color: #fb4933;">on</span> emp.deptno = dept.deptno
   <span style="color: #fb4933;">where</span> loc = <span style="color: #b8bb26;">'CHICAGO'</span> <span style="color: #fb4933;">or</span> dname = <span style="color: #b8bb26;">'RESEARCH'</span>;
</pre>
</div>

<p>
查找所有 Research 部门的人:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26681;&#25454;&#25152;&#26377;&#26465;&#20214;&#21019;&#24314;&#19968;&#20010;&#20020;&#26102;&#34920;</span>
<span style="color: #fb4933;">select</span> a.*,b.dname,b.loc <span style="color: #fb4933;">from</span> emp a
   <span style="color: #fb4933;">join</span> dept b <span style="color: #fb4933;">on</span> a.deptno = b.deptno <span style="color: #fb4933;">and</span> b.dname=<span style="color: #b8bb26;">'Research'</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20808;&#21019;&#31435;&#19968;&#24352;&#20020;&#26102;&#34920;&#28982;&#21518;&#26681;&#25454;&#26465;&#20214;&#36827;&#34892;&#31579;&#36873;</span>
<span style="color: #fb4933;">select</span> a.*,b.dname,b.loc <span style="color: #fb4933;">from</span> emp a
   <span style="color: #fb4933;">join</span> dept b <span style="color: #fb4933;">on</span> a.deptno = b.deptno
   <span style="color: #fb4933;">where</span> b.dname=<span style="color: #b8bb26;">'Research'</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#38750;&#35268;&#33539;&#26041;&#24335;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp e, dept d
   <span style="color: #fb4933;">where</span> e.deptno = d.deptno <span style="color: #fb4933;">and</span> d.dname = <span style="color: #b8bb26;">'Research'</span>;
</pre>
</div>

<p>
左、右、全连接 (Left/Right/Full Join):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#31034;&#20363;&#25968;&#25454;</span>
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">t_student</span>
<span style="color: #458588;">(</span>
  id <span style="color: #d3869b;">int</span> <span style="color: #fb4933;">identity</span> <span style="color: #fb4933;">primary</span> <span style="color: #fb4933;">key</span>,
  <span style="color: #fb4933;">name</span> <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>200<span style="color: #b16286;">)</span>,
  classname <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>200<span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">create</span> <span style="color: #fb4933;">table</span> <span style="color: #fabd2f;">t_class</span>
<span style="color: #458588;">(</span>
  classname <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>200<span style="color: #b16286;">)</span>,
  loc <span style="color: #d3869b;">varchar</span><span style="color: #b16286;">(</span>200<span style="color: #b16286;">)</span>
<span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> t_class
       <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'163'</span>, <span style="color: #b8bb26;">'201'</span><span style="color: #458588;">)</span>,
              <span style="color: #458588;">(</span><span style="color: #b8bb26;">'164'</span>, <span style="color: #b8bb26;">'202'</span><span style="color: #458588;">)</span>,
              <span style="color: #458588;">(</span><span style="color: #b8bb26;">'165'</span>, <span style="color: #b8bb26;">'404'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> t_student <span style="color: #458588;">(</span><span style="color: #fb4933;">name</span>, classname<span style="color: #458588;">)</span>
       <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'zhangsan'</span>, <span style="color: #b8bb26;">'164'</span><span style="color: #458588;">)</span>,
              <span style="color: #458588;">(</span><span style="color: #b8bb26;">'lisi'</span>, <span style="color: #b8bb26;">'165'</span><span style="color: #458588;">)</span>,
              <span style="color: #458588;">(</span><span style="color: #b8bb26;">'wangwu'</span>, <span style="color: #b8bb26;">'165'</span><span style="color: #458588;">)</span>,
              <span style="color: #458588;">(</span><span style="color: #b8bb26;">'zhaoliu'</span>, <span style="color: #b8bb26;">'165'</span><span style="color: #458588;">)</span>,
              <span style="color: #458588;">(</span><span style="color: #b8bb26;">'sunqi'</span>, <span style="color: #b8bb26;">''</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#26597;&#25214;&#25152;&#26377;&#23398;&#29983;&#65292;&#20197;&#21450;&#20182;&#30340;&#29677;&#32423;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t_student s
  <span style="color: #fb4933;">join</span> t_class c <span style="color: #fb4933;">on</span> s.classname = c.classname;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t_student s
  <span style="color: #458588;">[</span><span style="color: #fb4933;">inner</span><span style="color: #458588;">]</span> <span style="color: #fb4933;">join</span> t_class c <span style="color: #fb4933;">on</span> s.classname = c.classname;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t_student s
  <span style="color: #458588;">[</span><span style="color: #fb4933;">left</span><span style="color: #458588;">]</span> <span style="color: #fb4933;">join</span> t_class c <span style="color: #fb4933;">on</span> s.classname = c.classname;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t_student s
  <span style="color: #458588;">[</span><span style="color: #fb4933;">right</span><span style="color: #458588;">]</span> <span style="color: #fb4933;">join</span> t_class c <span style="color: #fb4933;">on</span> s.classname = c.classname;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> t_student s
  <span style="color: #458588;">[</span><span style="color: #fb4933;">full</span><span style="color: #458588;">]</span> <span style="color: #fb4933;">join</span> t_class c <span style="color: #fb4933;">on</span> s.classname = c.classname;
</pre>
</div>

<p>
笛卡儿积 (叉乘):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#24418;&#25104;&#30340;&#25968;&#25454;&#26159;&#27809;&#26377;&#24847;&#24605;&#30340;&#65292;&#22240;&#20026;&#24456;&#22810;&#25968;&#25454;&#26159;&#19981;&#23545;&#30340;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20294;&#26159;&#65292;&#23427;&#21364;&#26159;&#20854;&#23427;&#26377;&#24847;&#20041;&#30340;&#36830;&#25509;&#30340;&#20869;&#22312;&#22522;&#30784;  </span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp, dept;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp 
  <span style="color: #458588;">[</span><span style="color: #fb4933;">cross</span><span style="color: #458588;">]</span> <span style="color: #fb4933;">join</span> dept;
</pre>
</div>
</div>
</div>

<div id="outline-container-org495b354" class="outline-4">
<h4 id="org495b354"><span class="section-number-4">3.10.5.</span> 合并 (union)</h4>
<div class="outline-text-4" id="text-3-10-5">
<p>
Union 可以连接一切，有意义的，还有无意义的。
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#27627;&#26080;&#24847;&#20041;&#65288;&#65311;&#65289;&#30340; Union</span>
<span style="color: #fb4933;">select</span> empno <span style="color: #fb4933;">from</span> emp
<span style="color: #fb4933;">union</span>
<span style="color: #fb4933;">select</span> deptno, dname <span style="color: #fb4933;">from</span> dept;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#31245;&#24494;&#26377;&#28857;&#24847;&#20041;&#30340; Union</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#23558;&#25152;&#26377;&#23398;&#29983;&#21644;&#21592;&#24037;&#37117;&#21015;&#20986;&#26469;</span>
<span style="color: #fb4933;">select</span> <span style="color: #fb4933;">name</span> <span style="color: #fb4933;">from</span> t_student
<span style="color: #fb4933;">union</span>
<span style="color: #fb4933;">select</span> ename <span style="color: #fb4933;">from</span> emp;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20063;&#21487;&#20197;&#36830;&#25509;&#33258;&#36523;&#34920;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &gt; 2000 <span style="color: #fb4933;">or</span> sal &lt; 1000;
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &gt; 2000
<span style="color: #fb4933;">union</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> sal &lt; 1000;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8361702" class="outline-4">
<h4 id="org8361702"><span class="section-number-4">3.10.6.</span> 分组、窗口查询 (group by/over)</h4>
<div class="outline-text-4" id="text-3-10-6">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21487;&#20197;&#20351;&#29992; union &#25163;&#21160;&#20998;&#32452;</span>
<span style="color: #fb4933;">select</span> 10, <span style="color: #fe8019;">avg</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno = 10
<span style="color: #fb4933;">union</span>
<span style="color: #fb4933;">select</span> 20, <span style="color: #fe8019;">avg</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno = 20
<span style="color: #fb4933;">union</span>
<span style="color: #fb4933;">select</span> 30, <span style="color: #fe8019;">avg</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">where</span> deptno = 30;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20351;&#29992;&#20998;&#32452;&#26469;&#31616;&#21270;&#35821;&#21477;&#12290;&#25968;&#25454;&#24211;&#20869;&#37096;&#30340;&#23454;&#29616;&#36923;&#36753;&#36319;&#19978;&#36848; union &#29256;&#26412;&#31867;&#20284;</span>
<span style="color: #fb4933;">select</span> deptno, <span style="color: #fe8019;">AVG</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span>, <span style="color: #fe8019;">MAX</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span>, <span style="color: #fe8019;">MIN</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">from</span> emp 
  <span style="color: #fb4933;">group</span> <span style="color: #fb4933;">by</span> deptno;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22914;&#26524;&#24819;&#22522;&#20110;&#20998;&#23436;&#30340;&#32452;&#36827;&#34892;&#36807;&#28388;&#65292;&#19979;&#38754;&#20889;&#27861;&#26159; **&#38169;&#30340;**</span>
<span style="color: #fb4933;">select</span> deptno, <span style="color: #fe8019;">AVG</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> a, <span style="color: #fe8019;">MAX</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> d, <span style="color: #fe8019;">MIN</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> x <span style="color: #fb4933;">from</span> emp 
  <span style="color: #fb4933;">group</span> <span style="color: #fb4933;">by</span> deptno
  <span style="color: #fb4933;">where</span> <span style="color: #fe8019;">AVG</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> &gt; 1000;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21487;&#20197;&#20351;&#29992;&#23376;&#26597;&#35810;&#30340;&#24418;&#24335;&#65292;&#35299;&#20915;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> 
<span style="color: #458588;">(</span> <span style="color: #fb4933;">select</span> deptno, <span style="color: #fe8019;">AVG</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> a, <span style="color: #fe8019;">MAX</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> d, <span style="color: #fe8019;">MIN</span><span style="color: #b16286;">(</span>sal<span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> x <span style="color: #fb4933;">from</span> emp 
        <span style="color: #fb4933;">where</span> mgr <span style="color: #fb4933;">is</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>
        <span style="color: #fb4933;">group</span> <span style="color: #fb4933;">by</span> deptno
<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> v <span style="color: #fb4933;">where</span> a &gt; 2000;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#19978;&#36848;&#20889;&#27861;&#34429;&#28982;&#26377;&#25928;&#65292;&#21487;&#26159;&#24182;&#19981;&#22815;&#31616;&#27905;&#65292;&#20110;&#26159;&#26377;&#20102; having &#20851;&#38190;&#35789;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">having &#26159;&#36319; group by &#25645;&#37197;&#30340; `where`</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20110;&#26159; where -&gt; group by -&gt; having</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20808;&#36807;&#28388;&#65292;&#20877;&#20998;&#32452;&#65292;&#20877;&#22312;&#20998;&#32452;&#32467;&#26524;&#30340;&#22522;&#30784;&#19978;&#36807;&#28388;</span>
<span style="color: #fb4933;">select</span> deptno, <span style="color: #fe8019;">AVG</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> a, <span style="color: #fe8019;">MAX</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> d, <span style="color: #fe8019;">MIN</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> x <span style="color: #fb4933;">from</span> emp 
  <span style="color: #fb4933;">where</span> mgr <span style="color: #fb4933;">is</span> <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">null</span>
  <span style="color: #fb4933;">group</span> <span style="color: #fb4933;">by</span> deptno
  <span style="color: #fb4933;">having</span> <span style="color: #fe8019;">AVG</span><span style="color: #458588;">(</span>sal<span style="color: #458588;">)</span> &gt; 2000;
</pre>
</div>

<p>
查询所有部门最高工资的人:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span>
  <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> row_number<span style="color: #b16286;">()</span> over <span style="color: #b16286;">(</span>partition <span style="color: #fb4933;">by</span> deptno <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal <span style="color: #fb4933;">desc</span><span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> rn, * <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> s
  <span style="color: #fb4933;">where</span> rn = 1;

<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span>
  <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> rank<span style="color: #b16286;">()</span> over <span style="color: #b16286;">(</span>partition <span style="color: #fb4933;">by</span> deptno <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> sal <span style="color: #fb4933;">desc</span><span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> rn, * <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> s
  <span style="color: #fb4933;">where</span> rn = 1;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf76542" class="outline-4">
<h4 id="orgdf76542"><span class="section-number-4">3.10.7.</span> 分页查询 (top/row_number/fetch-offset)</h4>
<div class="outline-text-4" id="text-3-10-7">
<p>
只拿出分数据。
</p>

<p>
最经典的分页语句 (top):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> top 2 * <span style="color: #fb4933;">from</span> emp;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">2 - 4</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">1. &#21069; 4 &#34892;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">2. &#21453;&#21521;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">3. &#21069;&#20004;&#26465;</span>
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">4. &#21453;&#21521;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> top 3 * <span style="color: #fb4933;">from</span> <span style="color: #b16286;">(</span><span style="color: #fb4933;">select</span> top 4 * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> empno<span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> t <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> empno <span style="color: #fb4933;">desc</span><span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> x <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> empno <span style="color: #fb4933;">desc</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#21478;&#19968;&#31181;&#24605;&#36335;</span>
<span style="color: #fb4933;">select</span> top 3 * <span style="color: #fb4933;">from</span> emp
  <span style="color: #fb4933;">where</span> empno <span style="color: #fb4933;">not</span> <span style="color: #fb4933;">in</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> top 1 empno <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> empno<span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20854;&#20182;&#25968;&#25454;&#24211;&#23545;&#27604;</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">limit</span> 3 offset 4; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">mysql/sqlite/postgresql</span>
<span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> *, rownum <span style="color: #fb4933;">as</span> rn <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span> rn <span style="color: #fb4933;">between</span> 3 <span style="color: #fb4933;">and</span> 5; <span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">oracle</span>
</pre>
</div>

<p>
借助窗口函数进行选取 (<b>row_number</b>):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> 
   <span style="color: #458588;">(</span><span style="color: #fb4933;">select</span> row_number<span style="color: #b16286;">()</span> over <span style="color: #b16286;">(</span><span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> empno<span style="color: #b16286;">)</span> <span style="color: #fb4933;">as</span> rn, * <span style="color: #fb4933;">from</span> emp<span style="color: #458588;">)</span> <span style="color: #fb4933;">as</span> s
   <span style="color: #fb4933;">where</span> rn <span style="color: #fb4933;">between</span> 2 <span style="color: #fb4933;">and</span> 5;
</pre>
</div>

<p>
SQLServer 2012 以后，开始支持标准的 fetch-offset 写法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">select</span> * <span style="color: #fb4933;">from</span> emp <span style="color: #fb4933;">fetch</span> <span style="color: #fb4933;">next</span> 5 <span style="color: #fb4933;">rows</span> offset 4 <span style="color: #fb4933;">rows</span> <span style="color: #fb4933;">only</span> <span style="color: #fb4933;">order</span> <span style="color: #fb4933;">by</span> empno;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org164a474" class="outline-3">
<h3 id="org164a474"><span class="section-number-3">3.11.</span> Transaction 事务</h3>
<div class="outline-text-3" id="text-3-11">
</div>
<div id="outline-container-org11d398d" class="outline-4">
<h4 id="org11d398d"><span class="section-number-4">3.11.1.</span> 什么是事务 (ACID)</h4>
<div class="outline-text-4" id="text-3-11-1">
<blockquote>
<p>
要么都成，否则都不成。
</p>
</blockquote>

<p>
事务有哪些属性 (ACID, 酸) <b>[这是一个非常常见的面试题]</b>:
</p>
<ol class="org-ol">
<li>Atomicity (原子性)</li>
<li>Consistency (一致性) 结果上</li>
<li>Isolation (隔离性) 并发访问</li>
<li>Durability (持久性)</li>
</ol>
</div>
</div>

<div id="outline-container-org5c32bfb" class="outline-4">
<h4 id="org5c32bfb"><span class="section-number-4">3.11.2.</span> 事务的状态</h4>
<div class="outline-text-4" id="text-3-11-2">
<ul class="org-ul">
<li>活动状态 (active)</li>
<li>部分提交状态 (partially committed)</li>
<li>失败/中止/提交 (failed/abort/commit)</li>
</ul>
</div>
</div>

<div id="outline-container-orgca2c640" class="outline-4">
<h4 id="orgca2c640"><span class="section-number-4">3.11.3.</span> SQLServer 中的事务</h4>
<div class="outline-text-4" id="text-3-11-3">
<p>
首先，默认情况下，SQLServer 中每条语句都会被自动提交。
也就是，任何语句都是一个单独事务，不需要加 commit:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> x <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'xxx'</span><span style="color: #458588;">)</span>;
<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#36825;&#37324;&#19981;&#38656;&#35201;&#21152; commit &#23601;&#33021;&#25554;&#20837;&#25104;&#21151;</span>
</pre>
</div>

<p>
但是，上述行为存在非常严重的安全隐患，建议关掉。
然后，需要手动使用 commit/rollback 进行事务的终结:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#20851;&#38381;&#33258;&#21160;&#25552;&#20132;</span>
<span style="color: #fb4933;">set</span> implicit_transactions <span style="color: #fb4933;">off</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#22240;&#27492;&#65292;&#25152;&#26377;&#30340;&#35821;&#21477;&#37117;&#20250;&#22312;&#21516;&#19968;&#20010;&#20107;&#21153;&#20013;</span>
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> x <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'aaa'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> x <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'zzz'</span><span style="color: #458588;">)</span>;

<span style="color: #7c6f64;">-- </span><span style="color: #7c6f64;">&#38500;&#38750;&#20320;&#35843;&#29992;&#20102; commit/rollback &#21542;&#21017;&#19978;&#36848;&#30340;&#35821;&#21477;&#37117;&#19981;&#20250;&#30495;&#27491;&#20837;&#24211;</span>
<span style="color: #fb4933;">commit</span>/<span style="color: #fb4933;">rollback</span>;
</pre>
</div>

<p>
另外，如果你想更精细控制事务的范围，可以使用显式的 begin 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #fb4933;">begin</span> <span style="color: #fb4933;">transaction</span>
  <span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> x <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'222'</span><span style="color: #458588;">)</span>;
  <span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> x <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'212'</span>, 2<span style="color: #458588;">)</span>;
  <span style="color: #fb4933;">insert</span> <span style="color: #fb4933;">into</span> x <span style="color: #fb4933;">values</span> <span style="color: #458588;">(</span><span style="color: #b8bb26;">'232'</span><span style="color: #458588;">)</span>;
<span style="color: #fb4933;">commit</span> <span style="color: #fb4933;">transaction</span>;
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-org761e0b2" class="outline-2">
<h2 id="org761e0b2"><span class="section-number-2">4.</span> MySQL 中的 SQL 语句</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org97804b6" class="outline-3">
<h3 id="org97804b6"><span class="section-number-3">4.1.</span> create</h3>
</div>

<div id="outline-container-orgf29fe09" class="outline-3">
<h3 id="orgf29fe09"><span class="section-number-3">4.2.</span> 分页</h3>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 31415929</p>
<p class="date">Created: 2024-03-07</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
